{"pages":[{"title":"categories","text":"","link":"/categories/index.html"}],"posts":[{"title":"æ‹¾é—JavaScriptâ€”â€”async-await","text":"async/await async/await åŒ Promiseã€callback ä¸€æ ·æ˜¯ä¸€ç§ç¼–å†™å¼‚æ­¥ä»£ç çš„æ–¹æ³•ã€‚ async/await å®é™…ä¸Šæ˜¯å»ºç«‹åœ¨ promises ä¹‹ä¸Šçš„ï¼Œå…¶è¿”å›çš„æ˜¯ä¸€ä¸ª promiseã€‚ async/await æ˜¯éé˜»å¡çš„ã€‚ async/await æ›´åƒæ˜¯åŒæ­¥ä»£ç ï¼Œå¦‚æœå¤šä¸ªå¼‚æ­¥ä»£ç æ²¡æœ‰ä¾èµ–æ€§å´ä½¿ç”¨äº† await ä¼šå¯¼è‡´æ€§èƒ½ä¸Šçš„é™ä½ã€‚ æè¿°å½“è°ƒç”¨ä¸€ä¸ª async å‡½æ•°æ—¶ï¼Œä¼šè¿”å›ä¸€ä¸ª Promise å¯¹è±¡ã€‚å½“è¿™ä¸ª async å‡½æ•°è¿”å›ä¸€ä¸ªå€¼æ—¶ï¼ŒPromise çš„ resolve æ–¹æ³•ä¼šè´Ÿè´£ä¼ é€’è¿™ä¸ªå€¼ï¼›å½“ async å‡½æ•°æŠ›å‡ºå¼‚å¸¸æ—¶ï¼ŒPromise çš„ reject æ–¹æ³•ä¹Ÿä¼šä¼ é€’è¿™ä¸ªå¼‚å¸¸å€¼ã€‚ async å‡½æ•°ä¸­å¯èƒ½ä¼šæœ‰ await è¡¨è¾¾å¼ï¼Œè¿™ä¼šä½¿ async å‡½æ•°æš‚åœæ‰§è¡Œï¼Œç­‰å¾… Promise çš„ç»“æœå‡ºæ¥ï¼Œç„¶åæ¢å¤ async å‡½æ•°çš„æ‰§è¡Œå¹¶è¿”å›è§£æå€¼ï¼ˆresolvedï¼‰ã€‚ æ³¨æ„ï¼Œ await å…³é”®å­—ä»…ä»…åœ¨ async functionä¸­æœ‰æ•ˆã€‚å¦‚æœåœ¨ async functionå‡½æ•°ä½“å¤–ä½¿ç”¨ await ï¼Œä½ åªä¼šå¾—åˆ°ä¸€ä¸ªè¯­æ³•é”™è¯¯ï¼ˆSyntaxErrorï¼‰ã€‚ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Statements/async_function ğŸŒ°å‡è®¾ä¸€ä¸ªå‡½æ•°getJsonData() æ¥è·å– Json æ•°æ®ã€‚ promise 12345const request = url =&gt; &#123; getJsonData(url).then(response =&gt; &#123; console.log(response.data); &#125;);&#125;; async/await 123const request = async url =&gt; &#123; console.log(await getJsonData(url));&#125;; çœ‹è¿™æ ·çœ‹èµ·æ¥ï¼Œasync/await æ˜¯ä¸æ˜¯ç®€æ´äº†å¾ˆå¤šï¼Ÿ æ¯•ç«Ÿå†™ä¸€å † then ä¹Ÿæ˜¯å¾ˆçƒ¦çš„ã€‚ é”™è¯¯å¤„ç† (try/catch)1code snippet async/await hellasync/await æŠŠæˆ‘ä»¬ä»æ›¾ç»çš„callback hell ä¸­è§£æ”¾ï¼Œè€Œç°åœ¨ï¼Œæˆ‘ä»¬é™·å…¥äº†async/await hellã€‚","link":"/2019/03/12/æ‹¾é—JavaScriptâ€”â€”async-await/"},{"title":"æ‹¾é—JavaScriptâ€”â€”this","text":"thisthis åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ç¡®å®š this çš„æŒ‡å‘æ€§ï¼Ÿ this æ˜¯è®©äººå›°æƒ‘çš„ä¸œè¥¿ï½ this åœ¨æ¯ä¸ªå‡½æ•°çš„ä½œç”¨åŸŸä¸­è¢«è‡ªåŠ¨åˆ›å»ºï¼Œå½“å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡(execution context) è¢«åˆ›å»º æ‰§è¡Œä¸Šä¸‹æ–‡ ä¸­åŒ…å«ä¸€ä¸‹ä¿¡æ¯ å‡½æ•°åœ¨å“ªè°ƒç”¨ï¼ˆcall-stackï¼‰ å‡½æ•°æ€ä¹ˆè¢«è°ƒç”¨ ä½œç”¨åŸŸé“¾ å¯¹è±¡å‚æ•° this â€¦ thisï¼ŒæŒ‡å‘å‡½æ•°æ‰§è¡ŒæœŸé—´çš„thiså¯¹è±¡ã€‚ 1ã€thisä¸æ˜¯åˆ›å»ºæ—¶ç»‘å®šï¼Œè€Œæ˜¯åŠ¨æ€ç»‘å®šï¼ˆruntime bindingï¼‰ 2ã€ thisçš„ä¸Šä¸‹æ–‡åŸºäºå‡½æ•°çš„è°ƒç”¨æƒ…å†µï¼Œå’Œå‡½æ•°åœ¨å“ªå®šä¹‰æ²¡æœ‰å…³ç³»ã€‚ è°ƒç”¨æƒ…å†µåˆ†æ1.å…¨å±€ä½œç”¨åŸŸï¼ˆglobal contextï¼‰1.1 æµè§ˆå™¨ä¸­ï¼ŒthisæŒ‡å‘windowindex.js1console.log(this) // window; 1.2 åœ¨nodejsä¸­ï¼ŒthisæŒ‡å‘ globalindex.js1console.log(this) // global; 2.å‡½æ•°ä½œç”¨åŸŸåœ¨å‡½æ•°å†…éƒ¨ï¼Œthisç”±å‡½æ•°å¦‚ä½•è°ƒç”¨æ¥ç¡®å®šæŒ‡å‘ 2.1 ä½œä¸ºå‡½æ•°è°ƒç”¨ä½œä¸ºå‡½æ•°è°ƒç”¨æ—¶ï¼Œthiså¹¶æ²¡æœ‰é€šè¿‡callæŒ‡å®šï¼Œä½†thiså¿…é¡»æŒ‡å®šå¯¹è±¡ï¼Œå› æ­¤é»˜è®¤æŒ‡å‘windowï¼Œæ‰€ä»¥è°ƒç”¨foo()è¾“å‡º1ã€‚index.js12345function foo() &#123; return this.a;&#125;var a = 1;console.log(foo()); // 1 åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthisä¼šä¿æŒåœ¨è¿›å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ—¶æ‰€è®¾ç½®çš„æŒ‡å‘ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®ï¼Œé»˜è®¤æŒ‡å‘undefinedã€‚ index.js12345678910111213function fn() &#123; 'use strict' return this;&#125;console.log(fn()); //undefinedfunction foo() &#123; 'use strict' return this.a;&#125;var a = 1;console.log(foo()); // TypeError: Cannot read property 'a' of undefined 2.2 å¯¹è±¡æ–¹æ³•è°ƒç”¨å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ—¶ï¼ŒthisæŒ‡å‘è¯¥å¯¹è±¡ã€‚ index.js1234567const animal = &#123; name: \"animal\", sayName: function() &#123; console.log(this.name); &#125;&#125;;animal.sayName(); // animal åŸå‹é“¾ä¸Šçš„æ–¹æ³•è°ƒç”¨ä¸å¯¹è±¡æ–¹æ³•è°ƒç”¨ä¸€æ ·ï¼ŒthisæŒ‡å‘å¯¹è±¡æ–¹æ³•è°ƒç”¨æ—¶çš„å¯¹è±¡ã€‚ index.js12345678910function Person(name, age) &#123; this.name = name; this.age = age; &#125;Person.prototype.getName = function() &#123; return this.name;&#125;var p1 = new Person(â€˜Kenâ€™, 20);p1.getName(); // Ken ä¸‹é¢è®²new è°ƒç”¨æ„é€ å‡½æ•°æ‰€å‘ç”Ÿçš„äº‹ã€‚ 2.3 æ„é€ å‡½æ•°è°ƒç”¨æ„é€ å‡½æ•°è°ƒç”¨ï¼ŒthisæŒ‡å‘å½“å‰å®ä¾‹å¯¹è±¡ã€‚ index.js1const a = new foo(); // thisæŒ‡å‘a; newè°ƒç”¨æ„é€ å‡½æ•°ï¼š 1ã€åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ 2ã€å°†æ–°å¯¹è±¡çš„åŸå‹è®¾ç½®ä¸ºæ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡prototype 3ã€æ‰§è¡Œæ„é€ å‡½æ•°ï¼Œå°†thisæŒ‡å‘æ–°å¯¹è±¡ 4ã€è¿”å›è¿™ä¸ªæ–°å¯¹è±¡ æ¨¡æ‹Ÿå®ç°ï¼š new.js123456789101112131415161718192021222324function create() &#123; let obj = new Object(); //ä»Object.prototypeä¸Šå…‹éš†ä¸€ä¸ªå¯¹è±¡ //let obj = &#123;&#125;; let Constructor = [].shift.call(arguments); //è·å–ä¼ å…¥çš„æ„é€ å‡½æ•° obj.proto = Constructor.prototype; // å°†æ–°å¯¹è±¡çš„protoæŒ‡å‘æ„é€ å‡½æ•°çš„prototype let result = Constructor.apply(obj, arguments); // å°†thisæŒ‡å‘æ–°å¯¹è±¡,å¹¶æ‰§è¡Œæ„é€ å‡½æ•° return result instanceof Object ? result : obj; // ç¡®ä¿è¿”å›çš„æ˜¯å¯¹è±¡&#125;function animal(name, fit) &#123; this.name = name; this.fit = fit;&#125;animal.prototype.sayName = function() &#123; console.log(this.name);&#125;;const pig = create(animal, â€œKenâ€, 12);pig.sayName(); // Ken 2.4 applyã€callã€bind2.4.1 applyã€callcallï¼š ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„thiså’Œè‹¥å¹²æŒ‡å®šå‚æ•°çš„å‰æä¸‹ï¼Œè°ƒç”¨æŸä¸ªå‡½æ•°æˆ–æ–¹æ³•ã€‚applyï¼š ä¸callç±»ä¼¼ï¼Œåªæ˜¯æä¾›å‚æ•°çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œapplyçš„å‚æ•°æ˜¯æ•°ç»„ã€‚ 12345678910function sum(c, d) &#123; return this.a + this.b + c + d;&#125;const obj = &#123; a: 1, b: 2&#125;;console.log(sum.call(obj, 1, 2)); // 6console.log(sum.apply(obj, [3, 4])); // 10 2.4.2 bind bindï¼š æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨bind()è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„thisè¢«bindçš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šï¼Œå…¶ä½™çš„å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚ MDN: https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind ä¸apply,call ä¸åŒçš„æ˜¯ï¼Œbind è¿”å›ä¸€ä¸ªåŸå‡½æ•°çš„æ‹·è´ã€‚ 123456789101112var a = 10;const module = &#123; a:1, getA:function() &#123; return this.a; &#125;&#125;module.getA(); // 1; å¯¹è±¡æ–¹æ³•è°ƒç”¨ï¼Œ`this`æŒ‡å‘moduleconst getValueA = module.getA;getValueA(); // 10 å…¨å±€ä½œç”¨åŸŸä¸­è°ƒç”¨getA()ï¼Œæ‰€ä»¥è¿™é‡Œè¾“å‡º10.const fn = getValueA.bind(module); //æŠŠ 'this' ç»‘å®šåˆ° module å¯¹è±¡fn(); // 1 å¦‚æœå°†null/undefinedä½œä¸ºthisä¼ å…¥ï¼Œåœ¨è¢«è°ƒç”¨çš„æ—¶å€™ä¼šè¢«å¿½ç•¥ï¼Œä½¿ç”¨é»˜è®¤ç»‘å®šï¼ˆwindowï¼‰ã€‚å¯ä»¥ä¼ {}è®©thisä¸ºç©ºã€‚ æ— è®ºbind()å¤šå°‘æ¬¡ï¼Œthisçš„æŒ‡å‘æ°¸è¿œç”±ç¬¬ä¸€å†³å®šã€‚ 2.5 ç®­å¤´å‡½æ•° ç®­å¤´å‡½æ•°çš„thisç»§æ‰¿äºåŒ…è£¹å®ƒçš„ç¬¬ä¸€ä¸ªæ™®é€šå‡½æ•°çš„thisï¼Œå¦‚æœæ²¡æœ‰æ™®é€šå‡½æ•°ï¼Œåˆ™ä¸ºå…¨å±€å¯¹è±¡ã€‚ ç®­å¤´å‡½æ•°çš„thisåœ¨ç¬¬ä¸€æ¬¡ç»‘å®šåå°±ä¸ä¼šå†æ”¹å˜ã€‚ ä¸èƒ½ä½¿ç”¨newæ¥è°ƒç”¨ 1234567891011121314151617181920212223242526function fn() &#123; return () =&gt; &#123; return () =&gt; &#123; console.log(this) &#125; &#125;&#125;console.log(fn()()()) // Windowvar name = \"Ken\"const module = &#123; name: \"module\", getName: function() &#123; const fn = ()=&gt; &#123; console.log(this.name) &#125; fn(); &#125;, // å¤–å±‚æ²¡æœ‰æ™®é€šå‡½æ•°åŒ…è£¹ï¼Œå› æ­¤`this`æŒ‡å‘å…¨å±€ä½œç”¨åŸŸ arrowFn: ()=&gt; &#123; console.log(this.name) &#125;&#125;module.getName(); // modulemodule.arrowFn(); // ken æ€»ç»“thisçš„ç»‘å®šè§„åˆ™å¯ä»¥åˆ†ä¸º newç»‘å®š æ˜¾ç¤ºç»‘å®šï¼šcallã€applyã€bind éšå¼ç»‘å®šï¼šä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨ é»˜è®¤ç»‘å®šï¼šå‡½æ•°è°ƒç”¨ ä¼˜å…ˆçº§ï¼šnew &gt; callã€applyã€bind &gt; obj.fn() &gt; fn()","link":"/2019/03/22/æ‹¾é—JavaScriptâ€”â€”this/"},{"title":"æ‹¾é—JavaScriptâ€”â€”var-let-const","text":"å˜é‡çš„å£°æ˜æ–¹å¼varå£°æ˜å±€éƒ¨å˜é‡å’Œå…¨å±€å˜é‡ã€‚ letå£°æ˜ä¸€ä¸ªå—çº§ä½œç”¨åŸŸçš„å±€éƒ¨å˜é‡ã€‚ constå£°æ˜ä¸€ä¸ªå—çº§ä½œç”¨åŸŸçš„åªè¯»å¸¸é‡(éœ€è¦åˆå§‹å€¼)ã€‚ å˜é‡æå‡12console.log(a);var a = 1; // undefined å®é™…ä¸Šä¸Šéƒ¨åˆ†çš„ä»£ç å¯ä»¥ç†è§£ä¸º: 123var a;console.log(a);a = 1; è¿™å°±æ˜¯å˜é‡æå‡ã€‚ å¯¹äºå‡½æ•°æ¥è¯´ï¼Œåªæœ‰å‡½æ•°å£°æ˜ä¼šè¢«æå‡åˆ°é¡¶éƒ¨ï¼Œè€Œå‡½æ•°è¡¨è¾¾å¼ä¸ä¼šè¢«æå‡ã€‚ 12345baz(); // baz is not a functionvar baz = function() &#123; console.log(\"bar2\");&#125;; æš‚æ—¶æ€§æ­»åŒºletï¼ˆconstï¼‰å°†ä¸ä¼šæå‡å˜é‡åˆ°ä»£ç å—çš„é¡¶éƒ¨ã€‚å› æ­¤ï¼Œåœ¨å˜é‡å£°æ˜ä¹‹å‰å¼•ç”¨è¿™ä¸ªå˜é‡ï¼Œå°†æŠ›å‡ºå¼•ç”¨é”™è¯¯ï¼ˆReferenceErrorï¼‰ã€‚è¿™ä¸ªå˜é‡å°†ä»ä»£ç å—ä¸€å¼€å§‹çš„æ—¶å€™å°±å¤„åœ¨ä¸€ä¸ªâ€œæš‚æ—¶æ€§æ­»åŒºâ€ï¼Œç›´åˆ°è¿™ä¸ªå˜é‡è¢«å£°æ˜ä¸ºæ­¢ã€‚ 12console.log(a);let a = 1; //a is not defined","link":"/2019/03/27/æ‹¾é—JavaScriptâ€”â€”var-let-const/"},{"title":"Hola","text":"å¿ƒæƒ…ä¸å¥½ï½å†™ç‚¹ä»€ä¹ˆâ€¦","link":"/2019/03/01/Hola/"},{"title":"æ‹¾é—JavaScriptâ€”â€”æ·±ã€æµ…æ‹·è´","text":"æ•°æ®ç±»å‹JavaScript ä¸­å˜é‡çš„æ•°æ®ç±»å‹åˆ†ä¸¤ç§ï¼š åŸºæœ¬ç±»å‹ ï¼ˆå­˜å‚¨ä¸æ ˆå†…å­˜ä¸­ï¼Œå€¼å­˜å‚¨ï¼‰ å¼•ç”¨ç±»å‹ ï¼ˆå­˜å‚¨å †å†…å­˜ä¸­ï¼Œé€šè¿‡æŒ‡é’ˆå»å¯»æ‰¾æ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´ï¼‰ å¯¹äºå€¼ç±»å‹çš„å¤åˆ¶æ“ä½œæ˜¯ç›´æ¥å †å˜é‡çš„å€¼è¿›è¡Œæ‹·è´ï¼›å¯¹äºå¼•ç”¨ç±»å‹çš„å¤åˆ¶æ“ä½œæ˜¯å¯¹å­˜å‚¨å˜é‡çš„æŒ‡é’ˆè¿›è¡Œæ‹·è´ï¼ŒæŒ‡å‘åŒä¸€å†…å­˜ç©ºé—´ï¼Œä¿®æ”¹å…¶ä¸­ä¸€ä¸ªä¼šå½±å“å¦ä¸€æ–¹ã€‚ æ·±æµ…æ‹·è´åªé’ˆå¯¹äº Arrayã€Object è¿™æ ·å¤æ‚çš„å¯¹è±¡ æµ…æ‹·è´åªæ‹·è´åŸºæœ¬ç±»å‹çš„æ•°æ®ï¼Œå¯¹äºå¼•ç”¨çš„ç±»å‹æ•°æ®ï¼Œå¤åˆ¶åä¹Ÿæ˜¯ä¼šå‘ç”Ÿå¼•ç”¨ï¼Œè¿™ç§æ‹·è´å°±å«åšæµ…æ‹·è´ ğŸŒ°ï¼š å¯¹äºå¯¹è±¡æ¥è¯´ï¼Œå¯ä»¥é€šè¿‡Object.assign()ã€...æ¥å®ç°æµ…æ‹·è´1ã€Object.assign()1234567let obj = &#123; name: \"ken\"&#125;;let newObj = Object.assign(&#123;&#125;, obj);obj.name = \"obi\";console.log(obj.name); // name:obiconsole.log(newObj.name); // name: ken 2ã€...å±•å¼€è¿ç®—ç¬¦123456789let obj = &#123; name: \"ken\"&#125;;let newObj = &#123; ...obj&#125;;obj.name = \"obi\";console.log(obj.name); // name:obiconsole.log(newObj.name); // name: ken ğŸŒ°ï¼šå¯¹äºæ•°ç»„ï¼Œå¯ä»¥é€šè¿‡concat()ã€slice() æ¥å®ç°æµ…æ‹·è´1ã€concat()concat() æ–¹æ³•ç”¨äºåˆå¹¶ä¸¤ä¸ªæˆ–å¤šä¸ªæ•°ç»„ã€‚æ­¤æ–¹æ³•ä¸ä¼šæ›´æ”¹ç°æœ‰æ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ã€‚concat æ–¹æ³•ä¸ä¼šæ”¹å˜ this æˆ–ä»»ä½•ä½œä¸ºå‚æ•°æä¾›çš„æ•°ç»„ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªæµ…æ‹·è´ï¼Œå®ƒåŒ…å«ä¸åŸå§‹æ•°ç»„ç›¸ç»“åˆçš„ç›¸åŒå…ƒç´ çš„å‰¯æœ¬ã€‚ åŸå§‹æ•°ç»„çš„å…ƒç´ å°†å¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/concat 12345let arr = [1, 2, 3];let newArr = arr.concat();arr.push(4);console.log(arr); //[1,2,3,4]console.log(newArr); //[1,2,3] 2ã€slice()slice() æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„æ•°ç»„å¯¹è±¡ï¼Œè¿™ä¸€å¯¹è±¡æ˜¯ä¸€ä¸ªç”± begin å’Œ endï¼ˆä¸åŒ…æ‹¬ endï¼‰å†³å®šçš„åŸæ•°ç»„çš„æµ…æ‹·è´ã€‚åŸå§‹æ•°ç»„ä¸ä¼šè¢«æ”¹å˜ã€‚ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Array/slice 12345let arr = [1, 2, 3];let newArr = arr.slice();arr.push(4);console.log(arr); //[1,2,3,4]console.log(newArr); //[1,2,3] å½“é¢å¯¹å¤æ‚ä¸€ç‚¹çš„å¯¹è±¡æˆ–è€…æ•°ç»„ï¼Œä½¿ç”¨ Object.assign(),Array.slice() ä¼šæ€ä¹ˆæ ·ï¼Ÿä¾‹å¦‚:1234567891011121314let obj = &#123; a: 1, b: 2, c: &#123; d: 1, e: 2 &#125;&#125;;let newObj = Object.assign(&#123;&#125;, obj);obj.a = 2;newObj.c.d = 2;console.log(obj); // &#123;a:2,b:2,c:&#123;d:2,e:2&#125;&#125;console.log(newObj); // &#123;a:1,b:2,c:&#123;d:2,e:2&#125;&#125; 12345678let arr = [1, 2, [1, 2], 3];let newArr = arr.concat();arr.push(4);arr[2].push(3);console.log(arr); //[1,2,[1,2,3],3,4]console.log(newArr); //[1,2,[1,2,3],3] ä»£ç é‡Œä¿®æ”¹äº†obj.açš„å€¼ï¼Œå¹¶æ²¡å¯¹newObjé€ æˆå½±å“ï¼Œè€Œä¿®æ”¹äº†newObj.c.dçš„å€¼ï¼Œobj.c.dçš„å€¼ä¹Ÿéšç€æ”¹å˜ã€‚è¿™æ˜¯å› ä¸ºObject.assign()æ˜¯æµ…æ‹·è´ï¼Œåªæ‹·è´äº†ä¸€å±‚ï¼Œå¯¹äºobj.cæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ‰€ä»¥newObj.cå­˜å‚¨çš„æ˜¯æŒ‡å‘obj.cæ‰€æŒ‡å‘çš„æŒ‡é’ˆåœ°å€ã€‚åŒç†...å±•å¼€è¿ç®—ç¬¦ã€Array.concat()/Array.slice() æ·±æ‹·è´è§£å†³ä¸Šè¿°é—®é¢˜æœ€å¸¸è§çš„å®ç°æ–¹å¼å°±æ˜¯ï¼šJSON.parse(JSON.stringify(object)) 123456789101112131415let obj = &#123; a: 1, b: 2, c: &#123; d: 1, e: 2 &#125;&#125;;let newObj = JSON.parse(JSON.stringify(obj));obj.a = 2;newObj.c.d = 2;console.log(obj); //&#123;a:2,b:2,c:&#123;d:1,e:2&#125;&#125;console.log(newObj); //&#123;a:1,b:2,c:&#123;d:2,e:2&#125;&#125; å½“ç„¶ï¼Œå¯¹è±¡çš„åºåˆ—åŒ–ååºåˆ—åŒ–JSON.parse(JSON.stringify())å¹¶ä¸æ˜¯ä¸‡èƒ½çš„ã€‚ å¿½ç•¥ undefined å¿½ç•¥ symbol ä¸èƒ½åºåˆ—åŒ–å‡½æ•° ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„å¯¹è±¡ https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify 12345678910111213141516171819202122232425let obj = &#123; a: () =&gt; &#123; console.log(\"copy\"); &#125;, b: undefined, c: Symbol, d: \"obi\"&#125;;let newObj = JSON.parse(JSON.stringify(obj));console.log(newObj); // &#123;d:obi&#125; å¿½ç•¥undefinedã€symbolã€ä¸èƒ½åºåˆ—åŒ–åŒ–å‡½æ•°let obj = &#123; a: 1, b: &#123; c: 2 &#125;&#125;;obj.c = obj.b; // `obj.c` å¼•ç”¨ `obj.b`obj.b.c = obj.c; // `obj.b.c` åˆå¼•ç”¨ `obj.c`let newObj = JSON.parse(JSON.stringify(obj));console.log(newObj); // ç›´æ¥æŠ¥é”™ å®ç°ç®€æ˜“çš„æµ…æ‹·è´ã€æ·±æ‹·è´æµ…æ‹·è´1234567891011121314151617181920const fn = (data, target = &#123;&#125;) =&gt; &#123; for (let item in data) &#123; if (data.hasOwnProperty(item)) &#123; target[item] = data[item]; &#125; &#125; return target;&#125;;let obj = &#123; a: 1, b: 2&#125;;let newObj = fn(obj);obj.a = 2;console.log(obj); //&#123;a:2,b:2&#125;console.log(newObj); //&#123;a:1,b:2&#125; æµ…æ‹·è´å°±æ˜¯ä¸€ä¸ªfor..inå¾ªç¯,Object.prototype.hasOwnPropertyçš„ä½œç”¨æ˜¯æ£€æµ‹ç›®æ ‡æ˜¯å¦å±äºè‡ªæœ‰å±æ€§,æ˜¯åˆ™å¤åˆ¶ æ·±æ‹·è´123456789101112131415161718192021222324252627282930const isObj = o =&gt; &#123; return typeof o === \"object\" || (typeof o === \"function\" &amp;&amp; o !== null);&#125;;const deepClone = obj =&gt; &#123; if (!isObj(obj)) &#123; throw new Error(\"not a Objectï¼\"); &#125; let newObj = Array.isArray(obj) ? [] : &#123;&#125;; // åˆ¤æ–­æ˜¯å¦æ˜¯æ•°ç»„æˆ–è€…æ˜¯å¯¹è±¡,è®¾ç½®åˆå§‹å€¼ä¸ºç©ºå€¼ Object.keys(obj).forEach(key =&gt; &#123; newObj[key] = isObj(obj[key]) ? deepClone(obj[key]) : obj[key]; &#125;); return newObj;&#125;;let obj = &#123; a: [1, 2, 3], b: &#123; c: 2, d: 3 &#125;&#125;;let newObj = deepClone(obj);newObj.b.c = 1;console.log(obj.b.c); // 2console.log(newObj.b.c); // 1 è¿™åªæ˜¯ç®€å•çš„æ·±æ‹·è´ï¼Œæœªè€ƒè™‘å…¶ä»–æƒ…å†µï¼Œå…¶ä½™å¦åšæ¢ç©¶ã€‚ å‚è€ƒæ¥è‡ª Googleã€MDN","link":"/2019/03/05/æ‹¾é—JavaScriptâ€”â€”æ·±ã€æµ…æ‹·è´/"},{"title":"æ‹¾é—webpack4ï¼ˆä¸€ï¼‰â€”â€”å…¥é—¨","text":"webpack4 åˆä½“éªŒwebpack æ˜¯ä¸€ä¸ªç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨æ„å»ºä¸€ä¸ª ä¾èµ–å›¾(dependency graph)ï¼Œæ­¤ä¾èµ–å›¾ä¼šæ˜ å°„é¡¹ç›®æ‰€éœ€çš„æ¯ä¸ªæ¨¡å—ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚ ä» 4.0 ç‰ˆæœ¬å¼€å§‹ï¼Œwebpack æŠ›å¼ƒä»¥å‰ç‰ˆæœ¬çš„é‚£ç§ç¹çã€æ™¦æ¶©ä»¤åˆå­¦è€…æ€¯æ­¥çš„é…ç½®æ–‡ä»¶ï¼Œå¼€å§‹é›¶é…ç½®é æ‹¢ï¼› è¿™æ— ç–‘å¯¹äºåˆå­¦è€…æ¥è¯´ï¼Œäº²å’ŒåŠ›ä¸Šäº†ä¸€å±‚æ¥¼ã€‚ ä½†å®ƒä»ç„¶å…·æœ‰å¯é…ç½®æ€§æ»¡è¶³å¤šç§éœ€æ±‚ã€‚ åœ¨å¼€å§‹ä¹‹å‰å…ˆäº†è§£æ ¸å¿ƒæ¦‚å¿µ å…¥å£ï¼ˆentryï¼‰ è¾“å‡ºï¼ˆoutputï¼‰ loader æ’ä»¶ï¼ˆpluginï¼‰ æ¨¡å¼ï¼ˆmodeï¼‰ æµè§ˆå™¨å…¼å®¹æ€§ï¼ˆbowser compatibilityï¼‰ é¡¹ç›®æ­å»ºåˆ›å»ºç©ºæ–‡ä»¶å¤¹ webpack_demoï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ç”Ÿæˆ package.json 1npm init æˆ–è€… npm init -y Tip-y å‚æ•°è¡¨ç¤ºæ‰€æœ‰ package.json å‚ä¸ºé»˜è®¤ å¼•å…¥ webpack 1npm install webpack --save-dev è¿™é‡Œè¿˜éœ€è¦ä½¿ç”¨ webpack-cli è„šæ‰‹æ¶ 1npm install webpack-cli --save-dev æŸ¥çœ‹ package.json æ–‡ä»¶å¯ä»¥çœ‹åˆ°ç›®å‰ä½¿ç”¨çš„ç‰ˆæœ¬ 12345\"devDependencies\": &#123; \"webpack\": \"^4.30.0\", \"webpack-cli\": \"^3.3.0\" &#125; æ¥ä¸‹æ¥åœ¨ packege.json ä¸­å¢åŠ  npm scripts 12345\"scripts\": &#123; \"build\": \"webpack\", \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125; åˆ°è¿™é‡ŒåŸºæœ¬çš„é¡¹ç›®æ­å»ºå®Œæ¯•ï¼Œè¿è¡Œ npm run build å‘½ä»¤çœ‹çœ‹æ•ˆæœã€‚ ä»å›¾ç‰‡é‡Œçš„æŠ¥é”™ä¿¡æ¯å¯ä»¥å¾—çŸ¥ï¼šâ€œæœªèƒ½æ‰¾åˆ°å…¥å£æ–‡ä»¶â€ å›åˆ°æ–‡ç« å¼€å§‹è®²çš„ï¼šwebpack ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼šå…¥å£(entry) å…¥å£(entry)å…¥å£èµ·ç‚¹(entry point)æŒ‡ç¤º webpack åº”è¯¥ä½¿ç”¨å“ªä¸ªæ¨¡å—ï¼Œæ¥ä½œä¸ºæ„å»ºå…¶å†…éƒ¨ ä¾èµ–å›¾(dependency graph) çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£èµ·ç‚¹åï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„ã€‚ https://webpack.docschina.org/concepts/#%E5%85%A5%E5%8F%A3-entry- webpack çš„å…¥å£é»˜è®¤æ˜¯ .src/index.js ,ä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡ webpack.config.js ä¸­å»é…ç½®æŒ‡å®šå…·ä½“çš„å…¥å£èµ·ç‚¹ã€‚ webpack.config.js 12345module.exports = &#123; entry: &#123; app: \"./app.js\" &#125;&#125;; ç°åœ¨æ–°å»ºä¸€ä¸ªsrcç›®å½•å¹¶æ·»åŠ å…¥å£æ–‡ä»¶ index.js è¿è¡Œnpm run build,å¯ä»¥çœ‹åˆ°æ§åˆ¶å°è¾“å‡ºæ‰“åŒ…æˆåŠŸ å¹¶åœ¨ç›®å½•ä¸‹åˆ›å»ºäº†distæ–‡ä»¶å¤¹å’Œé‡Œé¢å·²ç»æ‰“åŒ…å‹ç¼©å¥½çš„æ–‡ä»¶main.js è¿™é‡Œè®²ä¸€ä¸ª webpack çš„ä¸€ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼šè¾“å‡ºï¼ˆoutputï¼‰ è¾“å‡º(output)output å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundleï¼Œä»¥åŠå¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶ã€‚ä¸»è¦è¾“å‡ºæ–‡ä»¶çš„é»˜è®¤å€¼æ˜¯ ./dist/main.jsï¼Œå…¶ä»–ç”Ÿæˆæ–‡ä»¶é»˜è®¤æ”¾ç½®åœ¨ ./dist æ–‡ä»¶å¤¹ä¸­ã€‚ https://webpack.docschina.org/concepts/#%E5%85%A5%E5%8F%A3-entry- åŒæ ·æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨webpack.config.js ä¸­å»è‡ªå®šä¹‰è¾“å‡ºç‚¹(output) webpack.config.js 1234567module.exports = &#123; output: &#123; publicPath: __dirname + \"/dist/\", // js å¼•ç”¨çš„è·¯å¾„æˆ–è€…CDNåœ°å€ path: path.resolve(__dirname, \"dist\"), // æ‰“åŒ…æ–‡ä»¶çš„è¾“å‡ºç›®å½• filename: \"bundle.js\" // æ‰“åŒ…åç”Ÿäº§çš„jsæ–‡ä»¶ &#125;&#125;; æ¨¡å¼(mode)å‰é¢è¿è¡Œnpm run build çš„è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶æ‰“åŒ…æˆåŠŸï¼Œä½†æ˜¯æ§åˆ¶å°è¿˜è¾“å‡ºå‡ è¡Œè­¦å‘Šä¿¡æ¯: â€œæ²¡æœ‰è®¾ç½® mode optionâ€ è¿™é‡Œå°±è¦è®²åˆ° webpack ä¸­çš„ä¸€ä¸ªæ ¸å¿ƒç‚¹ï¼šmodeï¼Œ production development æˆ‘ä»¬å¯ä»¥åœ¨npm scripts ä¸­å‘Šè¯‰webpack-cli ä»¥ä»€ä¹ˆæ ·çš„ mode å»æ„å»ºä¾‹å¦‚: 1234567&#123; \"scripts\": &#123; \"dev\": \"webpack --mode development\", \"build\": \"webpack --mode production\", \"test\": \"echo \\\"Error: no test specified\\\" &amp;&amp; exit 1\" &#125;&#125; æˆ–è€…åœ¨webpack.config.jsä¸­è®¾ç½® 123module.exports = &#123; mode: \"production\"&#125;; å¦‚æœä¸è®¾ç½®çš„è¯ï¼Œé»˜è®¤modeä¸ºproduction ç°åœ¨æˆ‘ä»¬æ¥çœ‹çœ‹ä¸¤ä¸­æ¨¡å¼ä¸‹çš„ç®€å•åŒºåˆ« æ‰§è¡Œ npm run dev æ‰§è¡Œ npm run build é€šè¿‡å¯¹æ¯”ï¼Œåœ¨ dev æ¨¡å¼ä¸‹ï¼Œjs æ–‡ä»¶æ²¡æœ‰è¢«å‹ç¼© ä¸€ä¸ªå®Œæ•´çš„ Web é¡¹ç›®é™¤äº† js è„šæœ¬æ–‡ä»¶ï¼Œåº”è¯¥è¿˜åŒ…å«æœ‰ CSSã€HTML ä»¥åŠå…¶ä»–èµ„æºï¼Œå¦‚å›¾ç‰‡ã€å­—ä½“ç­‰;é‚£ä¹ˆåœ¨ webpack ä¸­å¦‚ä½•å»å¤„ç†è¿™äº›èµ„æºå‘¢ï¼Ÿé¦–å…ˆä»å¤„ç† CSS å¼€å§‹ loaderwebpack åªèƒ½ç†è§£ JavaScript å’Œ JSON æ–‡ä»¶ã€‚loader è®© webpack èƒ½å¤Ÿå»å¤„ç†å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæœ‰æ•ˆ æ¨¡å—ï¼Œä»¥ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œä»¥åŠè¢«æ·»åŠ åˆ°ä¾èµ–å›¾ä¸­ã€‚ https://webpack.docschina.org/concepts/#loader 1ã€æ·»åŠ style.css2ã€å¤„ç† css éœ€è¦å®‰è£…ä»¥ä¸‹ loader é…åˆä½¿ç”¨ï¼Œæ‰§è¡Œnpm i --save-dev style-loader css-loader css-loaderï¼šè§£æ CSS ä»£ç ï¼Œå¤„ç† CSS ä¸­çš„ä¾èµ–ï¼ˆ@importã€url()ç­‰ï¼‰ style-loaderï¼šå°†css-loaderè§£æç»“æœè½¬å˜ä¸º js å¹¶åŠ¨æ€æ’å…¥ style æ ‡ç­¾ 123456\"devDependencies\": &#123; \"css-loader\": \"^2.1.1\", \"style-loader\": \"^0.23.1\", \"webpack\": \"^4.30.0\", \"webpack-cli\": \"^3.3.0\" &#125; 3ã€é…ç½®webpack.config.js 12345678910module.exports = &#123; module: &#123; rules: [ &#123; test: /\\.css$/, use: [\"style-loader\", \"css-loader\"] &#125; ] &#125;&#125;; 4ã€style.css 123.hola &#123; color: blue;&#125; 5ã€åœ¨index.jsä¸­ å¼•å…¥style.css 1import \"./style.css\"; 6ã€æ‰§è¡Œnpm run build 7ã€åœ¨index.htmlä¸­å¼•å…¥æ‰“åŒ…å¥½çš„æ–‡ä»¶bundle.js 8ã€åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ index.html,åœ¨æ§åˆ¶å°å¯ä»¥çœ‹åˆ° css æ ·å¼å·²ç»é€šè¿‡&lt;style&gt; æ ‡ç­¾æ³¨å…¥ å¤„ç†sassã€lessï¼Œå¯ä»¥ä½¿ç”¨less-loader\\sass-loader æ’ä»¶ï¼ˆpluginï¼‰åœ¨ html æ–‡ä»¶ä¸­å¼•å…¥æ‰“åŒ…å¥½åçš„ js æ–‡ä»¶ï¼Œå¦‚æœæ›´æ”¹äº†æ‰“åŒ…åçš„æ–‡ä»¶åç§°æˆ–è€…ä»£ç åˆ†å‰²æˆå¤šä¸ªæ–‡ä»¶ï¼Œåˆè¦å»ä¸€ä¸ªä¸ªå¼•å…¥ï¼Œç”šæ˜¯éº»çƒ¦ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨html-webpack-pluginï¼Œæ‰“åŒ…å®Œä¹‹åè‡ªåŠ¨ç”Ÿæˆ HTML æ–‡ä»¶ï¼Œå¹¶è‡ªåŠ¨å¼•å…¥æ‰“åŒ…åçš„ js æ–‡ä»¶ã€‚ 1ã€æ‰§è¡Œnpm i html-webpack-plugin html-loader --save-dev2ã€é…ç½®webpack.config.js3ã€æ‰§è¡Œnpm run build4ã€åœ¨distæ–‡ä»¶å¤¹ä¸‹æ‰“å¼€index.html è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨å‰ï¼Œè¿™é‡Œè¦æŠŠwebpackçš„outputæ”¹ä¸ºç›¸å¯¹è·¯å¾„publicPath:&#39;./&#39;","link":"/2019/03/02/æ‹¾é—webpack4ï¼ˆä¸€ï¼‰â€”â€”å…¥é—¨/"},{"title":"æ‹¾é—webpack4ï¼ˆä¸‰ï¼‰â€”â€”å¤„ç†å›¾ç‰‡","text":"","link":"/2019/03/05/æ‹¾é—webpack4ï¼ˆä¸‰ï¼‰â€”â€”å¤„ç†å›¾ç‰‡/"},{"title":"æ‹¾é—webpack4ï¼ˆäºŒï¼‰â€”â€”Babel","text":"BabelBabel æ˜¯ä»€ä¹ˆï¼Ÿä¸»è¦ç”¨äºå°† ECMAScript 2015+ ç‰ˆæœ¬çš„ä»£ç è½¬æ¢ä¸ºå‘åå…¼å®¹çš„ JavaScript è¯­æ³•ï¼Œä»¥ä¾¿èƒ½å¤Ÿè¿è¡Œåœ¨å½“å‰å’Œæ—§ç‰ˆæœ¬çš„æµè§ˆå™¨æˆ–å…¶ä»–ç¯å¢ƒä¸­ã€‚ 1ã€æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…æ‰€éœ€è¦çš„ package 12npm install --save-dev babel-loader @babel/core @babel/preset-envnpm install --save @babel/polyfill babel-loader : è¿™æ˜¯ Webpack çš„ Babel æ’ä»¶ï¼Œå®ƒå°†è¢«æ·»åŠ åˆ° Webpack é…ç½®ä¸­ï¼Œä»¥æŒ‡ç¤ºå®ƒåœ¨æ†ç»‘è¿‡ç¨‹ä¸­é€šè¿‡ Babel è¿è¡Œç›®æ ‡æ–‡ä»¶ï¼› @babel/core @babel/preset-envï¼šé€šè¿‡æ ¹æ®ç›®æ ‡æµè§ˆå™¨æˆ–è¿è¡Œæ—¶ç¯å¢ƒè‡ªåŠ¨ç¡®å®šæ‰€éœ€çš„ Babel æ’ä»¶å’Œ polyfillï¼Œå°†ä»£ç ç¼–è¯‘ä¸º ES5 @babel/polyfillï¼šå«ç‰‡ï¼Œè½¬åŒ– ES6 å†…ç½®è¯­æ³•ï¼ˆArray.from,Object.assign ç­‰ï¼‰ 1234567891011\"devDependencies\": &#123; \"@babel/core\": \"^7.4.3\", \"@babel/preset-env\": \"^7.4.3\", \"babel-loader\": \"^8.0.5\", \"clean-webpack-plugin\": \"^2.0.1\", \"webpack\": \"^4.30.0\", \"webpack-cli\": \"^3.3.0\" &#125;, \"dependencies\": &#123; \"@babel/polyfill\": \"^7.4.3\" &#125; 2ã€æ–°å»º babel é…ç½®æ–‡ä»¶.babelrc æ¥é…ç½® babel 123&#123; \"presets\": [\"@babel/preset-env\"]&#125; 3ã€åœ¨webpack.config.jsä¸­é…ç½® babel-loader 123456789module: &#123; rules: [ &#123; test: /\\.js$/, //åŒ¹é…jsæ–‡ä»¶ exclude: /node_modules/, //å¿½ç•¥ç›®æ ‡æ–‡ä»¶å¤¹ loader: \"babel-loader\" // ä½¿ç”¨babel-loader &#125; ];&#125; 4ã€éªŒè¯ åœ¨ index.js ä¸­ä½¿ç”¨ ES6 è¯­æ³• 12345// import '@babel/polyfill'const arr = [\"1\", \"2\", \"3\"];const fn = () =&gt; console.log(...arr);fn(); è¿™é‡Œè¿˜éœ€è¦import &#39;@babel/polyfill&#39;å…¨å±€å¼•å…¥æ‰“åŒ…åä½“ç§¯å¤§ã€æ ¹æ®éœ€è¦è½¬è¯‘çš„æ–‡ä»¶æŒ‰éœ€å¼•ç”¨åˆå¾ˆéº»çƒ¦ï¼Œè¿™é‡Œåªéœ€è¦é…ç½®ä¸€ä¸‹babelrcï¼Œbabel è‡ªåŠ¨è½¬è¯‘ .babelrc1234567891011&#123; \"presets\": [ [ \"@babel/preset-env\", &#123; \"useBuiltIns\": \"usage\", \"corejs\": \"3\" //ä½¿ç”¨core-js@3ç‰ˆæœ¬ &#125; ] ]&#125; è¿™é‡Œé‡åˆ°ä¸€ä¸ªå°å‘ï¼Œé…ç½®å®Œ.babelrcåæ‰§è¡Œnpm run buildï¼Œæ§åˆ¶å°é¦–å…ˆä¼šæç¤ºä¸€æ®µè­¦å‘Š: å¤§æ¦‚æ„æ€å°±æ˜¯æŒ‡å®šç”¨ä»€ä¹ˆç‰ˆæœ¬çš„core-js,é»˜è®¤ä½¿ç”¨core-js@2ç‰ˆæœ¬ ç„¶åæŠ¥é”™ è¿™é‡Œé…ç½®ä¸€ä¸‹core-jsçš„ç‰ˆæœ¬ æ‰§è¡Œnpm run build æµè§ˆå™¨ä¸­æ‰“å¼€distæ–‡ä»¶å¤¹ä¸‹çš„index.htmlï¼ŒæŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºã€‚ Chrome æœ€æ–°ç‰ˆæ˜¯æ”¯æŒ ES6 è¯­æ³•çš„ï¼Œæœ€å¥½çš„è¿˜æ˜¯åœ¨ IE ä¸‹æµ‹è¯•ã€‚","link":"/2019/03/04/æ‹¾é—webpack4ï¼ˆäºŒï¼‰â€”â€”Babel/"},{"title":"The Boring Projectâ€”â€”é©¾æ ¡ç®¡ç†ç³»ç»Ÿ","text":"ï½ 1","link":"/2019/08/11/The-Boring-Projectâ€”â€”é©¾æ ¡ç®¡ç†ç³»ç»Ÿ/"},{"title":"æ‹¾é—JavaScriptâ€”â€”å…³äºé—­åŒ…","text":"é—­åŒ…é—­åŒ…çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„è¯é¢˜ï½ å®šä¹‰ MDNï¼šé—­åŒ…æ˜¯ç”±å‡½æ•°ä»¥åŠåˆ›å»ºè¯¥å‡½æ•°çš„è¯æ³•ç¯å¢ƒç»„åˆè€Œæˆã€‚è¿™ä¸ªç¯å¢ƒåŒ…å«äº†è¿™ä¸ªé—­åŒ…åˆ›å»ºæ—¶æ‰€èƒ½è®¿é—®çš„æ‰€æœ‰å±€éƒ¨å˜é‡ã€‚ ã€ŠJavascripté«˜çº§ç¨‹åºè®¾è®¡ã€‹ï¼šé—­åŒ…æ˜¯æŒ‡æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡çš„å‡½æ•°ã€‚ ã€Šä½ ä¸çŸ¥é“çš„JSã€‹ï¼šå½“å‡½æ•°å¯ä»¥è®°ä½å¹¶è®¿é—®æ‰€åœ¨çš„è¯æ³•ä½œç”¨åŸŸæ—¶ï¼Œå°±äº§ç”Ÿäº†é—­åŒ…ï¼Œå³ä½¿å‡½æ•°æ˜¯åœ¨å½“å‰è¯æ³•ä½œç”¨åŸŸä¹‹å¤–æ‰§è¡Œã€‚è¿™æ ·çš„å‡½æ•°ç§°ä¹‹ä¸ºé—­åŒ…ã€‚ å› æ­¤å¯ä»¥çœ‹å‡ºé—­åŒ…ç”±å‡½æ•°åŠå‡½æ•°å¯ä»¥è®¿é—®çš„è‡ªç”±å˜é‡ç»„æˆï¼Œé‚£è‡ªç”±å˜é‡åˆæ˜¯å•¥ï¼Ÿ è‡ªç”±å˜é‡ï¼šåœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„å˜é‡ï¼Œä½†å®ƒæ—¢ä¸æ˜¯å‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿä¸æ˜¯å‡½æ•°çš„å±€éƒ¨å˜é‡ã€‚ ğŸŒ° 112345678function foo() &#123; var a = 1; function bar() &#123; console.log(a); &#125; bar(); &#125;foo(); // 1 åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œbar() ä¸­ï¼Œå˜é‡aæ—¢ä¸æ˜¯bar()çš„å‚æ•°ä¹Ÿä¸åœ¨bar()çš„ä½œç”¨åŸŸä¸­ï¼Œå› æ­¤å˜é‡aæ˜¯ä¸€ä¸ªè‡ªç”±å˜é‡ã€‚ é‚£ä¹ˆbar()å°±æ˜¯ä¸€ä¸ªé—­åŒ…å›–ï¼Ÿ ç†è®ºæ¥è¯´ï¼Œæ˜¯çš„ã€‚ä½†ä¸¥æ ¼æ„ä¹‰ä¸ŠåŠå®è·µè§’åº¦æ¥è¯´å¹¶ä¸æ˜¯ã€‚ bar()èƒ½è®¿é—®åˆ°å˜é‡aåªæ˜¯åŸºäºæ˜¯è¯æ³•ä½œç”¨åŸŸçš„æŸ¥æ‰¾è§„åˆ™ã€‚ ğŸŒ° 2123456789function foo() &#123; var a = 1; function bar() &#123; console.log(a); &#125; return bar; &#125;const fn = foo(); fn(); åˆ†æå½“å‡½æ•°foo()æ‰§è¡Œæ—¶ï¼Œbar()å½“ä½œè¿”å›å€¼barè¿”å›ç»™fnï¼Œæ‰§è¡Œfn()å…¶å®å°±æ˜¯æ‰§è¡Œbar()ã€‚ foo() æ‰§è¡Œå®Œæ¯•åï¼Œé€šå¸¸æ„ä¹‰ä¸Šçš„ç†è§£æ˜¯ï¼Œå½“æ‰§è¡Œfoo()æ—¶ï¼Œfoo()è¢«æ¨å…¥æ‰§è¡Œæ ˆä¸­ï¼Œæ‰§è¡Œå®Œæ¯•åæ¨å‡ºæ‰§è¡Œæ ˆï¼Œfoo()éšå³è¢«é”€æ¯ï¼Œå³å†…å­˜å›æ”¶æœºåˆ¶ã€‚ bar()åœ¨å®šä¹‰å®ƒçš„è¯æ³•ä½œç”¨åŸŸå¤–æ‰§è¡Œï¼Œå´å¯ä»¥è®¿é—®åˆ°å˜é‡aï¼Œå¹¶è¾“å‡ºå˜é‡açš„å€¼ã€‚è¿™å°±æ˜¯é—­åŒ…çš„ä½œç”¨ã€‚ é—­åŒ…ä½¿å¾—å‡½æ•°foo()çš„å†…éƒ¨ä½œç”¨åŸŸä¾æ—§å­˜åœ¨ï¼Œå› ä¸ºå‡½æ•°bar()ä¾æ—§åœ¨ä½¿ç”¨å®ƒï¼ˆå†…éƒ¨å‡½æ•°ä»çˆ¶å‡½æ•°ä¸­è¿”å›ï¼‰ã€‚ å› æ­¤ï¼Œé—­åŒ…åŒ…å«äº†å‡½æ•°åŠå‡½æ•°æ‰€å£°æ˜æ—¶çš„è¯æ³•ä½œç”¨åŸŸã€‚ ç»å…¸æ¡ˆä¾‹é—­åŒ…ä¸å¾ªç¯ğŸŒ°12345for (var i = 0; i &lt; 10; i++) &#123; setTimeout(function() &#123; console.log(i); &#125;, 500);&#125; æ­£å¸¸ç†è§£çš„ç»“æœæ˜¯åˆ†åˆ«è¾“å‡º1-9ï¼Œä½†è¿™æ®µä»£ç æœ€åä¼šè¾“å‡ºåæ¬¡10ã€‚ å› ä¸ºsetTimeoutæ˜¯ä¸€ä¸ªå¼‚æ­¥å›è°ƒå‡½æ•°ï¼Œå®ƒä¼šåœ¨forå¾ªç¯ç»“æŸä¹‹åæ‰ä¼šæ‰§è¡Œï¼Œæ­¤æ—¶i=10ï¼ˆi=10å¾ªç¯æ‰ä¼šç»“æŸï¼‰ã€‚ è¿™æ®µä»£ç å…¶å®æ˜¯åœ¨ä¸€ä¸ªå…¨å±€ä½œç”¨åŸŸä¸­æ‰§è¡Œçš„ï¼Œå˜é‡iåœ¨å…¨å±€ä½œç”¨åŸŸä¸­å®šä¹‰ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªå˜é‡iï¼ˆè™½ç„¶å¾ªç¯ä¸­çš„setTimeoutåœ¨æ¯ä¸ªå¾ªç¯è¿­ä»£ä¸­å®šä¹‰ä¸€æ¬¡ï¼Œä½†å®ƒä»¬éƒ½å…±äº«å¼•ç”¨ä¸€ä¸ªå˜é‡iï¼‰ã€‚ å¦‚ä½•è§£å†³ï¼ŸIIFEï¼ˆç«‹å³æ‰§è¡Œå‡½æ•°ï¼‰ç«‹å³æ‰§è¡Œå‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªå°é—­çš„ä½œç”¨åŸŸï¼Œé€šè¿‡å˜é‡jå­˜å‚¨içš„å€¼ï¼Œåœ¨æ¯æ¬¡å¾ªç¯è¿­ä»£ä¸­åˆ›å»ºä¸€ä¸ªå°é—­ä½œç”¨åŸŸï¼Œé€šè¿‡å˜é‡jä¿æŒæ­£ç¡®çš„içš„å€¼ã€‚ 12345678for (var i = 0; i &lt; 10; i++) &#123; (function(j) &#123; j = i; setTimeout(function() &#123; console.log(j); &#125;, 500); &#125;)(i);&#125; å—çº§ä½œç”¨åŸŸ12345for (let i = 0; i &lt; 10; i++) &#123; setTimeout(() =&gt; &#123; console.log(i); &#125;, 500);&#125; é—­åŒ…çš„ä½¿ç”¨å¦‚æœå°†å‡½æ•°ï¼ˆè®¿é—®å®ƒä»¬å„è‡ªçš„è¯æ³•ä½œç”¨åŸŸï¼‰å½“ä½œç¬¬ä¸€çº§çš„å€¼ç±»å‹å¹¶åˆ°å¤„ä¼ é€’ï¼Œä½ å°±ä¼šçœ‹åˆ°é—­åŒ…åœ¨è¿™äº›å‡½æ•°ä¸­çš„åº”ç”¨ã€‚åœ¨å®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬å™¨ã€Ajax è¯·æ±‚ã€è·¨çª—å£é€šä¿¡ã€Web Workers æˆ–è€…ä»»ä½•å…¶ä»–çš„å¼‚æ­¥ï¼ˆæˆ–è€…åŒæ­¥ï¼‰ä»»åŠ¡ä¸­ï¼Œåªè¦ä½¿ç”¨äº†å›è°ƒå‡½æ•°ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨ä½¿ç”¨é—­åŒ…ï¼ å®šä¹‰ç§æœ‰æ–¹æ³•12345678910111213141516171819202122232425const makeCounter = function() &#123; var privateCounter = 0; function changeBy(val) &#123; privateCounter += val; &#125; return &#123; increment: function() &#123; changeBy(1); &#125;, decrement: function() &#123; changeBy(-1); &#125;, value: function() &#123; return privateCounter; &#125; &#125;;&#125;;const counter1 = makeCounter();const counter2 = makeCounter();counter1.increment();console.log(counter1.value()); // 1counter2.increment();console.log(counter2.value()); // 1// https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures ä¸¤ä¸ªè®¡æ•°å™¨ counter1 å’Œ counter2 æ˜¯å¦‚ä½•ç»´æŠ¤å®ƒä»¬å„è‡ªçš„ç‹¬ç«‹æ€§çš„ã€‚æ¯ä¸ªé—­åŒ…éƒ½æ˜¯å¼•ç”¨è‡ªå·±è¯æ³•ä½œç”¨åŸŸå†…çš„å˜é‡ privateCounter ã€‚ æ¯æ¬¡è°ƒç”¨å…¶ä¸­ä¸€ä¸ªè®¡æ•°å™¨æ—¶ï¼Œé€šè¿‡æ”¹å˜è¿™ä¸ªå˜é‡çš„å€¼ï¼Œä¼šæ”¹å˜è¿™ä¸ªé—­åŒ…çš„è¯æ³•ç¯å¢ƒã€‚ç„¶è€Œåœ¨ä¸€ä¸ªé—­åŒ…å†…å¯¹å˜é‡çš„ä¿®æ”¹ï¼Œä¸ä¼šå½±å“åˆ°å¦å¤–ä¸€ä¸ªé—­åŒ…ä¸­çš„å˜é‡ã€‚ å¦‚æœä¸æ˜¯æŸäº›ç‰¹å®šä»»åŠ¡éœ€è¦ä½¿ç”¨é—­åŒ…ï¼Œåœ¨å…¶å®ƒå‡½æ•°ä¸­åˆ›å»ºå‡½æ•°æ˜¯ä¸æ˜æ™ºçš„ï¼Œå› ä¸ºé—­åŒ…åœ¨å¤„ç†é€Ÿåº¦å’Œå†…å­˜æ¶ˆè€—æ–¹é¢å¯¹è„šæœ¬æ€§èƒ½å…·æœ‰è´Ÿé¢å½±å“ã€‚","link":"/2019/08/20/æ‹¾é—JavaScriptâ€”â€”å…³äºé—­åŒ…/"},{"title":"Javascriptâ€”â€”é˜²æŠ–ä¸èŠ‚æµ","text":"é˜²æŠ–é˜²æ­¢å‡½æ•°å¤šæ¬¡è°ƒç”¨ï¼Œä¾‹å¦‚ä¸€ä¸ªç”¨æˆ·ä¸€ç›´è§¦å‘è¿™ä¸ªå‡½æ•°ï¼Œä¸”æ¯æ¬¡è§¦å‘å‡½æ•°çš„é—´éš”å°äº waitï¼Œé˜²æŠ–çš„æƒ…å†µä¸‹åªä¼šè°ƒç”¨ä¸€æ¬¡ã€‚ Code123456789101112131415161718192021222324252627/** *é˜²æŠ–å‡½æ•° * @param &#123;function&#125; fn éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼‰ * @param &#123;number&#125; wait ç­‰å¾…æ—¶é—´ï¼Œé¢„è®¾ 50ms * @returns &#123;function&#125; éœ€è¦è¿›è¡Œé˜²æŠ–å¤„ç†çš„å‡½æ•° */const debounce = (fn, wait = 50) =&gt; &#123; let timer = 0; //åˆå§‹åŒ–ä¸€ä¸ªå®šæ—¶å™¨ // è¿”å›è¿›è¡Œé˜²æŠ–å¤„ç†çš„å‡½æ•° return function(...arguments) &#123; // å¦‚æœå®šæ—¶å™¨å­˜åœ¨åˆ™æ¸…ç©ºä¸Šä¸€æ¬¡çš„å®šæ—¶å™¨ if (timer) &#123; clearTimeout(timer); &#125; // é‡æ–°è®¡æ—¶ï¼Œå»¶è¿Ÿæ‰§è¡Œä¼ å…¥çš„å‡½æ•° timer = setTimeout(() =&gt; &#123; fn.apply(this, arguments); &#125;, wait); &#125;;&#125;;// Button æŒ‰é’®document.getElementById(\"btn\").addEventListener( \"click\", debounce(function(e) &#123; console.log(\"change\", e.target.value, new Date() - 0); &#125;, 350)); ä¸€èˆ¬é˜²æŠ–éƒ½ä¼šæœ‰ä¸€ä¸ªé€‰é¡¹ï¼šæ˜¯å¦ç«‹å³è°ƒç”¨ã€‚åœ¨ä¸åŒä½¿ç”¨åœºæ™¯è¿›è¡ŒåŒºåˆ†ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼š åœ¨æœç´¢å¼•æ“æœç´¢é—®é¢˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬å½“ç„¶æ˜¯å¸Œæœ›ç”¨æˆ·è¾“å…¥å®Œæœ€åä¸€ä¸ªå­—æ‰è°ƒç”¨æŸ¥è¯¢æ¥å£ï¼Œè¿™ä¸ªæ—¶å€™é€‚ç”¨å»¶è¿Ÿæ‰§è¡Œçš„é˜²æŠ–å‡½æ•°ï¼Œå®ƒæ€»æ˜¯åœ¨ä¸€è¿ä¸²ï¼ˆé—´éš”å°äº wait çš„ï¼‰å‡½æ•°è§¦å‘ä¹‹åè°ƒç”¨ã€‚ æ–‡æœ¬è¾“å…¥çš„éªŒè¯ï¼ˆè¿ç»­è¾“å…¥æ–‡å­—åå‘é€è¯·æ±‚è¿›è¡ŒéªŒè¯ï¼ŒéªŒè¯ä¸€æ¬¡å°±å¥½)ã€‚ æ¯”å¦‚ä¸€ä¸ª start æŒ‰é’®ï¼Œå½“ç‚¹å‡»æŒ‰é’®çš„æ—¶å€™ç«‹åˆ»æ”¹å˜æŒ‰é’®å½¢çŠ¶ï¼Œè¿™æ—¶å€™ç”¨æˆ·å¯ä»¥çŸ¥é“äº¤äº’æ“ä½œæ­£åœ¨è¿›è¡Œï¼Œé‚£ä¹ˆéœ€è¦ç«‹å³æ‰§è¡Œå‡½æ•°ã€‚ æ”¹é€ ï¼šåŠ å…¥ç«‹å³æ‰§è¡Œé€‰é¡¹1234567891011121314151617181920212223242526272829303132333435363738394041424344/** * é˜²æŠ– * @param &#123;function&#125; fn éœ€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œï¼ˆä¾‹å¦‚ç½‘ç»œè¯·æ±‚ï¼‰ * @param &#123;Boolean&#125; immediate æ˜¯å¦ç«‹å³æ‰§è¡Œï¼Œé»˜è®¤ true * @param &#123;Number&#125; wait ç­‰å¾…æ—¶é—´ï¼Œé¢„è®¾ 50ms * @returns &#123;function&#125; éœ€è¦è¿›è¡Œé˜²æŠ–å¤„ç†çš„å‡½æ•° */const debounce = (fn, immediate = true, wait = 50) =&gt; &#123; let timer = 0; //åˆå§‹åŒ–ä¸€ä¸ªå®šæ—¶å™¨ let context, args; //æ‰§è¡Œä¸Šä¸‹æ–‡ã€å‚æ•° // å»¶è¿Ÿæ‰§è¡Œå‡½æ•° const later = () =&gt; setTimeout(() =&gt; &#123; // å»¶è¿Ÿå‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œæ¸…ç©ºç¼“å­˜çš„å®šæ—¶å™¨ timer = null; if (!immediate) &#123; // æ‰§è¡Œå‡½æ•° fn.apply(context, args); // é‡ç½®æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå‚æ•° context = args = null; &#125; &#125;, wait); // è¿”å›è¿›è¡Œé˜²æŠ–å¤„ç†çš„å‡½æ•° return function(...arguments) &#123; // å¦‚æœå®šæ—¶å™¨ä¸å­˜åœ¨åˆ™åˆ›å»ºå»¶è¿Ÿå®šæ—¶å™¨ã€‚ if (!timer) &#123; timer = later(); // å¦‚æœæ˜¯ç«‹å³æ‰§è¡Œï¼Œåˆ™æ‰§è¡Œå‡½æ•° if (immediate) &#123; fn.apply(this, arguments); &#125; else &#123; //ç¼“å­˜æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå‚æ•° context = this; args = arguments; &#125; &#125; else &#123; // å¦‚æœå·²æœ‰å»¶è¿Ÿæ‰§è¡Œå‡½æ•°ï¼ˆlaterï¼‰ï¼Œè°ƒç”¨çš„æ—¶å€™æ¸…é™¤åŸæ¥çš„å¹¶é‡æ–°è®¾å®šä¸€ä¸ª. // è¿™æ ·åšå»¶è¿Ÿå‡½æ•°ä¼šé‡æ–°è®¡æ—¶ clearTimeout(timer); timer = later(); &#125; &#125;;&#125;; å¯¹äºæŒ‰é’®çš„ç‚¹å‡»æ¥è¯´ï¼Œå‡è®¾ä½ è¿ç»­ç‚¹å‡»äº† 10 æ¬¡ï¼Œå¦‚æœç½‘ç»œè¯·æ±‚é˜²æŠ–æ˜¯ç«‹å³æ‰§è¡Œçš„ï¼Œåœ¨è¿™ 10 æ¬¡è¿‡ç¨‹ä¸­ï¼Œå‡½æ•°åªåœ¨ç‚¹å‡»çš„ç¬¬ä¸€æ¬¡ç«‹å³æ‰§è¡Œã€‚å…¶ä½™çš„ 9 æ¬¡éƒ½åœ¨é‡ç½®å®šæ—¶å™¨ï¼Œç­‰åˆ°æœ€åä¸€æ¬¡è®¾å®šçš„è®¡æ—¶å™¨è®¡æ—¶æ—¶é—´åˆ°ï¼Œå†æ¬¡ç‚¹å‡»æ‰é‡æ–°æ‰§è¡Œã€‚ èŠ‚æµç®€å•å¯ä»¥ç†è§£ä¸ºï¼šå°†å¤šæ¬¡æ‰§è¡Œçš„å‡½æ•°å›ºå®šæˆæ¯éš”ä¸€æ®µæ—¶é—´æ‰§è¡Œã€‚ ä¸€èˆ¬æƒ…å†µä¸‹æœ‰ 2 ä¸­ä¸åŒçš„é™åˆ¶æ–¹å¼é€‚ç”¨ä¸åŒéœ€æ±‚ é¦–æ¬¡æ˜¯å¦æ‰§è¡Œ ç»“æŸåæ˜¯å¦æ‰§è¡Œ Codeä½¿ç”¨æ—¶é—´æˆ³å®ç°æ€è·¯ å˜é‡previousè®°å½•è°ƒç”¨æ–¹æ³•çš„æ—¶é—´æˆ³. å¯¹æ¯”ä¹‹å‰çš„æ—¶é—´é”™ï¼Œå¦‚æœå¤§äºè®¾ç½®çš„æ—¶é—´é”™ï¼Œåˆ™æ‰§è¡Œå‡½æ•°ã€‚æ‰§è¡Œåæ›´æ–°æ—¶é—´æˆ³ä¸ºå½“å‰æ—¶é—´ã€‚ 123456789101112const throttle = (func, delay) =&gt; &#123; let previous = 0; return function(...args) &#123; let now = +new Date(); // å°†å½“å‰æ—¶é—´å’Œä¸Šä¸€æ¬¡æ‰§è¡Œå‡½æ•°æ—¶é—´å¯¹æ¯” // å¦‚æœå·®å€¼å¤§äºè®¾ç½®çš„ç­‰å¾…æ—¶é—´å°±æ‰§è¡Œå‡½æ•° if (now - previous &gt; delay) &#123; previous = now; func.apply(this, args); &#125; &#125;;&#125;; ä»£ç åˆ†æ 1.ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œif (now - previous &gt; delay)ï¼Œprevious=0ï¼Œæ‰€ä»¥æ–¹æ³•ç«‹å³æ‰§è¡Œï¼Œéšåè®°å½•previous=now()ï¼Œæ¯éš” 1s æ‰§è¡Œä¸€æ¬¡æ–¹æ³•ã€‚ 2.ä½†ä¸ä¼šè§¦å‘æœ€åä¸€æ¬¡æ‰§è¡Œã€‚ ä½¿ç”¨setTimeoutå®ç°æ€è·¯ å½“æ‰§è¡Œ throttle å‡½æ•°æ—¶ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨å®šæ—¶å™¨ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ï¼Œ 123456789101112const throttle = (func, delay) =&gt; &#123; let timer; return function(...args) &#123; // å¦‚æœå®šæ—¶å™¨ä¸å­˜åœ¨ï¼Œåˆ™å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ã€‚ if (!timer) &#123; timer = setTimeout(() =&gt; &#123; func.apply(this, args); timer = null; &#125;, delay); &#125; &#125;;&#125;; ä»£ç åˆ†æ å½“è¿ç»­è°ƒç”¨ throttle å‡½æ•°æ—¶ï¼Œæ–¹æ³•funcä¸ä¼šç«‹å³æ‰§è¡Œï¼Œä¹‹åæ ¹æ®è®¾å®šçš„ delay æ—¶é—´é—´éš”æ‰§è¡Œã€‚ ç»“æŸè°ƒç”¨åè¿˜ä¼šæ‰§è¡Œä¸€æ¬¡ã€‚ ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«åœ¨ä¸æ˜¯å¦é¦–æ¬¡æ‰§è¡Œå’Œæ˜¯å¦ç»“æŸåæ‰§è¡Œã€‚ å®Œå–„æ€è·¯ å¢åŠ optionsé€‰é¡¹ï¼Œå¯é€‰ leading:false è¡¨ç¤ºç¦ç”¨ç¬¬ä¸€æ¬¡æ‰§è¡Œã€trailing:false è¡¨ç¤ºç¦ç”¨åœæ­¢è§¦å‘çš„å›è°ƒ 1234567891011121314151617181920212223242526272829const throttle = (func, delay, option) =&gt; &#123; let timer, previous = null; // const later = function() &#123; previous = option.leading === false ? 0 : +new Date(); func.apply(this, arguments); timer = null; &#125;; return function(...args) &#123; // å¦‚æœå®šæ—¶å™¨ä¸å­˜åœ¨ï¼Œåˆ™å¼€å¯ä¸€ä¸ªå®šæ—¶å™¨ã€‚ let now = +new Date(); // å¦‚æœleading===falseè¡¨ç¤ºç¬¬ä¸€æ¬¡è°ƒç”¨ä¸æ‰§è¡Œï¼› if (option.leading === false &amp;&amp; !previous) &#123; previous = now; &#125; // æ ¹æ®æ—¶é—´æˆ³å¯¹æ¯”æ˜¯å¦åœ¨é™åˆ¶æ—¶é—´å†… if (now - previous &gt; delay) &#123; if (timer) &#123; clearTimeout(timer); timer = null; &#125; func.apply(this, args); previous = now; &#125; else if (!timer &amp;&amp; option.trailing !== false) &#123; timer = setTimeout(later, delay); &#125; &#125;;&#125;;","link":"/2019/08/09/é˜²æŠ–ä¸èŠ‚æµ/"},{"title":"æ‹¾é—JavaScriptâ€”â€”åŸå‹ä¸åŸå‹é“¾","text":"ä¸€ã€åŸå‹prototypeåŸºæœ¬ä¸Šæ¯ä¸ªå‡½æ•°éƒ½æœ‰ ä¸€ä¸ªç‰¹æ®Šçš„å±æ€§â€”â€”åŸå‹ï¼ˆprototypeï¼‰ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ˜¾å¼å±æ€§ã€‚ å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¿™ä¸ªå±æ€§å°±è‡ªåŠ¨è¢«åˆ›å»ºã€‚ 1function fn()&#123;&#125; å‡½æ•°çš„prototypeæ˜¯ä»€ä¹ˆï¼Ÿ prototype å±æ€§ï¼šç»§æ‰¿æˆå‘˜å®šä¹‰çš„åœ°æ–¹ã€‚ é€šä¿—çš„ç†è§£ä¸ºï¼šå½“æˆ‘ä»¬å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œè¯¥å¯¹è±¡ä¼šä»åŸå‹ä¸­â€œç»§æ‰¿â€å±æ€§å’Œæ–¹æ³•ã€‚ 12345678910111213141516function animal()&#123;&#125;;animal.prototype.class = \"animal\";animal.prototype.eat = function() &#123; console.log(\"eat something\");&#125;var cat = new animal();cat.eat(); // eat somethingconsole.log(cat.class); // \"animal\" ğŸ˜ª æŠ½è±¡èƒ½åŠ›å·®æ€ä¹ˆåŠï¼Ÿâ€”â€”â€”â€”ç”»å›¾ å½“æˆ‘ä»¬æ‰“å°catè¿™ä¸ªå®ä¾‹æ—¶â€¦â€¦.. Whatï¼Ÿï¼Ÿï¼Ÿ OOPæ€æƒ³ä¸­çš„ç»§æ‰¿ï¼ˆjavaï¼ŒC++ç­‰ï¼‰æ˜¯ä¸€ç§å¯¹å±æ€§æ–¹æ³•çš„å¤åˆ¶æ“ä½œï¼Œä½†å¯¹è±¡å®ä¾‹catä¸­å¹¶æ²¡æœ‰å¤åˆ¶è¿‡æ¥çš„å±æ€§å’Œæ–¹æ³•ï¼Œä½†åœ¨è°ƒç”¨classå±æ€§å’Œeat()æ–¹æ³•æ—¶éƒ½å¯ä»¥æ­£å¸¸è°ƒç”¨ã€‚è¿™ï¼Ÿï¼Ÿï¼Ÿåœ¨JavaScript çš„ç»§æ‰¿æ“ä½œå…¶å®æ˜¯ä¸€ç§â€œé“¾æ¥â€æ“ä½œï¼Œæ˜¯ä¸€ç§å§”æ‰˜ï¼Œé€šè¿‡__proto__ é“¾æ¥åˆ°æ„é€ å‡½æ•°çš„prototypeã€‚ __proto____proto__ æ˜¯æ¯ä¸€ä¸ªå¯¹è±¡ï¼ˆé™¤äº†nullï¼‰éƒ½æœ‰çš„éšå¼å±æ€§ï¼Œå®ƒæŒ‡å‘åˆ›å»ºè¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„[[prototype]]ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è®¿é—®åˆ°å®šä¹‰åœ¨æ„é€ å‡½æ•°çš„prototypeä¸Šçš„å±æ€§å’Œæ–¹æ³•ã€‚ 1console.log(cat.__proto__ == animal.prototype); // true å½“ä½¿ç”¨cat.__proto__ æ—¶ï¼Œå®é™…ä¸Šæ˜¯è¿”å›Object.getPrototypeOf(cat)ã€‚å¯ä»¥ç†è§£ä¸ºä¸€ç§getter/setteræ“ä½œã€‚ ğŸ˜ª æŠ½è±¡èƒ½åŠ›å·®æ€ä¹ˆåŠï¼Ÿâ€”â€”ç”»å›¾ constructor åœ¨animal.prototypeä¸­è¿˜æœ‰ä¸€ä¸ªå±æ€§constructor,å®ƒæ˜¯å¹²ä»€ä¹ˆç”¨çš„ï¼Ÿ constructor:æ¯ä¸€ä¸ªå®ä¾‹å¯¹è±¡éƒ½ä»åŸå‹ä¸­ç»§æ‰¿ä¸€ä¸ª constructor å±æ€§ï¼Œå®ƒæŒ‡å‘æ„é€ æ­¤å®ä¾‹å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼› å› æ­¤å®ä¾‹catçš„æ„é€ å‡½æ•°æ˜¯function animal() 12console.log(animal.prototype.constructor === animal); // trueconsole.log(cat.constructor === animal); // true æˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·å»åˆ›å»ºanimalçš„å®ä¾‹ï¼Œä½†ä¸€èˆ¬æ¥è¯´çŸ¥é“åŸå§‹æ„é€ å™¨function animal()çš„æƒ…å†µä¸‹ä¸ä¼šç”¨è¿™æ ·çš„æ–¹å¼ã€‚ 1234const dog = new cat.constructor();dog.class // animaldog.eat() // eat somethingconsole.log(dog.constructor === animal); // true ç”»å›¾æ‹ä¸€æ‹ï½ åŸå‹çš„åŸå‹ ï¼Ÿæ‹æ¸…äº†å®ä¾‹ä¸åŸå‹çš„å…³ç³»,é‚£åŸå‹çš„åŸå‹æ˜¯ä»€ä¹ˆï¼Ÿ animal.prototype ä¸­ä¹Ÿæœ‰ä¸€ä¸ªå±æ€§__proto__ , è¿™ä¸ª__proto__å±æ€§æŒ‡å‘å“ªï¼Ÿ åœ¨JavaScriptä¸­ï¼Œå‡½æ•°å…¶å®ä¹Ÿæ˜¯Objectï¼Œanimal.prototype.__proto__ æŒ‡å‘çš„æ˜¯Object.prototype è€ŒObject.prototype.__proto__ === null åŸå‹é“¾1234567891011121314function animal()&#123;&#125;;animal.prototype.class = \"animal\";var cat = new animal();cat.class = \"cat\";console.log(cat.class); // catdelete cat.class; // åˆ é™¤ cat çš„ class å±æ€§console.log(cat.class); // animalcat.isPrototypeOf();cat.valueOf() ç”±ä»¥ä¸Šä»£ç å¯ä»¥çœ‹å‡º:1ã€cat.class é¦–å…ˆåœ¨å®ä¾‹catä¸Šå¯»æ‰¾å±æ€§classï¼Œè¾“å‡ºâ€œcatâ€2ã€åˆ é™¤å®ä¾‹catä¸Šçš„å±æ€§classï¼Œä»èƒ½è°ƒç”¨ï¼Œä½†è¾“å‡ºçš„æ˜¯&quot;animal&quot;è¿™æ˜¯å› ä¸ºå½“åœ¨å®ä¾‹ä¸Šå¯»æ‰¾ä¸åˆ°å±æ€§classæ—¶ï¼Œä¼šé€šè¿‡__proto__æ‰¾åˆ°aminal.prototypeï¼Œåœ¨ä¸Šé¢å¯»æ‰¾åˆ°classï¼Œå¹¶è¾“å‡º&quot;animal&quot;3ã€å¹¶æ²¡æœ‰åœ¨å®ä¾‹catæˆ–è€…animal.prototypeä¸Šå®šä¹‰isPrototypeOf()/valueOf()ï¼Œä¸ºä»€ä¹ˆè¿˜èƒ½è°ƒç”¨ï¼Ÿè¿™æ˜¯å› ä¸ºå½“åœ¨å®ä¾‹ã€å®ä¾‹åŸå‹animal.prototypeä¸Šæ‰¾ä¸æ—¶ï¼Œè§£æå™¨ä¼šç»§ç»­å¾€ä¸Šï¼Œå³animal.prototype.__proto__ï¼Œç›´åˆ°__proto__æŒ‡å‘nullåˆ™åœæ­¢å¯»æ‰¾ã€‚æ­¤æ—¶animal.prototype.__proto__æŒ‡å‘çš„æ˜¯Object.prototypeï¼Œæ‰€ä»¥è°ƒç”¨ä¸Šé¢å®šä¹‰çš„æ–¹æ³•isPrototypeOf()/valueOf() å®ä¾‹catã€æ„é€ å‡½æ•°animalçš„åŸå‹prototypeã€Object.prototype ä»¥__proto__é“¾æ¥èµ·æ¥çš„å…³ç³»å°±å½¢æˆäº†åŸå‹é“¾ã€‚ å›¾è…¾","link":"/2019/04/10/æ‹¾é—JavaScriptâ€”â€”åŸå‹ä¸åŸå‹é“¾/"},{"title":"æ‹¾é—JavaScriptâ€”â€”Promise","text":"åŸºæœ¬ä½¿ç”¨æ²¡å•¥å¥½è®°å½•ï½ å…·ä½“å‚è€ƒ MDN Promise https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise Promise å…·ä½“ç”¨æ³• https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Using_promises Promise.all()Promise.all() å‚æ•°ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå¦‚ Array æˆ– Stringã€‚ è¿”å›å€¼ å¦‚æœä¼ å…¥çš„å‚æ•°æ˜¯ä¸€ä¸ªç©ºçš„å¯¹è±¡ï¼Œåˆ™è¿”å›ä¸€ä¸ªå·²å®Œæˆï¼ˆalready resolvedï¼‰çŠ¶æ€çš„ Promiseã€‚ å¦‚æœä¼ å…¥çš„å‚æ•°ä¸åŒ…å«ä»»ä½• promiseï¼Œåˆ™è¿”å›ä¸€ä¸ªå¼‚æ­¥å®Œæˆï¼ˆasynchronously resolvedï¼‰ Promiseã€‚ 1ã€Promise.all è¿”å›çš„ promise çš„å®ŒæˆçŠ¶æ€çš„ç»“æœéƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚2ã€å¦‚æœæ‰€æœ‰ä¼ å…¥çš„ promise éƒ½å˜ä¸ºå®ŒæˆçŠ¶æ€ï¼Œæˆ–è€…ä¼ å…¥çš„å¯è¿­ä»£å¯¹è±¡å†…æ²¡æœ‰ promiseï¼ŒPromise.all è¿”å›çš„ promise å¼‚æ­¥åœ°å˜ä¸ºå®Œæˆ3ã€å¦‚æœä¼ å…¥çš„ promise ä¸­æœ‰ä¸€ä¸ªå¤±è´¥ï¼ˆrejectedï¼‰ï¼ŒPromise.all å¼‚æ­¥åœ°å°†å¤±è´¥çš„é‚£ä¸ªç»“æœç»™å¤±è´¥çŠ¶æ€çš„å›è°ƒå‡½æ•°ï¼Œè€Œä¸ç®¡å…¶å®ƒ promise æ˜¯å¦å®Œæˆï¼Œä»è€Œä¸¢å¼ƒå…¶ä»–Promiseçš„å®Œæˆç»“æœã€‚ ğŸŒ°å½“æˆ‘ä»¬åœ¨åŒæ—¶å‘èµ·å¤šä¸ªç½‘ç»œè¯·æ±‚æ—¶ï¼Œå¯ä»¥ç”¨Promise.all()æ¥å¤„ç†ã€‚ promise.js12345678910111213141516function fetchData(url) &#123;return new Promise((resolve, reject) =&gt; &#123;const requet = new XMLHttpRequest();requet.open(\"GET\", url);requet.onload = () =&gt; resolve(requet.responseText);requet.onerror = () =&gt; reject(requet.statusText);requet.send();&#125;);&#125;const fetch_1 = fetchData(topNewsUrl)const fetch_2 = fetchData(topNewsUrl)const fetch_3 = fetchData(topNewsUrl)Promise.all([fetch_1,fetch_2,fetch_3]).then(res=&gt;&#123;console.log(res);&#125;) ä½†æ˜¯å½“Promise.all()ä¸­æœ‰ä¸€ä¸ªpromiseçš„çŠ¶æ€ä¸ºrejectedï¼Œåˆ™ä¼šæŠ›å¼ƒå…¶ä»–å·²å®Œæˆçš„ç»“æœã€‚ promise.js1234567891011const fetch_1 = fetchData(topNewsUrl);const fetch_2 = fetchData(topNewsUrl);const fetch_3 = Promise.reject(\"err\");Promise.all([fetch_1, fetch_2, fetch_3]).then(res =&gt; &#123;console.log(res);&#125;).catch(err =&gt; &#123;console.log(err);&#125;); ä½†æ˜¯æœ‰æ—¶å€™æˆ‘ä»¬æƒ³è¦åŒæ—¶å¾—åˆ°æ­£ç¡®å¤„ç†çš„ç»“æœå’Œå¤±è´¥ç»“æœï¼Œå¯ä»¥è¿™æ ·å¤„ç†promise.js1234567891011121314151617const fetch_1 = fetchData(topNewsUrl);const fetch_2 = fetchData(topNewsUrl);// ç”¨ catch()æ•è·å½“å‰ promise reject(\"err\")ï¼Œå¹¶è¿”å›ã€‚// catch() è¿”å›å€¼æ˜¯ä¸€ä¸ª promiseï¼Œå¦‚æœä¸è¢« rejectedï¼Œåˆ™å®ƒæ˜¾ç¤ºä¸ºæˆåŠŸ(resolved)const fetch_3 = Promise.reject(\"err\").catch(err =&gt;&#123;return err;&#125;);const fetchs = [fetch_1, fetch_2, fetch_3];Promise.all(fetchs).then(res =&gt; &#123;console.log(res);&#125;).catch(err =&gt; &#123;console.log(err);&#125;); åŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨Promise.allSettled() Promise.allSettled()Promise.allSettled()ï¼š æ— è®ºæ˜¯æˆåŠŸæˆ–æ‹’ç»ã€‚è¿”å›æ•°ç»„åŒ…å«åŸå§‹promisesé›†ä¸­æ¯ä¸ªpromiseçš„ç»“æœã€‚ 1234567const fetch_1 = Promise.resolve(1);const fetch_2 = Promise.reject(2);const fetch_3 = Promise.resolve(3);const fetchs = [fetch_1, fetch_2, fetch_3];console.log(Promise.allSettled(fetchs)); Promise.finally()finally() æ–¹æ³•è¿”å›ä¸€ä¸ªPromiseã€‚åœ¨promiseç»“æŸæ—¶ï¼Œæ— è®ºç»“æœæ˜¯fulfilledæˆ–è€…æ˜¯rejectedï¼Œéƒ½ä¼šæ‰§è¡ŒæŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ºåœ¨Promiseæ˜¯å¦æˆåŠŸå®Œæˆåéƒ½éœ€è¦æ‰§è¡Œçš„ä»£ç æä¾›äº†ä¸€ç§æ–¹å¼ 12345678Promise.resolve(1) .then(res =&gt; console.log(res)) // 1 .catch(err =&gt; console.log(err)) .finally(() =&gt; console.log(\"finally\")); // finallyPromise.reject(2) .then(res =&gt; console.log(res)) .catch(err =&gt; console.log(err)) // 2 .finally(() =&gt; console.log(\"finally\")); //finally Promise ? async/awaitå½“ä¸€ä¸ªç½‘ç»œè¯·æ±‚éœ€è¦ä¾èµ–ä¸Šä¸€ä¸ªè¯·æ±‚çš„ç»“æœæ—¶ï¼š Promise Promise.js12345678910fetchData(topNewsUrl) .then(res =&gt; &#123; return res.data[0].id; &#125;) .then(itemID =&gt; &#123; return fetchData(newsDetailUtl + itemID); &#125;) .then(res =&gt; &#123; console.log(res); &#125;); async/await async/await.js12345async function asyncFetch() &#123; const news = await fetchData(topNewsUrl) const res = await fetchData(newsDetailUtl + news.data[0].id); console.log(res);&#125; å¯¹æ¯”ä¸¤è€…æ˜¾ç„¶async/await ä»£ç æ›´ç®€æ´å®¹æ˜“ç†è§£ã€‚ å®ç°ä¸€ä¸ª PromiseåŸºç¡€ç®€æ˜“ç‰ˆmyPromise.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869// Promiseä¸‰ç§çŠ¶æ€;const PENDING = \"pendding\"; //ç­‰å¾…const FULFILLED = \"fulfilled\"; // å®Œæˆconst REJECTED = \"rejected\"; //æ‹’ç»class myPromise &#123; constructor(executor) &#123; this.state = PENDING; //åˆå§‹çŠ¶æ€ this.value = null; // å®Œæˆç»“æœ this.reason = null; // æ‹’ç»åŸå›  const resolve = value =&gt; &#123; if (this.state === PENDING) &#123; this.value = value; // ä¿å­˜å®Œæˆç»“æœ this.state = FULFILLED; // ä¿å­˜çŠ¶æ€ä¸ºå®Œæˆ &#125; &#125;; const reject = value =&gt; &#123; if (this.state == PENDING) &#123; this.reason = value; // ä¿ç•™æ‹’ç»åŸå›  this.state = REJECTED; // ä¿å­˜çŠ¶æ€ä¸ºæ‹’ç» &#125; &#125;; /** * executor: Promiseä¸­é¦–å…ˆä¼ äº†ä¸€ä¸ªexecutorï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•° * executorå‡½æ•°ä¸­åˆä¼ äº†ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯resolveå’Œreject * @param resolve:æˆåŠŸå›è°ƒ * @param reject:æ‹’ç»å›è°ƒ */ executor(resolve, reject); &#125; /** * æ ¹æ®æˆåŠŸæˆ–å¤±è´¥çš„çŠ¶æ€å»æ‰§è¡Œç›¸å…³æˆåŠŸonFilfulled()æˆ–è€…å¤±è´¥onRejected()çš„å›è°ƒæ–¹æ³• * @param &#123;*&#125; onFulfilled ï¼šæˆåŠŸ * @param &#123;*&#125; onRejected ï¼šæ‹’ç» */ then(onFulfilled, onRejected) &#123; switch (this.state) &#123; case FULFILLED: //æ‰§è¡ŒæˆåŠŸçš„å›è°ƒå‡½æ•°onFilfulledï¼Œä¼ å…¥æˆåŠŸç»“æœ this.value onFulfilled(this.value); break; case REJECTED: //æ‰§è¡ŒæˆåŠŸçš„å›è°ƒå‡½æ•°onRejectedï¼Œä¼ å…¥æ‹’ç»ç»“æœ this.reason onRejected(this.reason); break; default: break; &#125; &#125; /** * * @param &#123;*&#125; onRejected ï¼šæ‹’ç» */ catch(onRejected) &#123; return this.then(null, onRejected); &#125;&#125;const p = new myPromise((resolve, reject) =&gt; &#123; resolve(1);&#125;);p.then(res =&gt; &#123; console.log(res); // 1&#125;); å¾ˆæ˜¾ç„¶ï¼Œæµ‹è¯•ç»“æœååº”ä»£ç æ²¡æœ‰é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœåŠ ä¸ªå¼‚æ­¥å‡½æ•°å‘¢ï¼Ÿ å¼‚æ­¥å¤„ç†myPromise.js12345678const p = new myPromise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);p.then(res =&gt; &#123; console.log(res); &#125;); å¾ˆæ˜¾ç„¶ï¼Œæ§åˆ¶å°ä¸ä¼šè¾“å‡ºä»€ä¹ˆï¼Œå› ä¸ºsetTimeoutæ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Œä¼šè¢«åŠ å…¥åˆ°Task Queue å½“è°ƒç”¨then()æ—¶ï¼ŒmyPromise.state è¿˜æ˜¯ PENDINGï¼Œæ­¤æ—¶then()å‡½æ•°å¹¶ä¸çŸ¥é“åˆ°åº•æ˜¯æ‰§è¡ŒonFulfilled()ï¼Œè¿˜æ˜¯onRejected()ã€‚ æ”¹é€ â€¦.myPromise.js12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394959697// Promiseä¸‰ç§çŠ¶æ€;const PENDING = \"pendding\"; //ç­‰å¾…const FULFILLED = \"fulfilled\"; // å®Œæˆconst REJECTED = \"rejected\"; //æ‹’ç»class myPromise &#123; constructor(executor) &#123; this.state = PENDING; //åˆå§‹çŠ¶æ€ this.value = null; // å®Œæˆç»“æœ this.reason = null; // æ‹’ç»åŸå›  this.onFulfilledCallbacks = []; // ä¿å­˜å®Œæˆå›è°ƒ this.onRejectedCallbacks = []; // ä¿å­˜æ‹’ç»å›è°ƒ const resolve = value =&gt; &#123; if (this.state === PENDING) &#123; this.value = value; // ä¿å­˜å®Œæˆç»“æœ this.state = FULFILLED; // ä¿å­˜çŠ¶æ€ä¸ºå®Œæˆ // çŠ¶æ€å˜æ›´å ç«‹å³æ‰§è¡Œä¹‹å‰å­˜æ”¾åœ¨ç›¸åº”æ•°ç»„ä¸­æ‰€æœ‰å®Œæˆçš„å›è°ƒå‡½æ•°. this.onFulfilledCallbacks.map(cb =&gt; &#123; cb(); &#125;); &#125; &#125;; const reject = value =&gt; &#123; if (this.state == PENDING) &#123; this.reason = value; // ä¿ç•™æ‹’ç»åŸå›  this.state = REJECTED; // ä¿å­˜çŠ¶æ€ä¸ºæ‹’ç» // çŠ¶æ€å˜æ›´å ç«‹å³æ‰§è¡Œä¹‹å‰å­˜æ”¾åœ¨ç›¸åº”æ•°ç»„ä¸­æ‰€æœ‰æ‹’ç»çš„å›è°ƒå‡½æ•° this.onRejectedCallbacks.map(cb =&gt; &#123; cb(); &#125;); &#125; &#125;; try &#123; /** * executor: Promiseä¸­é¦–å…ˆä¼ äº†ä¸€ä¸ªexecutorï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•° * executorå‡½æ•°ä¸­åˆä¼ äº†ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯resolveå’Œreject * @param resolve:æˆåŠŸå›è°ƒ * @param reject:æ‹’ç»å›è°ƒ */ executor(resolve, reject); &#125; catch (err) &#123; // å¦‚æœå‡ºé”™ï¼Œç›´æ¥è¿›å…¥reject() reject(err); &#125; &#125; /** * æ ¹æ®æˆåŠŸæˆ–å¤±è´¥çš„çŠ¶æ€å»æ‰§è¡Œç›¸å…³æˆåŠŸonFilfulled()æˆ–è€…å¤±è´¥onRejected()çš„å›è°ƒæ–¹æ³• * @param &#123;*&#125; onFulfilled ï¼šæˆåŠŸ * @param &#123;*&#125; onRejected ï¼šæ‹’ç» */ then(onFulfilled, onRejected) &#123; switch (this.state) &#123; // é’ˆå¯¹å¯èƒ½å­˜åœ¨çš„å¼‚æ­¥è°ƒç”¨ï¼Œåœ¨PENDINGçŠ¶æ€æ—¶å°†å®Œæˆã€å¤±è´¥çš„å›è°ƒå‡½æ•°pushåˆ°å¯¹åº”çš„æ•°ç»„ä¸­ï¼Œå¾…çŠ¶æ€æ”¹å˜æ—¶æ‰§è¡Œã€‚ // è¿™ç§æ–¹å¼å¯ä»¥ç§°ä¸ºè®¢é˜… case PENDING: this.onFulfilledCallbacks.push(() =&gt; &#123; onFulfilled(this.value); &#125;); this.onRejectedCallbacks.push(() =&gt; &#123; onRejected(this.reason); &#125;); break; case FULFILLED: //æ‰§è¡ŒæˆåŠŸçš„å›è°ƒå‡½æ•°onFilfulledï¼Œä¼ å…¥æˆåŠŸç»“æœ this.value onFulfilled(this.value); break; case REJECTED: //æ‰§è¡ŒæˆåŠŸçš„å›è°ƒå‡½æ•°onRejectedï¼Œä¼ å…¥æ‹’ç»ç»“æœ this.reason onRejected(this.reason); break; default: break; &#125; &#125; /** * æ•è·reject * @param &#123;*&#125; onRejected ï¼šæ‹’ç» */ catch(onRejected) &#123; return this.then(null, onRejected); &#125;&#125;const p = new myPromise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);p.then(res =&gt; &#123; console.log(res); // 1&#125;); then()é“¾å¼è°ƒç”¨ å¦‚æœä¸€ä¸ªthenæ–¹æ³•è¿”å›ä¸€ä¸ªæ™®é€šå€¼çš„è¯ï¼Œè¿™ä¸ªå€¼ä¼šä¼ é€’ç»™ä¸‹ä¸€ä¸ªthenä¸­ä½œä¸ºresolveæˆåŠŸçš„ç»“æœå¦‚æœä¸€ä¸ªthenæ–¹æ³•è¿”å›ä¸€ä¸ªpromiseçš„è¯ï¼Œä¼šæ ¹æ®è¿”å›çš„promiseæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ï¼Œå†³å®šä¸‹ä¸€ä¸ªthenæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ myPromise.js123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118// Promiseä¸‰ç§çŠ¶æ€;const PENDING = \"pendding\"; //ç­‰å¾…const FULFILLED = \"fulfilled\"; // å®Œæˆconst REJECTED = \"rejected\"; //æ‹’ç»class myPromise &#123; constructor(executor) &#123; this.state = PENDING; //åˆå§‹çŠ¶æ€ this.value = null; // å®Œæˆç»“æœ this.reason = null; // æ‹’ç»åŸå›  this.onFulfilledCallbacks = []; // ä¿å­˜å®Œæˆå›è°ƒ this.onRejectedCallbacks = []; // ä¿å­˜æ‹’ç»å›è°ƒ const resolve = value =&gt; &#123; // ä¸ºäº†ä¿è¯å‡½æ•°æ‰§è¡Œé¡ºåºï¼Œéœ€è¦å°†ä¸¤ä¸ªå‡½æ•°ä½“ä»£ç ä½¿ç”¨ setTimeout åŒ…è£¹èµ·æ¥ setTimeout(() =&gt; &#123; if (this.state === PENDING) &#123; this.value = value; // ä¿å­˜å®Œæˆç»“æœ this.state = FULFILLED; // ä¿å­˜çŠ¶æ€ä¸ºå®Œæˆ // çŠ¶æ€å˜æ›´å ç«‹å³æ‰§è¡Œä¹‹å‰å­˜æ”¾åœ¨ç›¸åº”æ•°ç»„ä¸­æ‰€æœ‰å®Œæˆçš„å›è°ƒå‡½æ•°. this.onFulfilledCallbacks.forEach(cb =&gt; &#123; cb(); &#125;); &#125; &#125;, 0); &#125;; const reject = value =&gt; &#123; //ä¸ºäº†ä¿è¯å‡½æ•°æ‰§è¡Œé¡ºåºï¼Œéœ€è¦å°†ä¸¤ä¸ªå‡½æ•°ä½“ä»£ç ä½¿ç”¨ setTimeout åŒ…è£¹èµ·æ¥ setTimeout(() =&gt; &#123; if (this.state == PENDING) &#123; this.reason = value; // ä¿ç•™æ‹’ç»åŸå›  this.state = REJECTED; // ä¿å­˜çŠ¶æ€ä¸ºæ‹’ç» // çŠ¶æ€å˜æ›´å ç«‹å³æ‰§è¡Œä¹‹å‰å­˜æ”¾åœ¨ç›¸åº”æ•°ç»„ä¸­æ‰€æœ‰æ‹’ç»çš„å›è°ƒå‡½æ•° this.onRejectedCallbacks.forEach(cb =&gt; &#123; cb(); &#125;); &#125; &#125;, 0); &#125;; try &#123; /** * executor: Promiseä¸­é¦–å…ˆä¼ äº†ä¸€ä¸ªexecutorï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•° * executorå‡½æ•°ä¸­åˆä¼ äº†ä¸¤ä¸ªå‡½æ•°ï¼Œåˆ†åˆ«æ˜¯resolveå’Œreject * @param resolve:æˆåŠŸå›è°ƒ * @param reject:æ‹’ç»å›è°ƒ */ executor(resolve, reject); &#125; catch (err) &#123; // å¦‚æœå‡ºé”™ï¼Œç›´æ¥è¿›å…¥reject() reject(err); &#125; &#125; /** * æ ¹æ®æˆåŠŸæˆ–å¤±è´¥çš„çŠ¶æ€å»æ‰§è¡Œç›¸å…³æˆåŠŸonFilfulled()æˆ–è€…å¤±è´¥onRejected()çš„å›è°ƒæ–¹æ³• * @param &#123;*&#125; onFulfilled ï¼šæˆåŠŸ * @param &#123;*&#125; onRejected ï¼šæ‹’ç» */ then(onFulfilled, onRejected) &#123; // return ä¸€ä¸ª promise return new myPromise((resolve, reject) =&gt; &#123; switch (this.state) &#123; // é’ˆå¯¹å¯èƒ½å­˜åœ¨çš„å¼‚æ­¥è°ƒç”¨ï¼Œåœ¨PENDINGçŠ¶æ€æ—¶å°†å®Œæˆã€å¤±è´¥çš„å›è°ƒå‡½æ•°pushåˆ°å¯¹åº”çš„æ•°ç»„ä¸­ï¼Œå¾…çŠ¶æ€æ”¹å˜æ—¶æ‰§è¡Œã€‚ // è¿™ç§æ–¹å¼å¯ä»¥ç§°ä¸ºè®¢é˜… case PENDING: this.onFulfilledCallbacks.push(() =&gt; &#123; try &#123; const x = onFulfilled(this.value); resolve(x); &#125; catch (err) &#123; reject(err); &#125; &#125;); this.onRejectedCallbacks.push(() =&gt; &#123; try &#123; const x = onRejected(this.reason); resolve(x); &#125; catch (err) &#123; reject(err); &#125; &#125;); break; case FULFILLED: //æ‰§è¡ŒæˆåŠŸçš„å›è°ƒå‡½æ•°onFilfulledï¼Œä¼ å…¥æˆåŠŸç»“æœ this.value try &#123; const x = onFulfilled(this.value); resolve(x); &#125; catch (err) &#123; reject(err); &#125; break; case REJECTED: //æ‰§è¡ŒæˆåŠŸçš„å›è°ƒå‡½æ•°onRejectedï¼Œä¼ å…¥æ‹’ç»ç»“æœ this.reason try &#123; const x = onRejected(this.reason); resolve(x); &#125; catch (err) &#123; reject(err); &#125; break; default: break; &#125; &#125;); &#125; /** * æ•è·reject * @param &#123;*&#125; onRejected ï¼šæ‹’ç» */ catch(onRejected) &#123; return this.then(null, onRejected); &#125;&#125; æµ‹è¯•myPromise.js123456789101112131415161718192021222324const p = new myPromise((resolve, reject) =&gt; &#123; setTimeout(() =&gt; &#123; resolve(1); &#125;, 1000);&#125;);p.then(res =&gt; &#123; console.log(res); // 1 return \"2\"; &#125;) .then(res =&gt; &#123; console.log(res); // 2 return &#123; a: 3 &#125;; &#125;) .then(res =&gt; &#123; console.log(res); // &#123;a:3&#125; return undefined; &#125;) .then(res =&gt; &#123; console.log(res); // undefined &#125;) .then(res =&gt; &#123; console.log(res); // undefined &#125;); thenä¸­å‡½æ•°è¿”å›å€¼çš„å¤„ç† éæ™®é€šå€¼æƒ…å†µã€‚ è¿™é‡Œè¿˜æœ‰ç±»å‹åˆ¤æ–­ã€å‚æ•°é€ä¼ ç­‰é—®é¢˜å¤„ç†ï¼Œåç»­å®Œæˆ Promise/A+è§„èŒƒ Promise/A+ è§„èŒƒ","link":"/2019/03/10/æ‹¾é—JavaScriptâ€”â€”Promise/"},{"title":"Javascriptâ€”â€”å…³äºç»§æ‰¿","text":"ç»§æ‰¿ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹çœ‹äº†å¿˜ï¼Œå¿˜äº†è®°ï½ åŸå‹é“¾ç»§æ‰¿ æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªéšå¼å±æ€§__proto__å…¶æŒ‡å‘è¯¥å¯¹è±¡çš„æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ã€‚prototypeã€‚ æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡prototypeä¸­åŒ…å«ä¸€ä¸ªconstructorå±æ€§ï¼Œå…¶æŒ‡å‘æ„é€ å‡½æ•°æœ¬èº«ã€‚ å› æ­¤ï¼Œå¯ä»¥é€šè¿‡é‡å†™åŸå‹å¯¹è±¡ï¼Œæ›¿æ¢ä¸ºçˆ¶ç±»çš„å®ä¾‹ï¼Œä»è€Œæ‹¥æœ‰çˆ¶ç±»å®ä¾‹çš„å…¨éƒ¨å±æ€§åŠæ–¹æ³•ã€‚è¿™ç§æ–¹å¼å³åŸå‹é“¾ç»§æ‰¿ ğŸŒ°123456789101112131415function Parent() &#123; this.name = \"Parent\"; this.numbers = [1, 2];&#125;Parent.prototype.getNumbers = function() &#123; console.log(this.numbers);&#125;;function Child() &#123;&#125;// é‡å†™åŸå‹å¯¹è±¡Child.prototype = new Parent();const child_1 = new Child();console.log(child_1.name); // Parentchild_1.getNumbers(); // [1, 2] è¿™ç§ç»§æ‰¿æ–¹å¼å¾ˆæ˜æ˜¾çš„ç¼ºç‚¹æ˜¯: å¯¹äºå¼•ç”¨ç±»å‹çš„å±æ€§ï¼Œå®ƒä¼šè¢«æ‰€æœ‰å®ä¾‹å…±äº«ã€‚ æ— æ³•å‘çˆ¶ç±»ä¼ é€’å‚æ•° 123child_1.numbers.push(3);const child_2 = new Child();console.log(child_2.numbers); // [1, 2, 3] å€Ÿç”¨æ„é€ å‡½æ•°ğŸŒ°1234567891011121314function Parent(numbers) &#123; this.numbers = numbers;&#125;function Child(numbers) &#123; // è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•° Parent.call(this, numbers);&#125;const child_1 = new Child([3, 4]);console.log(child_1.numbers); //[3, 4]const child_2 = new Child([5]);console.log(child_2.numbers); // [5] ç›¸è¾ƒä¸åŸå‹å¼ç»§æ‰¿ï¼Œå€Ÿç”¨æ„é€ å‡½æ•°çš„æ–¹å¼å¯ä»¥ï¼š ä¼ é€’å‚æ•° å¼•ç”¨ç±»å‹å±æ€§ä¸ä¼šè¢«å®ä¾‹å…±äº« ä½†â€¦. 12345678910// çˆ¶ç±»åŸå‹å±æ€§ä¸­çš„æ–¹æ³•ï¼Œå­ç±»æ— æ³•è®¿é—®Parent.prototype.getNumbers = function() &#123; console.log(this.numbers);&#125;;const child_1 = new Child([3, 4]);child_1.getNumbers(); // TypeError: child_1.getNumbers is not a functionconst child_2 = new Child([5]);child_2.getNumbers(); // TypeError: child_1.getNumbers is not a function å¾ˆæ˜æ˜¾çš„ç¼ºç‚¹æ˜¯: çˆ¶ç±»çš„åŸå‹æ–¹æ³•å­ç±»æ˜¯æ— æ³•è®¿é—®åˆ°çš„ï¼Œå¿…é¡»åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ã€‚å› æ­¤ï¼Œå¯¹äºæ–¹æ³•å®šä¹‰æ¥è¯´ï¼Œæ¯æ¬¡åˆ›å»ºå®ä¾‹éƒ½é‡æ–°åˆ›å»ºä¸€éæ–¹æ³•ã€‚ ç»„åˆç»§æ‰¿ï¼ˆåŸå‹åŠ å€Ÿç”¨æ„é€ å‡½æ•°çš„æ–¹å¼ï¼‰ğŸŒ°1234567891011121314151617181920212223242526272829303132function Parent(name) &#123; this.name = name; this.colors = [\"red\", \"blue\"];&#125;Parent.prototype.getColors = function() &#123; console.log(this.colors);&#125;;function Child(name, age) &#123; // å€Ÿç”¨çˆ¶ç±»æ„é€ å‡½æ•° Parent.call(this, name); this.age = age;&#125;// é‡å†™åŸå‹å¯¹è±¡ï¼ˆåŸå‹é“¾ç»§æ‰¿ï¼‰Child.prototype = new Parent();Child.prototype.constructor = Child;Child.prototype.getAge = function() &#123; console.log(this.age);&#125;;const child_1 = new Child(\"Ben\", 12);console.log(child_1.name); // Benchild_1.getAge(); // 12child_1.colors.push(\"gray\"); child_2.getColors(); // [\"red\",\"blue\",\"gray\"]const child_2 = new Child(\"Obi\", 20);console.log(child_2.name); // Obichild_2.getAge(); // 20child_2.getColors(); // [\"red\",\"blue\"] ç»„åˆç»§æ‰¿å¾ˆå¥½çš„é¿å¼€äº†åŸå‹é“¾ç»§æ‰¿ä¸å€Ÿç”¨æ„é€ å‡½æ•°ç»§æ‰¿çš„ç¼ºç‚¹ï¼Œé¿å…äº†å¼•ç”¨ç±»å‹å±æ€§å…±äº«åˆå¯ä»¥å¯¹æ–¹æ³•è¿›è¡Œå¤ç”¨ã€‚ ä½†æ˜¯â€¦è¿˜æœ‰ä¸€ä¸ªç¼ºé™·å°±æ˜¯ï¼šåœ¨åˆ›å»ºå­ç±»çš„å®ä¾‹æ—¶ï¼Œä¼šè°ƒç”¨2æ¬¡çˆ¶ç±»çš„çš„æ„é€ å‡½æ•°ï¼Œä»è€Œå­ç±»çš„prototypeä¸Šä¼šæœ‰ä¸å¿…è¦å¤šä½™çš„å±æ€§ã€‚ 12345function Child(name, age) &#123; // å€Ÿç”¨çˆ¶ç±»æ„é€ å‡½æ•° Parent.call(this, name);&#125;Child.prototype = new Parent(); åŸå‹ç»§æ‰¿ å€ŸåŠ©åŸå‹å¯ä»¥åŸºäºå·²æœ‰çš„çš„å¯¹è±¡åˆ›å»ºæ–°å¯¹è±¡ï¼ŒåŒæ—¶è¿˜ä¸å¿…å› æ­¤åˆ›å»ºè‡ªå®šä¹‰ç±»å‹ã€‚â€”â€” é“æ ¼æ‹‰æ–¯Â·å…‹ç½—å…‹ç¦å¾· 12345function object(obj) &#123; function F()&#123;&#125; F.prototype = o; retrun new F();&#125; ä¸Šé¢çš„æ–¹æ³•object()ï¼Œä¹Ÿæ˜¯ES5ä¸­object.create()çš„æ¨¡æ‹Ÿå®ç°ã€‚ åœ¨object()å‡½æ•°å†…éƒ¨ï¼Œåˆ›å»ºä¸€ä¸ªä¸´æ—¶æ„é€ å‡½æ•°ï¼Œå°†ä¼ å…¥çš„å¯¹è±¡ä½œä¸ºè¿™ä¸ªæ„é€ å‡½æ•°çš„åŸå‹ï¼Œç„¶åè¿”å›è¿™ä¸ªä¸´æ—¶ç±»å‹çš„ä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚ ğŸŒ°12345678910111213var Parent = &#123; name: \"Parent\", colors: [\"red\", \"green\"]&#125;;const child_1 = object(Parent);child_1.name = \"child_1\";child_1.colors.push(\"blue\");console.log(child_1.name); // child_1const child_2 = object(Parent);child_2.name = \"child_2\";console.log(child_2.name); // child_2console.log(child_2.colors); //[\"red\", \"green\", \"blue\"] è¿™ç§æ–¹å¼ä¸åŸå‹é“¾ç»§æ‰¿ä¸€æ ·ï¼Œå¯¹äºå¼•ç”¨ç±»å‹çš„å±æ€§ä¼šè¢«æ‰€ä»¥å®ä¾‹å…±äº«ã€‚ å¯„ç”Ÿå¼ç»§æ‰¿å¯„ç”Ÿå¼ç»§æ‰¿ä¾èµ–åŸå‹ç»§æ‰¿æ¨¡å¼ï¼Œç±»ä¼¼ä¸å·¥å‚æ¨¡å¼ï¼Œä»…æ˜¯åœ¨å‡½æ•°å†…éƒ¨å¯¹å¯¹è±¡è¿›è¡Œå¢å¼ºï¼Œæœ€åè¿”å›å¯¹è±¡ã€‚ ğŸŒ°1234567891011121314function factory(o) &#123; let clone = Object.create(o); clone.sayHi = function() &#123; console.log(\"Hi!\"); &#125;; return clone;&#125;var Parent = &#123; name: \"Parent\"&#125;;const child = factory(Parent);child.sayHi(); // Hi! ç»„åˆå¯„ç”Ÿå¼ç»§æ‰¿ğŸŒ°1234567891011121314151617181920212223242526272829303132function Parent(name) &#123; this.name = name; this.colors = [\"red\", \"blue\"];&#125;Parent.prototype.getColors = function() &#123; console.log(this.colors);&#125;;function Child(name, age) &#123; // å€Ÿç”¨çˆ¶ç±»æ„é€ å‡½æ•° Parent.call(this, name); this.age = age;&#125;// é‡å†™å­ç±»åŸå‹// è·å¾—çˆ¶ç±»åŸå‹çš„å‰¯æœ¬Child.prototype = Object.create(Parent.prototype);Child.prototype.constructor = Child; // ä¸Šä¸€è¡Œä»£ç é‡å†™äº†å­ç±»çš„åŸå‹ï¼Œå› æ­¤è¦é‡æ–°æŒ‡å®šå­ç±»çš„æ„é€ å‡½æ•°Child.prototype.getAge = function() &#123; console.log(this.age);&#125;;const child_1 = new Child(\"Ben\", 12);console.log(child_1.name); // Benchild_1.getAge(); // 12child_1.colors.push(\"gray\");const child_2 = new Child(\"Obi\", 20);console.log(child_2.name); // Obichild_2.getAge(); // 20child_2.getColors(); // [\"red\", \"blue\"] ç»„åˆå¼ç»§æ‰¿æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯ä¼šè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°2æ¬¡ï¼Œå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿é¿å…äº†è¿™ä¸€ç‚¹ï¼ŒåŒæ—¶ä¿æŒåŸå‹é“¾ä¸å˜ï¼Œèƒ½æ­£å¸¸instanceofã€isPrototypeOfã€‚å› æ­¤æ˜¯æœ€ç†æƒ³çš„ç»§æ‰¿æ–¹å¼ã€‚ å¯¹æ¯” ç»„åˆç»§æ‰¿ å¯ä»¥çœ‹åˆ°åœ¨å­ç±»çš„åŸå‹prototypeä¸Šï¼Œå¤šäº†colors,nameå±æ€§ å¯„ç”Ÿç»„åˆç»§æ‰¿ colorsã€nameï¼Œæ˜¯çˆ¶ç±»çš„å®ä¾‹å±æ€§ï¼Œåœ¨é‡å†™å­ç±»åŸå‹å±æ€§prototypeæ—¶ï¼ˆChild.prototype = new Parent()ï¼‰ï¼Œå­ç±»çš„åŸå‹å±æ€§ä¾¿è·å¾—äº†çˆ¶ç±»å±æ€§çš„å‰¯æœ¬colors,nameã€‚ const child = new Child()ï¼šè°ƒç”¨å­ç±»Child()æ„é€ å‡½æ•°æ—¶åˆä¸€æ¬¡è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°(Parent.call(this, name))ã€‚å­ç±»å®ä¾‹child_1å› æ­¤è·å¾—çˆ¶ç±»çš„å®ä¾‹å±æ€§colors,nameï¼ŒåŒæ—¶ä¹Ÿå±è”½äº†å­ç±»åŸå‹å±æ€§prototypeä¸­çš„colors,nameã€‚ ä¸¤æ¬¡è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°å¯¼è‡´äº†å­ç±»Child()çš„åŸå‹å±æ€§prototypeå’Œå­ç±»å®ä¾‹child_1ä¸­éƒ½è·å¾—äº†çˆ¶ç±»çš„å®ä¾‹å±æ€§colors,nameã€‚ å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿çš„åŸºæœ¬æ€è·¯å°±æ˜¯ï¼šé€šè¿‡å€Ÿç”¨æ„é€ å‡½æ•°æ¥ç»§æ‰¿å±æ€§ï¼Œé€šè¿‡åŸå‹é“¾æ¥ç»§æ‰¿æ–¹æ³•ã€‚ æ€»ç»“Javascriptä¸»è¦é€šè¿‡åŸå‹é“¾å®ç°ç»§æ‰¿ã€‚ åŸå‹é“¾çš„æ„å»ºæ˜¯é€šè¿‡å°†ä¸€ä¸ªç±»å‹çš„å®ä¾‹èµ‹äºˆå¦ä¸€ä¸ªæ„é€ å‡½æ•°çš„åŸå‹å±æ€§prototypeè€Œå®ç°çš„ã€‚é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œå­ç±»å°±èƒ½è®¿é—®çˆ¶ç±»çš„æ‰€æœ‰å±æ€§åŠæ–¹æ³•ã€‚åŸå‹é“¾çš„æ–¹å¼å­˜åœ¨ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯æ‰€æœ‰å®ä¾‹å…±äº«æ‰€æœ‰å±æ€§åŠæ–¹æ³•ã€‚å› æ­¤éœ€è¦å€Ÿç”¨æ„é€ å‡½æ•°çš„æ–¹å¼â€”â€”åœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™æ ·å­ç±»å®ä¾‹éƒ½ä¼šæœ‰å•ç‹¬çš„å±æ€§å’Œæ–¹æ³•ã€‚ åŸå‹é“¾ç»§æ‰¿ï¼šé€šè¿‡é‡å†™å­ç±»åŸå‹çš„æ–¹å¼è·å¾—çˆ¶ç±»å±æ€§åŠæ–¹æ³•åŠæŒ‡å‘çˆ¶ç±»æ„é€ å‡½æ•°çš„æŒ‡é’ˆã€‚ ç¼ºç‚¹ å¼•ç”¨ç±»å‹æ‰€æœ‰å®ä¾‹å…±äº«ã€‚ æ— æ³•ä¼ é€’å‚æ•°ã€‚ æ„é€ å‡½æ•°ç»§æ‰¿ï¼šé€šè¿‡å­ç±»çš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ä»è€Œè·çˆ¶ç±»å±æ€§ã€‚ ä¼˜ç‚¹ æ¯ä¸ªå­ç±»å®ä¾‹éƒ½æœ‰ä¸€ä»½çˆ¶ç±»å±æ€§çš„æ‹·è´ï¼Œè§£å†³å¼•ç”¨ç±»å‹å±æ€§å…±äº«çš„é—®é¢˜ã€‚ ç¼ºç‚¹ å­ç±»å®ä¾‹æ— æ³•è®¿é—®çˆ¶ç±»prototypeä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œå› æ­¤æ–¹æ³•å¿…é¡»å®šä¹‰åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œæ¯æ¬¡åˆ›å»ºå®ä¾‹éƒ½è¦é‡æ–°åˆ›å»ºä¸€æ¬¡æ–¹æ³•ã€‚ ç»„åˆç»§æ‰¿ï¼ˆç»å…¸ç»§æ‰¿ï¼‰ï¼š ä¼˜ç‚¹ é¿å¼€äº†åŸå‹é“¾ç»§æ‰¿åŠæ„é€ å‡½æ•°ç»§æ‰¿çš„ç¼ºç‚¹ã€‚ ç¼ºç‚¹ ä¸¤æ¬¡è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°ã€‚ åŸå‹å¼ç»§æ‰¿ï¼šæ— éœ€å®šä¹‰æ„é€ å‡½æ•°çš„æƒ…å†µä¸‹å®ç°ç»§æ‰¿ã€‚å…¶æœ¬è´¨æ˜¯å¯¹ç›®æ ‡å¯¹è±¡çš„æµ…å¤åˆ¶ï¼Œä»è€Œå¾—åˆ°å¯¹è±¡çš„å‰¯æœ¬ã€‚ ç¼ºç‚¹ ä¸åŸå‹é“¾å¼ç»§æ‰¿ä¸€æ ·ï¼Œæ‰€æœ‰å®ä¾‹å…±äº«å¼•ç”¨ç±»å‹å±æ€§ã€‚ å¯„ç”Ÿå¼ç»§æ‰¿ï¼šç±»ä¼¼ä¸å·¥å‚æ¨¡å¼ï¼Œç»“åˆåŸå‹å¼ç»§æ‰¿çš„æ–¹å¼ï¼Œå¯¹ç›®æ ‡å¯¹è±¡è¿›è¡Œæµ…å¤åˆ¶è·å¾—æ–°å¯¹è±¡ï¼Œå¹¶å¯¹æ–°å¯¹è±¡è¿›è¡Œå¢å¼ºåŠ å·¥ï¼Œæœ€åè¿”å›è¿™ä¸ªæ–°å¯¹è±¡ ç¼ºç‚¹ æ¯æ¬¡åˆ›å»ºå®ä¾‹å°±æ˜¯ä¸€æ¬¡å¯¹è±¡å¢å¼ºåŠ å·¥ï¼Œå› æ­¤éƒ½ä¼šåˆ›å»ºä¸€éå¯¹è±¡çš„æ–¹æ³•ã€‚ å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿: ç»“åˆå¯„ç”Ÿç»§æ‰¿åŠç»„åˆå¼ç»§æ‰¿çš„ä¼˜ç‚¹ï¼Œæ˜¯ç»§æ‰¿æœ€æœ‰æ•ˆçš„æ–¹å¼ã€‚","link":"/2019/08/13/Javascriptâ€”â€”å…³äºç»§æ‰¿/"},{"title":"æ‹¾é—JavaScriptâ€”â€”callã€applyã€bind","text":"call()call() æ–¹æ³•ä½¿ç”¨ä¸€ä¸ªæŒ‡å®šçš„ this å€¼å’Œå•ç‹¬ç»™å‡ºçš„ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°æ¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ã€‚(MDN) https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/call ğŸŒ°åŸºæœ¬ç”¨æ³•123456789101112var a = 2;function foo() &#123; console.log(this.a);&#125;const bar = &#123; a: 1&#125;;var a = 2;// éšå¼è°ƒç”¨ï¼ŒthisæŒ‡å‘windowfoo(); // 2 // æ”¹å˜thisæŒ‡å‘barfoo.call(bar); // 2 æ„é€ å‡½æ•°å¼ç»§æ‰¿åœ¨ä¸€ä¸ªå­æ„é€ å‡½æ•°ä¸­ï¼Œé€šè¿‡è°ƒç”¨çˆ¶æ„é€ å‡½æ•°çš„ call æ–¹æ³•æ¥å®ç°ç»§æ‰¿ã€‚ 123456789101112function Product(name, price) &#123; this.name = name; this.price = price;&#125;function Food(name, price) &#123; // åœ¨Foodçš„æ„é€ å‡½æ•°ä¸­è°ƒç”¨çˆ¶ç±»Productçš„æ„é€ å‡½æ•° // thisæŒ‡å‘Food Product.call(this, name, price); this.categroy = \"food\";&#125;// å¯¹è±¡å®ä¾‹æ‹¥æœ‰åœ¨ Product æ„é€ å‡½æ•°ä¸­æ·»åŠ çš„ name å±æ€§å’Œ price å±æ€§ã€‚const cheese = new Food(\"cheese\", 10); å¦‚ä½•æ¨¡æ‹Ÿå®ç°call()è¯­æ³•ï¼šfun.call(thisArg, arg1, arg2, ...) 1234567891011function foo() &#123; console.log(this.a);&#125;const bar = &#123; a: 1, foo: function() &#123; console.log(this.a); &#125;&#125;;bar.foo(); // 1foo.call(bar); // 1 å‡è®¾å½“è°ƒç”¨foo.call(bar)æ—¶ï¼Œå…¶å®æ˜¯åœ¨barä¸Šæ·»åŠ ä¸€ä¸ªfooå±æ€§ï¼Œè¿™æ ·fooå‡½æ•°ä¸­çš„thisä¾¿æŒ‡å‘äº†barã€‚ bar.fn = foo; bar.fn(); delete bar.fn Step 11234567891011121314Function.prototype.customizeCall = function(context) &#123; context.fn = this; // è·å–è°ƒç”¨customizeCallçš„å‡½æ•°ï¼Œæ·»åŠ åˆ°ä¸´æ—¶å±æ€§fn context.fn(); // æ‰§è¡Œå‡½æ•° delete context.fn; // åˆ é™¤fnå±æ€§&#125;;function foo() &#123; console.log(this.a);&#125;const bar = &#123; a: 1&#125;;foo.customizeCall(bar); // 1 Step 2fun.call() é™¤äº†ä¼ å…¥è¿è¡Œæ—¶æŒ‡å®šçš„ç»‘å®šthisçš„ç›®æ ‡ï¼Œè¿˜éœ€è¦ä¼ å…¥å‚æ•°åˆ—è¡¨args 12345678910111213141516171819202122232425262728293031Function.prototype.customizeCall = function(context) &#123; // è·å–è°ƒç”¨customizeCallæ–¹æ³•çš„å‡½æ•°ï¼Œæ·»åŠ åˆ°ä¸´æ—¶å±æ€§fn context.fn = this; // è·å–ä¼ å…¥çš„å‚æ•° // å‡½æ•°å‚æ•°æ•°ç»„argumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„ï¼Œå¯ä»¥forå¾ªç¯ let args = []; // ä¿å­˜å‚æ•° for (let i = 1; i &lt; arguments.length; i++) &#123; // æ‹¼æ¥å‚æ•°ä¸ºå­—ç¬¦ä¸²pushè¿›argsï¼Œåç»­éœ€è¦ç”¨åˆ°eval() // args[\"arguments[1]\", \"arguments[2]\", ...] args.push(\"arguments[\" + i + \"]\"); &#125; // eval() å‡½æ•°ä¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²å½“åš JavaScript ä»£ç è¿›è¡Œæ‰§è¡Œã€‚ // context.fn(arguments[1], ...); console.log(args); eval(\"context.fn(\" + args + \")\"); // context.fn(); delete context.fn;&#125;;function foo(name, age) &#123; console.log(this.a); console.log(name); console.log(age);&#125;const bar = &#123; a: 1&#125;;foo.customizeCall(bar, \"Ken\", 12); // 1, ken, 12 Step 3 call æ–¹æ³•å¯ä»¥ä¸æŒ‡å®šç¬¬ä¸€ä¸ªå‚æ•°çš„ï¼ˆthisï¼‰çš„ã€‚ æ²¡æœ‰ä¼ é€’ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œthis çš„å€¼å°†ä¼šè¢«ç»‘å®šä¸ºå…¨å±€å¯¹è±¡ã€‚ ä¸¥æ ¼æ¨¡å¼ä¸‹æŒ‡å‘undefinedã€‚ call æ–¹æ³•æ˜¯å¯ä»¥æœ‰è¿”å›å€¼çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536Function.prototype.customizeCall = function(context) &#123; //ä¸ä¼ å…¥thisçš„æƒ…å†µä¸‹é»˜è®¤æŒ‡å‘window // Object(context)ï¼šç¡®ä¿ä¼ å…¥çš„æ˜¯å¯¹è±¡ context = Object(context) || window; // è·å–è°ƒç”¨customizeCallæ–¹æ³•çš„å‡½æ•°ï¼Œæ·»åŠ åˆ°ä¸´æ—¶å±æ€§fn context.fn = this; // è·å–ä¼ å…¥çš„å‚æ•° // å‡½æ•°å‚æ•°æ•°ç»„argumentsæ˜¯ä¸€ä¸ªç±»æ•°ç»„ï¼Œå¯ä»¥forå¾ªç¯ let args = []; // ä¿å­˜å‚æ•° for (let i = 1; i &lt; arguments.length; i++) &#123; // æ‹¼æ¥å‚æ•°ä¸ºå­—ç¬¦ä¸² // args[\"arguments[1]\", \"arguments[2]\", ...] args.push(\"arguments[\" + i + \"]\"); &#125; // eval() å‡½æ•°ä¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²å½“åš JavaScript ä»£ç è¿›è¡Œæ‰§è¡Œã€‚ // context.fn(arguments[1], ...); console.log(args); const result = eval(\"context.fn(\" + args + \")\"); // context.fn(); delete context.fn; return result;&#125;;function foo(name, age) &#123; return &#123; a: this.a, name: name, age: age &#125;;&#125;const bar = &#123; a: 1&#125;;console.log(foo.customizeCall(bar, \"Ken\", 12)); // &#123;a:1, name:ken, age:12&#125; ä½¿ç”¨ES6è¯­æ³•å®ç° 1234567891011Function.prototype.customizeCall = function(context, â€¦args) &#123; //ä¸ä¼ å…¥thisçš„æƒ…å†µä¸‹é»˜è®¤æŒ‡å‘window // Object(context)ï¼šç¡®ä¿ä¼ å…¥çš„æ˜¯å¯¹è±¡ context = Object(context) || window;; // è·å–è°ƒç”¨customizeCallæ–¹æ³•çš„å‡½æ•°ï¼Œæ·»åŠ åˆ°ä¸´æ—¶å±æ€§fn context.fn = this; // â€¦æ‰©å±•è¯­æ³•è·å–ä¼ å…¥çš„å‚æ•°ï¼Œå¹¶æ·»åŠ åˆ°æ‰§è¡Œçš„å‡½æ•°é‡Œ const result = context.fn(â€¦args); delete context.fn; return result;&#125;; apply()apply() æ–¹æ³•è°ƒç”¨ä¸€ä¸ªå…·æœ‰ç»™å®šthiså€¼çš„å‡½æ•°ï¼Œä»¥åŠä½œä¸ºä¸€ä¸ªæ•°ç»„ï¼ˆæˆ–ç±»ä¼¼æ•°ç»„å¯¹è±¡ï¼‰æä¾›çš„å‚æ•°ã€‚ ä¸call()æ–¹æ³•ç±»ä¼¼ï¼ŒåŒºåˆ«å°±æ˜¯call()æ–¹æ³•æ¥å—çš„æ˜¯å‚æ•°åˆ—è¡¨ï¼Œè€Œapply()æ–¹æ³•æ¥å—çš„æ˜¯ä¸€ä¸ªå‚æ•°æ•°ç»„ã€‚MDN:https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/apply æ¨¡æ‹Ÿå®ç°1234567891011121314151617181920212223242526272829303132333435363738394041Function.prototype.customizeApply = function(context, arr) &#123; //ä¸ä¼ å…¥thisçš„æƒ…å†µä¸‹é»˜è®¤æŒ‡å‘window // Object(context)ï¼šç¡®ä¿ä¼ å…¥çš„æ˜¯å¯¹è±¡ context = Object(context) || window; // è·å–è°ƒç”¨customizeCallæ–¹æ³•çš„å‡½æ•°ï¼Œæ·»åŠ åˆ°ä¸´æ—¶å±æ€§fn context.fn = this; let result = null; // å¦‚æœæ²¡æœ‰ä¼ å…¥å‚æ•°åˆ—è¡¨ï¼Œåˆ™ç›´æ¥æ‰§è¡Œ if (!arr) &#123; result = context.fn(); &#125; else &#123; // è·å–ä¼ å…¥çš„å‚æ•° // forå¾ªç¯å‡½æ•°å‚æ•°æ•°ç»„arr // ä¿å­˜å‚æ•° let args = []; for (let i = 0; i &lt; arr.length; i++) &#123; // æ‹¼æ¥å‚æ•°ä¸ºå­—ç¬¦ä¸² // args[\"arr[1]\", \"arr[2]\", ...] args.push(\"arr[\" + i + \"]\"); &#125; // eval() å‡½æ•°ä¼šå°†ä¼ å…¥çš„å­—ç¬¦ä¸²å½“åš JavaScript ä»£ç è¿›è¡Œæ‰§è¡Œã€‚ // context.fn(arguments[1], ...); result = eval(\"context.fn(\" + args + \")\"); &#125; // context.fn(); delete context.fn; return result;&#125;;function foo(name, age) &#123; return &#123; a: this.a, name: name, age: age &#125;;&#125;const bar = &#123; a: 1&#125;;console.log(foo.customizeApply(bar, [\"Ken\", 12])); // &#123;a:1, name:ken, 12&#125; ä½¿ç”¨ES6æ‰©å±•è¯­æ³•å®ç° 123456789101112131415Function.prototype.customizeApply = function(context, arr) &#123; //ä¸ä¼ å…¥thisçš„æƒ…å†µä¸‹é»˜è®¤æŒ‡å‘window // Object(context)ï¼šç¡®ä¿ä¼ å…¥çš„æ˜¯å¯¹è±¡ context = Object(context) || window; // è·å–è°ƒç”¨customizeCallæ–¹æ³•çš„å‡½æ•°ï¼Œæ·»åŠ åˆ°ä¸´æ—¶å±æ€§fn context.fn = this; let result = null; if (!arr) &#123; result = context.fn(); &#125; else &#123; result = context.fn(â€¦arr); &#125; delete context.fn; return result;&#125;; bind()bind()æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°ï¼Œåœ¨bind()è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªæ–°å‡½æ•°çš„thisè¢«bindçš„ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šï¼Œå…¶ä½™çš„å‚æ•°å°†ä½œä¸ºæ–°å‡½æ•°çš„å‚æ•°ä¾›è°ƒç”¨æ—¶ä½¿ç”¨ã€‚ bind() æœ€ç®€å•çš„ç”¨æ³•æ˜¯åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œä¸è®ºæ€ä¹ˆè°ƒç”¨ï¼Œè¿™ä¸ªå‡½æ•°éƒ½æœ‰åŒæ ·çš„ this å€¼ã€‚ å¯ä»¥ä¼ å‚ è¿”å›ä¸€ä¸ªå‡½æ•° MDN:https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/bind æ¨¡æ‹Ÿå®ç°123456789101112131415161718192021222324252627282930313233Function.prototype.customizeBind = function(toThis) &#123; //bind çš„ä¸æ˜¯å‡½æ•°æ—¶æŠ›å‡ºé”™è¯¯ if (typeof this !== \"function\") &#123; throw new Error( \"Function.prototype.bind - what is trying to be bound is not callable\" ); &#125; // è·å–ä¼ å…¥çš„å‚æ•° var args = Array.prototype.slice(arguments, 1), self = this, fNOP = function() &#123;&#125;, fBound = function() &#123; return self.apply( // this instanceof fBound === trueæ—¶,è¯´æ˜è¿”å›çš„fBoundè¢«å½“åšnewçš„æ„é€ å‡½æ•°è°ƒç”¨,å°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘è¯¥å®ä¾‹ï¼Œå¯ä»¥è®©å®ä¾‹è·å¾—æ¥è‡ªç»‘å®šå‡½æ•°çš„å€¼; // this instanceof fBound === falseæ—¶ï¼Œè¯´æ˜fBoundè¢«å½“åšæ™®é€šå‡½æ•°è°ƒç”¨ï¼Œthis æŒ‡å‘ windowï¼Œå°†ç»‘å®šå‡½æ•°çš„ this æŒ‡å‘ toThis; this instanceof fBound ? this : toThis, // è·å–è°ƒç”¨æ—¶(fBound)çš„ä¼ å‚ args.concat(Array.prototype.slice.call(arguments)) ); &#125;; // ç»´æŠ¤åŸå‹å…³ç³» // è¿”å›çš„å‡½æ•° if (this.prototype) &#123; //è¿”å›å‡½æ•°çš„ prototype ä¸ºç»‘å®šå‡½æ•°çš„ prototypeï¼Œ fNOP.prototype = this.prototype; &#125; // å®ä¾‹å°±å¯ä»¥ç»§æ‰¿ç»‘å®šå‡½æ•°çš„åŸå‹ä¸­çš„å€¼ï¼ˆ__proto__æŒ‡å‘fNOPçš„å®ä¾‹ï¼‰ fBound.prototype = new fNOP(); // è¿”å›å‡½æ•° // è¿”å›ä¸€ä¸ªåŸå‡½æ•°çš„æ‹·è´ï¼Œå¹¶æ‹¥æœ‰æŒ‡å®šçš„thiså€¼å’Œåˆå§‹å‚æ•° return fBound;&#125;; æ¨¡æ‹Ÿå®ç°å‚è€ƒmqyqingfeng:https://github.com/mqyqingfeng/Blog/issues/11","link":"/2019/06/10/æ‹¾é—JavaScriptâ€”â€”callã€applyã€bind/"},{"title":"æ‹¾é—JavaScriptâ€”â€”Event Loop","text":"Event Loop ä¸€ã€åŸºç¡€çŸ¥è¯†1ã€è¿›ç¨‹ä¸çº¿ç¨‹ è¿›ç¨‹ï¼šåº”ç”¨ç¨‹åºçš„æ‰§è¡Œå®ä¾‹ï¼Œæ¯ä¸€ä¸ªè¿›ç¨‹éƒ½æ˜¯ç”±ç§æœ‰çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€ä»£ç ã€æ•°æ®ä¸ªå…¶ä»–ç³»ç»Ÿèµ„æºç»„æˆã€‚ çº¿ç¨‹ï¼šçº¿ç¨‹æ˜¯è¿›ç¨‹å†…çš„ä¸€ä¸ªç‹¬ç«‹æ‰§è¡Œå•å…ƒï¼Œåœ¨ä¸åŒçš„çº¿ç¨‹ä¹‹é—´å¯ä»¥è¿›è¡Œèµ„æºå…±äº«ã€‚ è¿›ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„å †æ ˆç©ºé—´å’Œæ•°æ®æ®µï¼Œæ¯å½“å¯åŠ¨ä¸€ä¸ªæ–°çš„è¿›ç¨‹å¿…é¡»åˆ†é…ç»™å®ƒç‹¬ç«‹çš„åœ°å€ç©ºé—´ï¼Œå»ºç«‹ä¼—å¤šçš„æ•°æ®è¡¨æ¥ç»´æŠ¤å®ƒçš„ä»£ç æ®µã€å †æ ˆæ®µå’Œæ•°æ®æ®µã€‚ çº¿ç¨‹æ‹¥æœ‰ç‹¬ç«‹çš„å †æ ˆç©ºé—´ï¼Œä½†æ˜¯å…±äº«æ•°æ®æ®µï¼Œå®ƒä»¬å½¼æ­¤ä¹‹é—´ä½¿ç”¨ç›¸åŒçš„åœ°å€ç©ºé—´ï¼Œå…±äº«å¤§éƒ¨åˆ†æ•°æ®ï¼Œæ¯”è¿›ç¨‹æ›´åŠ èŠ‚ä¿­ï¼Œå¼€é”€æ¯”è¾ƒå°ï¼Œåˆ‡æ¢é€Ÿåº¦å¿«ï¼Œæ•ˆç‡é«˜ã€‚ ä¸€å¥è¯æ€»ç»“: è¿›ç¨‹ï¼šèµ„æºåˆ†é…çš„æœ€å°å•ä½ çº¿ç¨‹ï¼šç¨‹åºæ‰§è¡Œçš„æœ€å°å•ä½ Javascriptæ˜¯ä¸€é—¨å•çº¿ç¨‹è¯­è¨€Why??ä¼—æ‰€å‘¨çŸ¥ï¼Œå¤šçº¿ç¨‹æ“ä½œå¯ä»¥å®ç°åº”ç”¨çš„å¹¶è¡Œå¤„ç†ï¼Œå……åˆ†åˆ©ç”¨CPUèµ„æºæé«˜æ€§èƒ½å’Œååé‡ã€‚ç°åœ¨å¾ˆå¤šè¯­è¨€éƒ½æ”¯æŒå¤šæ ¸å¹¶è¡Œå¤„ç†æŠ€æœ¯ã€‚ ä½†Javascriptâ€¦.ğŸ˜‚ Javascript æ˜¯ä¸€é—¨è„šæœ¬è¯­è¨€ï¼Œæœ€åˆè®¾è®¡ç”¨äºè¿è¡Œåœ¨æµè§ˆå™¨ç¯å¢ƒï¼Œè¯•æƒ³ä¸€ä¸‹å¦‚æœæœ‰2ä¸ªåŒæ­¥çº¿ç¨‹åœ¨è·‘ï¼Œä¸€ä¸ªåœ¨æ‰§è¡ŒDOMçš„æ’å…¥ï¼Œå¦ä¸€ä¸ªåˆ é™¤DOMï¼Œæµè§ˆå™¨ä¼šï¼Ÿï¼Ÿï¼Ÿï¼Ÿ Soâ€¦è¿™æ„å‘³ç€å®ƒå¯ä»¥ä¸€æ¬¡å¤„ç†ä¸€ä¸ªä»»åŠ¡æˆ–ä¸€æ¬¡å¤„ç†ä¸€æ®µä»£ç ã€‚å®ƒæœ‰ä¸€ä¸ªè°ƒç”¨å †æ ˆï¼Œå®ƒä¸å †ä¹‹ç±»çš„å…¶ä»–éƒ¨åˆ†ä¸€èµ·æ„æˆäº†Javascriptå¹¶å‘æ¨¡å‹ï¼ˆåœ¨V8å†…éƒ¨å®ç°ï¼‰ã€‚ Call StackCall Stackï¼šå®ƒæ˜¯ä¸€ä¸ªè®°å½•å‡½æ•°è°ƒç”¨çš„æ•°æ®ç»“æ„ï¼Œå½“æˆ‘ä»¬è°ƒç”¨å‡½æ•°æ—¶ï¼Œå‡½æ•°ä¼šè¢«æ¨å…¥è¿™ä¸ªå †æ ˆï¼Œä½†å‡½æ•°è¿”å›æ—¶æŒ‰å…ˆå…¥åå‡ºçš„è§„åˆ™ä¾æ¬¡æ¨å‡ºã€‚ 123456789101112function multiply(a, b) &#123; return a * b;&#125;function square(n) &#123; return multiply(n, n);&#125;function printSquare(n) &#123; var squared = square(n); console.log(squared);&#125;printSquare(4); é€šè¿‡æ–­ç‚¹è°ƒè¯•å¯ä»¥å¾ˆæ¸…æ¥šçš„çœ‹åˆ°è°ƒç”¨å †æ ˆ å½“å‡½æ•°æ‰§è¡Œå®Œè¿”å›æ—¶ï¼Œä¾æ¬¡ä»æ ˆé¡¶æ¨å‡ºã€‚ Heapheapï¼šå˜é‡æ‰€æœ‰çš„å†…å­˜åˆ†é…éƒ½åœ¨åœ¨å †ä¸­è¿›è¡Œã€‚ QueueJavascriptå•çº¿ç¨‹ä»»åŠ¡è¢«åˆ†ä¸ºåŒæ­¥ä»»åŠ¡å’Œå¼‚æ­¥ä»»åŠ¡ï¼ŒåŒæ­¥ä»»åŠ¡ä¼šåœ¨è°ƒç”¨æ ˆä¸­æŒ‰ç…§é¡ºåºç­‰å¾…ä¸»çº¿ç¨‹ä¾æ¬¡æ‰§è¡Œï¼Œå¼‚æ­¥ä»»åŠ¡ä¼šåœ¨å¼‚æ­¥ä»»åŠ¡æœ‰äº†ç»“æœåï¼Œå°†æ³¨å†Œçš„å›è°ƒå‡½æ•°æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ç­‰å¾…ä¸»çº¿ç¨‹ç©ºé—²çš„æ—¶å€™ï¼ˆè°ƒç”¨æ ˆè¢«æ¸…ç©ºï¼‰ï¼Œè¢«è¯»å–åˆ°æ ˆå†…ç­‰å¾…ä¸»çº¿ç¨‹çš„æ‰§è¡Œã€‚ 1234567891011console.log(\"1\");setTimeout(() =&gt; &#123; console.log(\"2\");&#125;, 3 * 1000);console.log(\"3\");// 1// 3// 2 å¦‚å›¾æ‰€ç¤ºï¼šæ‰§è¡Œæ ˆå…ˆå¤„ç†åŒæ­¥ä»»åŠ¡console.log(&#39;1&#39;)ï¼Œæ‰§è¡Œå®Œåæ¨å‡ºæ ˆï¼Œæ§åˆ¶å°è¾“å‡º1,setTimeout()è¿›å…¥æ‰§è¡Œæ ˆä½†ä¸ä¼šæ‰§è¡Œï¼Œè€Œæ˜¯ç”±Web API å¤„ç†å®Œæ¯•åï¼ŒåŠ å…¥ä»»åŠ¡é˜Ÿåˆ—ç­‰å¾…æ‰§è¡Œæ ˆçš„åŒæ­¥ä»»åŠ¡æ‰§è¡Œå®Œï¼ŒåŒæ­¥ä»»åŠ¡console.log(&#39;3&#39;)è¿›å…¥æ‰§è¡Œæ ˆï¼Œæ‰§è¡Œå®Œæ¯•åæ¨å‡ºæ ˆï¼Œå½“æ‰§è¡Œæ ˆä¸ºnullæ—¶ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ¨å…¥æ‰§è¡Œæ ˆæ‰§è¡Œã€‚ æ•´ä¸ªè¿‡ç¨‹æ˜¯å¾ªç¯ä¸æ–­çš„ï¼Œè¿™æ ·çš„è¿è¡Œæœºåˆ¶ç§°ä¸ºEvent Loop Event Loop ä¾µåˆ  è¡¥å……å®ä»»åŠ¡/å¾®ä»»åŠ¡å®ä»»åŠ¡ï¼ˆTaskï¼‰ï¼š æ•´ä½“ä»£ç script setTimeout setInterval setImmediate requestAnimationFrame I/O UI rendering å¾®ä»»åŠ¡(Microtask)ï¼š Promiseï¼ˆPromiseä¸­çš„thenã€catchæ‰æ˜¯å®ä»»åŠ¡ï¼Œæœ¬èº«å†…éƒ¨ä»£ç å¹¶ä¸æ˜¯ï¼‰ process.nextTickï¼ˆnodejsç¯å¢ƒä¸­ï¼‰ MutationObserverï¼š æä¾›äº†ç›‘è§†å¯¹DOMæ ‘æ‰€åšæ›´æ”¹çš„èƒ½åŠ›ï¼ˆhttps://developer.mozilla.org/zh-CN/docs/Web/API/MutationObserverï¼‰ 12345678910111213141516setTimeout(() =&gt; console.log('setTimeout1'), 0);setTimeout(() =&gt; &#123; console.log('setTimeout2'); Promise.resolve().then(() =&gt; &#123; console.log('promise2'); Promise.resolve().then(() =&gt; &#123; console.log('promise3'); &#125;) console.log(5) &#125;) setTimeout(() =&gt; console.log('setTimeout4'), 0);&#125;, 0);setTimeout(() =&gt; console.log('setTimeout3'), 0);Promise.resolve().then(() =&gt; &#123; console.log('promise1');&#125;) é€æ­¥åˆ†æä»£ç æ‰§è¡Œè¿‡ç¨‹:1ã€Run Script2ã€å¼€å§‹è½®è¯¢ï¼š setTimeout1ã€setTimeout2ã€setTimeout3 è¢«æ¨å…¥Task Queueï¼Œpromise1è¢«æ¨å…¥Microtasks Queueã€‚æ­¤æ—¶Task Queueä¸­ï¼š[setTimeout1,setTimeout2,setTimeout3]ï¼ŒMicrotasks Queueä¸­ï¼š[promise1]ã€‚3ã€å¾®ä»»åŠ¡ä¼˜äºå®ä»»åŠ¡ä¹‹å‰æ‰§è¡Œï¼Œæ‰€ä»¥å…ˆæ‰§è¡ŒMicrotasks Queueä¸­çš„é˜Ÿåˆ—promise1ï¼Œæ§åˆ¶å°è¾“å‡ºï¼špromise1ã€‚éšåä¾æ¬¡æ‰§è¡ŒsetTimeout1ã€setTimeout2ã€setTimeout3ï¼Œ4ã€æ‰§è¡Œï¼šsetTimeout1ï¼š è¾“å‡ºsetTimeout1ï¼›æ‰§è¡ŒsetTimeout2: è¾“å‡ºsetTimeout2ï¼Œå‘ç°ä¸€ä¸ªå¾®ä»»åŠ¡promise2,å°†å®ƒåŠ å…¥åˆ°Microtasks Queueï¼Œå‘ç°ä¸€ä¸ªå®ä»»åŠ¡setTimeout4ï¼Œå°†å®ƒåŠ å…¥Taskï¼›æ‰§è¡ŒsetTimeout3ï¼šè¾“å‡º setTimeout3;5ã€æ­¤æ—¶Microtasks Queueä¸­æœ‰[promise2]ï¼Œæ‰§è¡Œpromise2,è¾“å‡ºpromise2ï¼Œè¿™é‡Œåˆæœ‰ä¸ªå¾®ä»»åŠ¡promise3,å°†promise3åŠ å…¥Microtasks Queueï¼Œæ‰§è¡Œconsole.log(5),è¾“å‡º5ã€‚6ã€æ­¤æ—¶Microtasks Queueä¸ä¸ºnullï¼Œè¿˜æœ‰ä»»åŠ¡promise3,æ‰§è¡Œè¾“å‡ºpromise3ã€‚7ã€Microtasks Queueä¸ºnullï¼Œæ£€æŸ¥Task Queueï¼Œå‘ç°è¿˜æœ‰ä¸€ä¸ªå®ä»»åŠ¡ setTimeout4ï¼Œæ‰§è¡Œå¹¶è¾“å‡ºsetTimeout4ã€‚ å› æ­¤ä»£ç æ‰§è¡Œçš„ç»“æœä¸ºï¼š 12345678promise1setTimeout1setTimeout2setTimeout3promise25promise3setTimeout4 å¾®ä»»åŠ¡æ¯”å®ä»»åŠ¡ä¼˜å…ˆæ‰§è¡Œï¼Œå½“å¾®ä»»åŠ¡é˜Ÿåˆ—ä¸ä¸ºnullæ—¶ï¼Œç»§ç»­å¤„ç†å¾®ä»»åŠ¡é˜Ÿåˆ—ï¼Œç­‰åˆ°å…¨éƒ¨å¤„ç†å®Œæ¯•ï¼Œåˆ™æ£€æŸ¥å®ä»»åŠ¡é˜Ÿåˆ—å¹¶å¤„ç†é˜Ÿåˆ—çš„ä»»åŠ¡ã€‚ async/awaitasync/await ä¸ promise ä¸€æ ·åŒå±äºå¾®ä»»åŠ¡ã€‚ï¼ˆasyncå‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ªpromiseï¼‰ 123456789101112131415161718192021async function async1() &#123; console.log(\"async1 start\"); await async2(); console.log(\"async1 end\");&#125;async function async2() &#123; console.log(\"async2\");&#125;console.log(\"script start\");setTimeout(function() &#123; console.log(\"setTimeout\");&#125;, 0);async1();new Promise(function(resolve) &#123; console.log(\"promise1\"); resolve();&#125;).then(function() &#123; console.log(\"promise2\");&#125;);console.log(\"script end\"); ä»¥ä¸Šä»£ç æ‰§è¡Œè¿‡ç¨‹ï¼š1ã€async1()ã€async2ï¼ˆï¼‰å‡½æ•°å®šä¹‰ã€‚2ã€åŒæ­¥ä»»åŠ¡ï¼Œæ§åˆ¶å°è¾“å‡ºï¼šscript startã€‚3ã€setTimeout,åŠ å…¥å®ä»»åŠ¡é˜Ÿåˆ—ã€‚4ã€æ‰§è¡Œå‡½æ•°async1()ã€‚ aï¼šåŒæ­¥ä»»åŠ¡ï¼Œæ§åˆ¶å°è¾“å‡ºasync1 startã€‚ bï¼šawait async2() ï¼Œæ­¤æ—¶çº¿ç¨‹è¢«é˜»å¡ï¼Œæ— æ³•æ‰§è¡Œå½“å‰å‡½æ•°ä¸‹é¢çš„ä»£ç ã€‚ 5ã€async2()ï¼šåŒæ­¥ä»»åŠ¡ï¼Œæ§åˆ¶å°è¾“å‡ºasync2ï¼Œ6ã€ç”±äºasync1()ä¸­ï¼Œawaité˜»å¡é‡Œçº¿ç¨‹ï¼Œæ— æ³•å›åˆ°async1()ï¼Œå› æ­¤ç»§ç»­æ‰§è¡Œasync1()å¤–é¢çš„ä»£ç ã€‚7ã€Promiseï¼Œæ§åˆ¶å°è¾“å‡ºpromise1ï¼Œå°†then()=&gt;{console.log(&quot;promise2&quot;)}å›è°ƒåŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚8ã€åŒæ­¥ä»»åŠ¡,æ§åˆ¶å°è¾“å‡ºscript endï¼Œæ­¤æ—¶ä»£ç æ‰§è¡Œå®Œã€‚9ã€awaité˜»å¡çº¿ç¨‹ç»“æŸã€‚ a:å›åˆ°å‡½æ•°async1()ï¼Œasync2()è¿”å›ä¸€ä¸ªpromise.resolve(undefined).then(undefined)ï¼Œå°†then(undefined)åŠ å…¥å¾®ä»»åŠ¡é˜Ÿåˆ—ã€‚ b:å¤„ç†å¾®ä»»åŠ¡é˜Ÿåˆ—then()=&gt;{console.log(&quot;promise2&quot;)}ã€then(undefined)ï¼Œæ§åˆ¶å°è¾“å‡ºpromise2ã€‚ c:æ‰§è¡Œconsole.log(&quot;async1 end&quot;)ï¼Œæ§åˆ¶å°è¾“å‡ºasync1 endã€‚ 10ã€å¤„ç†å®ä»»åŠ¡é˜Ÿåˆ—ï¼Œæ§åˆ¶å°è¾“å‡ºsetTimeoutã€‚ æ‰€ä»¥æ§åˆ¶å°è¾“å‡ºï¼š12345678script startasync1 startasync2promise1script endpromise2async1 endsetTimeout async/awaitæœ¬è´¨ä¸Šè¿˜æ˜¯åŸºäºPromiseçš„ä¸€äº›å°è£…ã€‚æ‰§è¡Œasyncå‡½æ•°å†…é‡åˆ°await fn()æ—¶ï¼Œä¼šé˜»å¡çº¿ç¨‹è·³å‡ºasyncå‡½æ•°ï¼Œç„¶åå†æ¬¡å›åˆ°await fn()å¤„ï¼Œå¦‚æœfn()è¿”å›çš„æ˜¯Promiseå¯¹è±¡è¿˜è¦å†æ¬¡è·³å‡ºasync1()å‡½æ•°ä½“å¤–ç»§ç»­æ‰§è¡Œä»¥å¤–çš„ä»£ç ã€‚ è¡¥å……åœ¨æœ€æ–°çš„Chromeï¼ˆ76.0.3809.87ï¼‰ä¸­æµ‹è¯•ä»¥ä¸Šä»£ç å¾—åˆ°ç»“æœä¸ºï¼š 12345678script startasync1 startasync2promise1script endasync1 endpromise2setTimeout","link":"/2019/04/09/æ‹¾é—JavaScriptâ€”â€”Event-Loop/"},{"title":"ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½çš„è¿‡ç¨‹çš„çŸ¥è¯†æ¢³ç†","text":"çŸ¥è¯†æ¢³ç† æµè§ˆå™¨æ¥å—URLåˆ°å¼€å¯ç½‘ç»œè¯·æ±‚ å‘èµ·ä¸€ä¸ªå®Œæ•´çš„httpè¯·æ±‚ æœåŠ¡å™¨æ¥æ”¶åˆ°è¯·æ±‚åˆ°åå°å¤„ç† åå°ä¸å‰ç«¯çš„httpäº¤äº’ æµè§ˆå™¨æ¥å—åˆ°httpæ•°æ®åŒ…åçš„è§£æè¿‡ç¨‹ è¡¥å…… JSå¼•æ“è§£æè¿‡ç¨‹ httpç¼“å­˜ è·¨åŸŸã€webå®‰å…¨ç­‰ã€‚ æµè§ˆå™¨æ¥å—URLåˆ°å¼€å¯ç½‘ç»œè¯·æ±‚æµè§ˆå™¨çŸ¥è¯†æµè§ˆå™¨æ˜¯å¤šè¿›ç¨‹çš„ï¼Œæ¯”å¦‚Chromeï¼Œå­˜åœ¨çš„è¿›ç¨‹åŒ…æ‹¬ä¸»è¿›ç¨‹ã€GPUã€æµè§ˆå™¨å†…æ ¸ç­‰ã€‚ æµè§ˆå™¨å†…æ ¸æµè§ˆå™¨å†…æ ¸ç®€å•æ¥è¯´å°±æ˜¯æ¸²æŸ“å¼•æ“ï¼Œé€šè¿‡è·å–å¾—é¡µé¢å†…å®¹ã€æ•´ç†ä¿¡æ¯ï¼ˆCSSï¼‰ã€è®¡ç®—å’Œç»„åˆå‡ºæœ€ç»ˆè¾“å‡ºå¯è§†åŒ–å†…å®¹ã€‚ åœ¨Chromeä¸­ï¼Œæ¯æ‰“å¼€ä¸€ä¸ªæ ‡ç­¾é¡µç›¸å½“äºå¼€å¯äº†ä¸€ä¸ªè¿›ç¨‹ï¼Œæ¯ä¸ªTabè¿›ç¨‹éƒ½æœ‰ç‹¬ç«‹çš„æ¸²æŸ“å¼•æ“å®ä¾‹äº’ä¸å¹²æ‰°ã€‚ å¤šçº¿ç¨‹çš„å†…æ ¸æµè§ˆå™¨å†…æ ¸ç”±ä»¥ä¸‹å¸¸é©»çº¿ç¨‹ç»„æˆ GUIæ¸²æŸ“çº¿ç¨‹ï¼šè´Ÿè´£æ¸²æŸ“æµè§ˆå™¨ç•Œé¢HTMLå…ƒç´ ,å½“ç•Œé¢éœ€è¦é‡ç»˜(Repaint)æˆ–ç”±äºæŸç§æ“ä½œå¼•å‘å›æµ(reflow)æ—¶,è¯¥çº¿ç¨‹å°±ä¼šæ‰§è¡Œã€‚ JavaScriptå¼•æ“çº¿ç¨‹ï¼šè´Ÿè´£è§£æJavascriptè„šæœ¬ï¼Œè¿è¡Œä»£ç ã€‚ å®šæ—¶è§¦å‘å™¨çº¿ç¨‹ï¼šæµè§ˆå™¨å®šæ—¶è®¡æ•°å™¨å¹¶ä¸æ˜¯ç”±JavaScriptå¼•æ“è®¡æ•°çš„, å› ä¸ºJavaScriptå¼•æ“æ˜¯å•çº¿ç¨‹çš„, å¦‚æœå¤„äºé˜»å¡çº¿ç¨‹çŠ¶æ€å°±ä¼šå½±å“è®°è®¡æ—¶çš„å‡†ç¡®, å› æ­¤é€šè¿‡å•ç‹¬çº¿ç¨‹æ¥è®¡æ—¶å¹¶è§¦å‘å®šæ—¶ äº‹ä»¶è§¦å‘å™¨çº¿ç¨‹ï¼šå½“ä¸€ä¸ªäº‹ä»¶è¢«è§¦å‘æ—¶è¯¥çº¿ç¨‹ä¼šæŠŠäº‹ä»¶æ·»åŠ åˆ°å¾…å¤„ç†é˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œç­‰å¾…JSå¼•æ“çš„å¤„ç†ã€‚è¿™äº›äº‹ä»¶å¯ä»¥æ˜¯å½“å‰æ‰§è¡Œçš„ä»£ç å—å¦‚å®šæ—¶ä»»åŠ¡ã€ä¹Ÿå¯æ¥è‡ªæµè§ˆå™¨å†…æ ¸çš„å…¶ä»–çº¿ç¨‹å¦‚é¼ æ ‡ç‚¹å‡»ã€AJAXå¼‚æ­¥è¯·æ±‚ç­‰ï¼Œä½†ç”±äºJSçš„å•çº¿ç¨‹å…³ç³»æ‰€æœ‰è¿™äº›äº‹ä»¶éƒ½å¾—æ’é˜Ÿç­‰å¾…JSå¼•æ“å¤„ç†ã€‚ å¼‚æ­¥httpè¯·æ±‚çº¿ç¨‹ï¼šåœ¨XMLHttpRequeståœ¨è¿æ¥åæ˜¯é€šè¿‡æµè§ˆå™¨æ–°å¼€ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚ï¼Œ å°†æ£€æµ‹åˆ°çŠ¶æ€å˜æ›´æ—¶ï¼Œå¦‚æœè®¾ç½®æœ‰å›è°ƒå‡½æ•°ï¼Œå¼‚æ­¥çº¿ç¨‹å°±äº§ç”ŸçŠ¶æ€å˜æ›´äº‹ä»¶æ”¾åˆ° JavaScriptå¼•æ“çš„å¤„ç†é˜Ÿåˆ—ä¸­ç­‰å¾…å¤„ç†ã€‚ URLè§£æå½“åœ¨åœ°å€æ è¾“å…¥URLæ—¶ï¼Œç¬¬ä¸€ä»¶äº‹æƒ…å°±æ˜¯å¯¹URLè¿›è¡Œè§£æã€‚ URLçš„ç»„æˆï¼š protocolï¼šåè®®å¤´ï¼ˆHttpã€ftpï¼‰ hostï¼šåŸŸåæˆ–IPåœ°å€ portï¼šç«¯å£å·ï¼ˆé»˜è®¤80ï¼‰ pathï¼šç›®å½•è·¯å¾„ queryï¼šè¯·æ±‚å‚æ•° fragmentï¼š#åçš„hashå€¼ï¼Œç”¨æ¥å®šä½åˆ°æŸä¸ªä½ç½® å‘èµ·ä¸€ä¸ªå®Œæ•´çš„httpè¯·æ±‚URLè§£æå®Œæ¯•åè·åŸŸåï¼Œéœ€è¦å¯¹åŸŸåè¿›è¡ŒDNSæŸ¥è¯¢ã€‚è§£ææˆIP DNSæŸ¥è¯¢ å¦‚æœæµè§ˆå™¨æœ‰ç¼“å­˜ï¼Œåˆ™æ˜¯ç”¨æµè§ˆå™¨ç¼“å­˜ï¼Œå¦åˆ™ä½¿ç”¨ç³»ç»Ÿæœ¬åœ°ç¼“å­˜ï¼Œ å¦‚æœæœ¬æœºä¸Šä¹Ÿæ²¡æœ‰ï¼Œåˆ™å‘DNSåŸŸåæœåŠ¡å™¨æŸ¥è¯¢ï¼ˆè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ç»è¿‡è·¯ç”±å™¨ï¼Œå¦‚æœè·¯ç”±å™¨ä¸­æœ‰ç¼“å­˜ï¼Œåˆ™ä½¿ç”¨è·¯ç”±å™¨ç¼“å­˜ï¼‰ã€‚ DNSæœåŠ¡å™¨æŸ¥è¯¢æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸Šéƒ½ç»´æŠ¤ä¸€ä»½é«˜é€Ÿç¼“å­˜ï¼Œå­˜æ”¾æœ€è¿‘ä½¿ç”¨è¿‡çš„åŸŸååŠå¯¹åº”çš„IPåœ°å€ã€‚å¦‚æœåœ¨æ­¤æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™å‘èµ·é€’å½’æŸ¥è¯¢ã€‚ TCP/IP è¯·æ±‚httpæœ¬è´¨ä¸Šæ˜¯TCP/IPè¯·æ±‚ã€‚ ç»è¿‡DNSæŸ¥è¯¢æ‰¾åˆ°IPåœ°å€ï¼Œæ ¹æ®IPåœ°å€å‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œå»ºç«‹TCP/IPé“¾æ¥ã€‚ ä¸‰æ¬¡æ¡æ‰‹ åŸºæœ¬è¿‡ç¨‹ï¼š å®¢æˆ·ç«¯ï¼šHiï½ï¼Œä½ æ˜¯Serverå—ï¼Ÿ å®¢æˆ·ç«¯å°†SYNæ®µå‘é€åˆ°æœåŠ¡å™¨ã€‚SYNä»£è¡¨åŒæ­¥ï¼Œè¿™æ„å‘³ç€å®¢æˆ·ç«¯è¯·æ±‚æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯å°†ä½¿ç”¨çš„åºåˆ—å·åŒæ­¥ï¼ˆæ¯ä¸ªæ–°äº‹åŠ¡ç”Ÿæˆæ–°çš„åºåˆ—å·ï¼‰ã€‚ æœåŠ¡å™¨ï¼šHiï¼ï¼Œæˆ‘æ˜¯Serverï¼Œä½ æ˜¯Clientå—ï¼Ÿ æ”¶åˆ°è¯·æ±‚åï¼ŒæœåŠ¡å™¨ä¼šå“åº”ç±»ä¼¼çš„æ¶ˆæ¯ã€‚é¦–å…ˆï¼Œå®ƒé€šè¿‡ç¡®è®¤å®¢æˆ·ç«¯å‘é€çš„åºåˆ—å·æ¥ç¡®è®¤ï¼ˆACKï¼‰è¯·æ±‚ã€‚å…¶æ¬¡ï¼Œå®ƒè¿˜è¯·æ±‚å®¢æˆ·ç«¯åºåˆ—å·çš„åŒæ­¥ï¼ˆSYNï¼‰ã€‚ å®¢æˆ·ç«¯ï¼šYeahï¼æˆ‘æ˜¯Clientã€‚ æœ€åä¸€æ­¥æ¥è‡ªå®¢æˆ·ç«¯ï¼Œå®ƒç¡®è®¤ï¼ˆACKï¼‰æœåŠ¡å™¨å‘é€çš„åºåˆ—å·ã€‚ä¼ è¾“å·²å‡†å¤‡å¥½å¼€å§‹ã€‚ å››æ¬¡æŒ¥æ‰‹ Aï¼šå‘Bå‘é€ä¸€ä¸ªFINæŠ¥æ–‡ï¼ˆè¡¨ç¤ºæ²¡ä»€ä¹ˆä¸œè¥¿å‘é€äº†ï¼Œä½†æ˜¯å¯ä»¥æ¥æ”¶ï¼‰è¦å…³é—­è¿æ¥äº†ï¼Œè¿™æ—¶Aè¿›å…¥FIN_WAIT_1çŠ¶æ€ã€‚ Bï¼šæ¥æ”¶åˆ°Aå‘é€çš„FINæŠ¥æ–‡ï¼Œç„¶åå‘Aå‘é€ä¸€ä¸ªACKæŠ¥æ–‡ï¼ˆè¡¨æ˜å·²æ”¶åˆ°è¯·æ±‚ï¼Œä½†è¿˜æ²¡å‡†å¤‡è¦å…³é—­è¿æ¥ï¼‰ï¼Œè¿›å…¥ClOSE_WAITçŠ¶æ€ã€‚è¿™æ—¶Aæ”¶åˆ°ç¡®è®¤åŒ…è¿›å…¥FIN_WAIT_2çŠ¶æ€ã€‚ Bï¼šå‘Aå‘é€FINæŠ¥æ–‡ï¼ˆå…³é—­è¿æ¥è¯·æ±‚ï¼‰è¿›å…¥LAST_ACKï¼ˆç­‰å¾…å®¢æˆ·ç«¯ç¡®è®¤çš„ACKåŒ…ï¼‰ã€‚ Aï¼šæ”¶åˆ°Bå‘é€çš„FINæŠ¥æ–‡ï¼ˆå…³é—­è¯·æ±‚ï¼‰ï¼Œå‘Bå‘é€ACKåŒ…ï¼Œè¿›å…¥TIME_WAITï¼ˆç­‰å¾…Bå›åº”ï¼‰ã€‚Bæ”¶åˆ°ç¡®è®¤åŒ…å¹¶å…³é—­è¿æ¥ï¼Œè¿™æ—¶Aç­‰å¾…è¶…æ—¶ï¼Œå…³é—­è¿æ¥ã€‚ é•¿è¿æ¥ã€çŸ­è¿æ¥ TCP/IP é•¿è¿æ¥ï¼šä¸€ä¸ªtcp/ipè¿æ¥ä¸Šå¯ä»¥è¿ç»­å‘é€å¤šä¸ªæ•°æ®åŒ…ï¼Œåœ¨tcpè¿æ¥ä¿æŒæœŸé—´ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®åŒ…å‘é€ï¼Œéœ€è¦åŒæ–¹å‘æ£€æµ‹åŒ…ä»¥ç»´æŒæ­¤è¿æ¥ï¼Œä¸€èˆ¬éœ€è¦è‡ªå·±åšåœ¨çº¿ç»´æŒï¼ˆç±»ä¼¼äºå¿ƒè·³åŒ…ï¼‰ çŸ­è¿æ¥ï¼šé€šä¿¡åŒæ–¹æœ‰æ•°æ®äº¤äº’æ—¶ï¼Œå°±å»ºç«‹ä¸€ä¸ªtcpè¿æ¥ï¼Œæ•°æ®å‘é€å®Œæˆåï¼Œåˆ™æ–­å¼€æ­¤tcpè¿æ¥ httpå±‚é¢ http1.0ä¸­ï¼Œé»˜è®¤ä½¿ç”¨çš„æ˜¯çŸ­è¿æ¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæµè§ˆå™¨æ²¡è¿›è¡Œä¸€æ¬¡httpæ“ä½œï¼Œå°±å»ºç«‹ä¸€æ¬¡è¿æ¥ï¼Œä»»åŠ¡ç»“æŸå°±ä¸­æ–­è¿æ¥ï¼Œè­¬å¦‚æ¯ä¸€ä¸ªé™æ€èµ„æºè¯·æ±‚æ—¶éƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„è¿æ¥ http1.1èµ·ï¼Œé»˜è®¤ä½¿ç”¨é•¿è¿æ¥ï¼Œä½¿ç”¨é•¿è¿æ¥ä¼šæœ‰è¿™ä¸€è¡ŒConnection: keep-aliveï¼Œåœ¨é•¿è¿æ¥çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€ä¸ªç½‘é¡µæ‰“å¼€å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´ç”¨äºä¼ è¾“httpçš„tcpè¿æ¥ä¸ä¼šå…³é—­ï¼Œå¦‚æœå®¢æˆ·ç«¯å†æ¬¡è®¿é—®è¿™ä¸ªæœåŠ¡å™¨çš„é¡µé¢ï¼Œä¼šç»§ç»­ä½¿ç”¨è¿™ä¸€æ¡å·²ç»å»ºç«‹çš„è¿æ¥ keep-aliveä¸ä¼šæ°¸è¿œä¿æŒï¼Œå®ƒæœ‰ä¸€ä¸ªæŒç»­æ—¶é—´ï¼Œä¸€èˆ¬åœ¨æœåŠ¡å™¨ä¸­é…ç½®ï¼ˆå¦‚apacheï¼‰ï¼Œå¦å¤–é•¿è¿æ¥éœ€è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨éƒ½æ”¯æŒæ—¶æ‰æœ‰æ•ˆ *æ‹¾é—å› ç‰¹ç½‘åè®®æ ˆï¼ˆäº”å±‚ï¼‰ åº”ç”¨å±‚ ä¼ è¾“å±‚ ç½‘ç»œå±‚ æ•°æ®é“¾è·¯å±‚ ç‰©ç†å±‚ ä»åº”ç”¨å±‚å‘èµ·httpè¯·æ±‚ï¼Œåˆ°ä¼ è¾“å±‚ç»è¿‡ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCP/IPè¿æ¥ï¼Œæ¥ç€åˆ°ç½‘ç»œå±‚çš„IPå¯»å€ï¼Œå†åˆ°æ•°æ®é“¾è·¯å±‚å°è£…æˆå¸§ï¼Œæœ€åç‰©ç†å±‚åˆ©ç”¨ç‰©ç†é“¾è·¯ä¼ è¾“ã€‚ OSIå¼€æ”¾ç³»ç»Ÿäº’è¿å‚è€ƒæ¨¡å‹ (Open System Interconnect ç®€ç§°OSIï¼‰ã€‚ ç‰©ç†å±‚ æ•°æ®é“¾è·¯å±‚ ç½‘ç»œå±‚ ä¼ è¾“å±‚ ä¼šè¯å±‚ è¡¨ç¤ºå±‚ åº”ç”¨å±‚ ä¼šè¯å±‚ï¼šç®¡ç†ä¸åŒç”¨æˆ·å’Œè¿›ç¨‹ä¹‹é—´çš„å¯¹è¯ è¡¨ç¤ºå±‚ï¼šä¸»è¦å¤„ç†ä¸¤ä¸ªé€šä¿¡ç«¯çš„ä¿¡æ¯äº¤æ¢æ–¹å¼ï¼Œå¦‚æ•°æ®åŠ å¯†ä¸è§£å¯†ã€æ•°æ®æ ¼å¼äº¤æ¢ã€‚ å»ºç«‹TCP/IPè¿æ¥åå¼€å§‹å‡†å¤‡ä¼ è¾“æ•°æ®ï¼šHTTPæŠ¥æ–‡ æŠ¥æ–‡ç»“æ„é€šç”¨å¤´éƒ¨Method GETï¼šè¯·æ±‚ä¸€ä¸ªæŒ‡å®šèµ„æºçš„è¡¨ç¤ºå½¢å¼. ä½¿ç”¨GETçš„è¯·æ±‚åº”è¯¥åªè¢«ç”¨äºè·å–æ•°æ®. HEADï¼šè¯·æ±‚ä¸€ä¸ªä¸GETè¯·æ±‚çš„å“åº”ç›¸åŒçš„å“åº”ï¼Œä½†æ²¡æœ‰å“åº”ä½“. POSTï¼šç”¨äºå°†å®ä½“æäº¤åˆ°æŒ‡å®šçš„èµ„æºï¼Œé€šå¸¸å¯¼è‡´åœ¨æœåŠ¡å™¨ä¸Šçš„çŠ¶æ€å˜åŒ–æˆ–å‰¯ä½œç”¨. PUTï¼šç”¨è¯·æ±‚æœ‰æ•ˆè½½è·æ›¿æ¢ç›®æ ‡èµ„æºçš„æ‰€æœ‰å½“å‰è¡¨ç¤ºã€‚ DELETEï¼šåˆ é™¤æŒ‡å®šçš„èµ„æºã€‚ CONNECTå»ºç«‹ä¸€ä¸ªåˆ°ç”±ç›®æ ‡èµ„æºæ ‡è¯†çš„æœåŠ¡å™¨çš„éš§é“ã€‚ OPTIONSï¼šç”¨äºæè¿°ç›®æ ‡èµ„æºçš„é€šä¿¡é€‰é¡¹ã€‚ TRACEï¼šæ²¿ç€åˆ°ç›®æ ‡èµ„æºçš„è·¯å¾„æ‰§è¡Œä¸€ä¸ªæ¶ˆæ¯ç¯å›æµ‹è¯•ã€‚ PATCHï¼šç”¨äºå¯¹èµ„æºåº”ç”¨éƒ¨åˆ†ä¿®æ”¹ã€‚ çŠ¶æ€ç ï¼ˆStatus Codeï¼‰ 1xxâ€”â€”æŒ‡ç¤ºä¿¡æ¯ï¼Œè¡¨ç¤ºè¯·æ±‚å·²æ¥æ”¶ï¼Œç»§ç»­å¤„ç† 2xxâ€”â€”æˆåŠŸï¼Œè¡¨ç¤ºè¯·æ±‚å·²è¢«æˆåŠŸæ¥æ”¶ã€ç†è§£ã€æ¥å— 3xxâ€”â€”é‡å®šå‘ï¼Œè¦å®Œæˆè¯·æ±‚å¿…é¡»è¿›è¡Œæ›´è¿›ä¸€æ­¥çš„æ“ä½œ 4xxâ€”â€”å®¢æˆ·ç«¯é”™è¯¯ï¼Œè¯·æ±‚æœ‰è¯­æ³•é”™è¯¯æˆ–è¯·æ±‚æ— æ³•å®ç° 5xxâ€”â€”æœåŠ¡å™¨ç«¯é”™è¯¯ï¼ŒæœåŠ¡å™¨æœªèƒ½å®ç°åˆæ³•çš„è¯·æ±‚ å¸¸ç”¨çŠ¶æ€ç ï¼š 200â€”â€”è¡¨æ˜è¯¥è¯·æ±‚è¢«æˆåŠŸåœ°å®Œæˆï¼Œæ‰€è¯·æ±‚çš„èµ„æºå‘é€å›å®¢æˆ·ç«¯304â€”â€”è‡ªä»ä¸Šæ¬¡è¯·æ±‚åï¼Œè¯·æ±‚çš„ç½‘é¡µæœªä¿®æ”¹è¿‡ï¼Œè¯·å®¢æˆ·ç«¯ä½¿ç”¨æœ¬åœ°ç¼“å­˜400â€”â€”å®¢æˆ·ç«¯è¯·æ±‚æœ‰é”™ï¼ˆè­¬å¦‚å¯ä»¥æ˜¯å®‰å…¨æ¨¡å—æ‹¦æˆªï¼‰401â€”â€”è¯·æ±‚æœªç»æˆæƒ403â€”â€”ç¦æ­¢è®¿é—®ï¼ˆè­¬å¦‚å¯ä»¥æ˜¯æœªç™»å½•æ—¶ç¦æ­¢ï¼‰404â€”â€”èµ„æºæœªæ‰¾åˆ°500â€”â€”æœåŠ¡å™¨å†…éƒ¨é”™è¯¯503â€”â€”æœåŠ¡ä¸å¯ç”¨ å“åº”å¤´ Access-Control-Allow-Headers: æœåŠ¡å™¨ç«¯å…è®¸çš„è¯·æ±‚HeadersAccess-Control-Allow-Methods: æœåŠ¡å™¨ç«¯å…è®¸çš„è¯·æ±‚æ–¹æ³•Access-Control-Allow-Origin: æœåŠ¡å™¨ç«¯å…è®¸çš„è¯·æ±‚Originå¤´éƒ¨ï¼ˆè­¬å¦‚ä¸º*ï¼‰Content-Typeï¼šæœåŠ¡ç«¯è¿”å›çš„å®ä½“å†…å®¹çš„ç±»å‹Dateï¼šæ•°æ®ä»æœåŠ¡å™¨å‘é€çš„æ—¶é—´Cache-Controlï¼šå‘Šè¯‰æµè§ˆå™¨æˆ–å…¶ä»–å®¢æˆ·ï¼Œä»€ä¹ˆç¯å¢ƒå¯ä»¥å®‰å…¨çš„ç¼“å­˜æ–‡æ¡£Last-Modifiedï¼šè¯·æ±‚èµ„æºçš„æœ€åä¿®æ”¹æ—¶é—´Expiresï¼šåº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™è®¤ä¸ºæ–‡æ¡£å·²ç»è¿‡æœŸ,ä»è€Œä¸å†ç¼“å­˜å®ƒMax-ageï¼šå®¢æˆ·ç«¯çš„æœ¬åœ°èµ„æºåº”è¯¥ç¼“å­˜å¤šå°‘ç§’ï¼Œå¼€å¯äº†Cache-Controlåæœ‰æ•ˆETagï¼šè¯·æ±‚å˜é‡çš„å®ä½“æ ‡ç­¾çš„å½“å‰å€¼Set-Cookieï¼šè®¾ç½®å’Œé¡µé¢å…³è”çš„cookieï¼ŒæœåŠ¡å™¨é€šè¿‡è¿™ä¸ªå¤´éƒ¨æŠŠcookieä¼ ç»™å®¢æˆ·ç«¯Keep-Aliveï¼šå¦‚æœå®¢æˆ·ç«¯æœ‰keep-aliveï¼ŒæœåŠ¡ç«¯ä¹Ÿä¼šæœ‰å“åº”ï¼ˆå¦‚timeout=38ï¼‰Serverï¼šæœåŠ¡å™¨çš„ä¸€äº›ç›¸å…³ä¿¡æ¯ è¯·æ±‚å¤´ Accept: æ¥æ”¶ç±»å‹ï¼Œè¡¨ç¤ºæµè§ˆå™¨æ”¯æŒçš„MIMEç±»å‹ï¼ˆå¯¹æ ‡æœåŠ¡ç«¯è¿”å›çš„Content-Typeï¼‰Accept-Encodingï¼šæµè§ˆå™¨æ”¯æŒçš„å‹ç¼©ç±»å‹,å¦‚gzipç­‰,è¶…å‡ºç±»å‹ä¸èƒ½æ¥æ”¶Content-Typeï¼šå®¢æˆ·ç«¯å‘é€å‡ºå»å®ä½“å†…å®¹çš„ç±»å‹Cache-Control: æŒ‡å®šè¯·æ±‚å’Œå“åº”éµå¾ªçš„ç¼“å­˜æœºåˆ¶ï¼Œå¦‚no-cacheIf-Modified-Sinceï¼šå¯¹åº”æœåŠ¡ç«¯çš„Last-Modifiedï¼Œç”¨æ¥åŒ¹é…çœ‹æ–‡ä»¶æ˜¯å¦å˜åŠ¨ï¼Œåªèƒ½ç²¾ç¡®åˆ°1sä¹‹å†…ï¼Œhttp1.0ä¸­Expiresï¼šç¼“å­˜æ§åˆ¶ï¼Œåœ¨è¿™ä¸ªæ—¶é—´å†…ä¸ä¼šè¯·æ±‚ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜ï¼Œhttp1.0ï¼Œè€Œä¸”æ˜¯æœåŠ¡ç«¯æ—¶é—´Max-ageï¼šä»£è¡¨èµ„æºåœ¨æœ¬åœ°ç¼“å­˜å¤šå°‘ç§’ï¼Œæœ‰æ•ˆæ—¶é—´å†…ä¸ä¼šè¯·æ±‚ï¼Œè€Œæ˜¯ä½¿ç”¨ç¼“å­˜ï¼Œhttp1.1ä¸­If-None-Matchï¼šå¯¹åº”æœåŠ¡ç«¯çš„ETagï¼Œç”¨æ¥åŒ¹é…æ–‡ä»¶å†…å®¹æ˜¯å¦æ”¹å˜ï¼ˆéå¸¸ç²¾ç¡®ï¼‰ï¼Œhttp1.1ä¸­Cookie: æœ‰cookieå¹¶ä¸”åŒåŸŸè®¿é—®æ—¶ä¼šè‡ªåŠ¨å¸¦ä¸ŠConnection: å½“æµè§ˆå™¨ä¸æœåŠ¡å™¨é€šä¿¡æ—¶å¯¹äºé•¿è¿æ¥å¦‚ä½•è¿›è¡Œå¤„ç†,å¦‚keep-aliveHostï¼šè¯·æ±‚çš„æœåŠ¡å™¨URLOriginï¼šæœ€åˆçš„è¯·æ±‚æ˜¯ä»å“ªé‡Œå‘èµ·çš„ï¼ˆåªä¼šç²¾ç¡®åˆ°ç«¯å£ï¼‰,Originæ¯”Refereræ›´å°Šé‡éšç§Refererï¼šè¯¥é¡µé¢çš„æ¥æºURL(é€‚ç”¨äºæ‰€æœ‰ç±»å‹çš„è¯·æ±‚ï¼Œä¼šç²¾ç¡®åˆ°è¯¦ç»†é¡µé¢åœ°å€ï¼Œcsrfæ‹¦æˆªå¸¸ç”¨åˆ°è¿™ä¸ªå­—æ®µ)User-Agentï¼šç”¨æˆ·å®¢æˆ·ç«¯çš„ä¸€äº›å¿…è¦ä¿¡æ¯ï¼Œå¦‚UAå¤´éƒ¨ç­‰ æœåŠ¡å™¨æ¥æ”¶è¯·æ±‚çš„å¤„ç†è´Ÿè½½å‡è¡¡ç”¨æˆ·å‘èµ·çš„è¯·æ±‚éƒ½æŒ‡å‘è°ƒåº¦æœåŠ¡å™¨ï¼ˆåå‘ä»£ç†æœåŠ¡å™¨nginxæ§åˆ¶è´Ÿè½½å‡è¡¡ï¼‰ï¼Œç„¶åè°ƒåº¦æœåŠ¡å™¨æ ¹æ®å®é™…çš„è°ƒåº¦ç®—æ³•ï¼Œåˆ†é…ä¸åŒçš„è¯·æ±‚ç»™å¯¹åº”é›†ç¾¤ä¸­çš„æœåŠ¡å™¨æ‰§è¡Œï¼Œç„¶åè°ƒåº¦å™¨ç­‰å¾…å®é™…æœåŠ¡å™¨çš„HTTPå“åº”ï¼Œå¹¶å°†å®ƒåé¦ˆç»™ç”¨æˆ·ã€‚ åå°å¤„ç†ï¼Œè¿”å›æ•°æ®##nginxã€node(express/jwt)ã€mongoDB ä¸€èˆ¬è¿‡ç¨‹ï¼š ç»Ÿä¸€çš„éªŒè¯ï¼Œå¦‚å®‰å…¨æ‹¦æˆªï¼Œè·¨åŸŸéªŒè¯ï¼Œå¦‚ä¸ç¬¦åˆè§„åˆ™ï¼Œå°±ç›´æ¥è¿”å›äº†ç›¸åº”çš„httpæŠ¥æ–‡ã€‚ éªŒè¯é€šè¿‡åï¼Œè¿›å…¥å®é™…çš„åå°ä»£ç ï¼Œæ­¤æ—¶æ˜¯ç¨‹åºæ¥æ”¶åˆ°è¯·æ±‚ï¼Œç„¶åæ‰§è¡Œï¼ˆè­¬å¦‚æŸ¥è¯¢æ•°æ®åº“ï¼Œå¤§é‡è®¡ç®—ç­‰ç­‰ï¼‰ã€‚ æ‰§è¡Œå®Œæ¯•åï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªhttpå“åº”åŒ…ï¼ˆä¸€èˆ¬è¿™ä¸€æ­¥ä¹Ÿä¼šç»è¿‡å¤šå±‚å°è£…ï¼‰ç„¶åå°±æ˜¯å°†è¿™ä¸ªåŒ…ä»åç«¯å‘é€åˆ°å‰ç«¯ï¼Œå®Œæˆäº¤äº’ã€‚ æ–­å¼€è¿æ¥ï¼ˆTCP/IP å››æ¬¡æŒ¥æ‰‹ï¼‰è§£æé¡µé¢æµè§ˆå™¨è§£æé¡µé¢æ˜¯è¾¹è§£æè¾¹æ¸²æŸ“çš„è¿‡ç¨‹ã€‚ åŸºæœ¬è¿‡ç¨‹ è§£æHTMLï¼Œæ„å»ºDOMæ ‘ã€‚ è§£æCSSï¼Œç”ŸæˆCSSè§„åˆ™æ ‘ã€‚ åˆå¹¶DOMã€CSSè§„åˆ™æ ‘ç”Ÿæˆrenderæ ‘ã€‚ å¸ƒå±€renderæ ‘ï¼ˆReflowï¼‰ï¼Œè´Ÿè´£è®¡ç®—å„ä¸ªå…ƒç´ çš„å°ºå¯¸ï¼Œä½ç½®ã€‚ ç»˜åˆ¶renderæ ‘ï¼ˆRepaintï¼‰ï¼Œç»˜åˆ¶é¡µé¢åƒç´ ä½ç½®ã€‚ï¼ˆæ ¹æ®æ¸²æŸ“æ ‘ä»¥åŠå›æµå¾—åˆ°çš„å‡ ä½•ä¿¡æ¯ï¼Œå¾—åˆ°èŠ‚ç‚¹çš„ç»å¯¹åƒç´ ï¼‰ æµè§ˆå™¨å°†ç»™å±‚çš„ä¿¡æ¯å‘é€ç»™GPUï¼ŒGPUå°†å„å±‚åˆæˆï¼ˆcompositeï¼‰ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚ æ„å»ºDOMæ ‘ Bytes â†’ characters â†’ tokens â†’ nodes â†’ DOM å› ä¸ºæˆ‘ä»¬æ˜¯ä»¥å­—èŠ‚æ•°æ®è¿›è¡Œæ•°æ®ä¼ è¾“çš„ï¼Œé¦–å…ˆå°†å­—èŠ‚æ•°æ®è½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œç„¶åæµè§ˆå™¨å°†å­—ç¬¦ä¸²è¿›è¡Œè¯æ³•åˆ†æè½¬ä¸ºæ ‡è®°ï¼ˆtokenï¼‰ï¼Œæ¥ç€è½¬åŒ–ä¸ºnodeï¼Œè¿™äº›nodeä¼šæ ¹æ®ä¸åŒnodeä¹‹é—´çš„è”ç³»æ„å»ºæˆDOMæ ‘ã€‚ ğŸŒ°1234567891011&lt;html&gt; &lt;head&gt; &lt;meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"&gt; &lt;link href=\"style.css\" rel=\"stylesheet\"&gt; &lt;title&gt;Asensiki&lt;/title&gt; &lt;/head&gt; &lt;body&gt; &lt;p&gt;Hello&lt;span&gt;web&lt;/span&gt;&lt;/p&gt; &lt;div&gt;&lt;img src=\"awesome.jpg\"&gt;&lt;/div&gt; &lt;/body&gt;&lt;/html&gt; å¤„ç†è¿‡ç¨‹ï¼š åœ¨è§£æHTMLçš„è¿‡ç¨‹ä¸­ä¼šé‡åˆ°CSSã€Javascriptæ–‡ä»¶ï¼Œè¿™æ—¶å€™æµè§ˆå™¨ä¼šä¸‹è½½è¿™äº›æ–‡ä»¶ã€‚ æ„å»ºCSSOMæ ‘ Bytes â†’ characters â†’ tokens â†’ nodes â†’ CSSOM ğŸŒ° style.css1234567891011121314151617body &#123; font-size: 16px&#125;p &#123; font-weight: bold; span &#123; color: red; display: none &#125;&#125;div &#123; weight: 300px&#125;img &#123; float: right&#125; ç”Ÿæˆçš„CSSOMæ ‘å¦‚ä¸‹ï¼š åˆæˆrenderæ ‘å½“DOMæ ‘å’ŒCSSOMæ„å»ºå®Œæ¯•åï¼Œå¼€å§‹åˆæˆæ¸²æŸ“æ ‘ã€‚ æ¸²æŸ“æ ‘åªä¼šåŒ…æ‹¬éœ€è¦æ˜¾ç¤ºçš„èŠ‚ç‚¹å’Œè¿™äº›èŠ‚ç‚¹çš„æ ·å¼ä¿¡æ¯ï¼Œå¦‚æœæŸä¸ªèŠ‚ç‚¹æ˜¯ display: none çš„ï¼Œé‚£ä¹ˆå°±ä¸ä¼šåœ¨æ¸²æŸ“æ ‘ä¸­æ˜¾ç¤ºã€‚ æ¸²æŸ“åˆæˆrender tree åå¼€å§‹æ¸²æŸ“ã€‚ åŸºæœ¬æ­¥éª¤ï¼š è®¡ç®—CSSæ ·å¼ã€‚ æ„å»ºæ¸²æŸ“æ ‘ã€‚ å¸ƒå±€ï¼Œå®šä½åæ ‡ã€å¤§å°ã€z-index ç­‰ã€‚ï¼ˆè¿™é‡Œä¹Ÿå«å›æµï¼‰ ç»˜åˆ¶ã€‚ * é˜»å¡æ¸²æŸ“æ¸²æŸ“çš„è¿‡ç¨‹éœ€è¦å…ˆè§£æHTMLï¼Œç”ŸæˆDOM Treeã€CSSOM Treeå¹¶åˆæˆRender Tree åæ‰ä¼šè¿›è¡Œã€‚ æ‰€ä»¥è¯´è§£æHTMLã€CSSæ—¶ä¼šé˜»å¡æ¸²æŸ“ã€‚ CSSé˜»å¡ CSSä¸‹è½½æ—¶å¼‚æ­¥ï¼Œä¸ä¼šé˜»å¡æµè§ˆå™¨æ„å»ºDOMæ ‘ ä½†æ˜¯ä¼šé˜»å¡æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯åœ¨æ„å»ºrenderæ—¶ï¼Œä¼šç­‰åˆ°cssä¸‹è½½è§£æå®Œæ¯•åæ‰è¿›è¡Œï¼ˆè¿™ç‚¹ä¸æµè§ˆå™¨ä¼˜åŒ–æœ‰å…³ï¼Œé˜²æ­¢cssè§„åˆ™ä¸æ–­æ”¹å˜ï¼Œé¿å…äº†é‡å¤çš„æ„å»ºï¼‰ æœ‰ä¾‹å¤–ï¼Œmedia queryå£°æ˜çš„CSSæ˜¯ä¸ä¼šé˜»å¡æ¸²æŸ“çš„ JSé˜»å¡å½“ HTML è§£æå™¨é‡åˆ°ä¸€ä¸ª script æ ‡è®°æ—¶ï¼Œå®ƒä¼šæš‚åœæ„å»º DOMï¼Œå°†æ§åˆ¶æƒç§»äº¤ç»™ JavaScript å¼•æ“ï¼›ç­‰ JavaScript å¼•æ“è¿è¡Œå®Œæ¯•ï¼Œæµè§ˆå™¨ä¼šä»ä¸­æ–­çš„åœ°æ–¹æ¢å¤ DOM æ„å»ºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ æƒ³é¦–å±æ¸²æŸ“çš„è¶Šå¿«ï¼Œå°±è¶Šä¸åº”è¯¥åœ¨é¦–å±å°±åŠ è½½ JS æ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯éƒ½å»ºè®®å°† script æ ‡ç­¾æ”¾åœ¨ body æ ‡ç­¾åº•éƒ¨çš„åŸå› ã€‚ ä½†ä¸ä¸€å®šéƒ½è¦æ”¾åœ¨åº•éƒ¨ã€‚ä¹Ÿå¯ä»¥ç»™scriptæ ‡ç­¾åŠ ä¸Šdefer æˆ–è€… async å±æ€§ã€‚ Deferï¼š htmlè§£æå®Œæˆåæ‰æ ¹æ®é¡ºåºæ‰§è¡Œä¸‹è½½ã€‚ Asyncï¼šå¼‚æ­¥ä¸‹è½½ï¼Œè°å…ˆä¸‹è½½å®Œå…ˆæ‰§è¡Œè°ï¼Œè¿™æ ·ä¹Ÿä¼šé˜»å¡ï¼Œæ‰€ä»¥æ ¹æ®æƒ…å†µä½¿ç”¨ã€‚ * é‡ç»˜ï¼ˆReflowï¼‰ã€å›æµï¼ˆRepaintï¼‰ Reflowï¼šå…ƒç´ çš„å†…å®¹ã€ç»“æ„ã€ä½ç½®æˆ–å°ºå¯¸å‘ç”Ÿäº†å˜åŒ–ï¼Œéœ€è¦é‡æ–°è®¡ç®—æ ·å¼å’Œæ¸²æŸ“æ ‘ã€‚ Repaintï¼šå…ƒç´ å‘ç”Ÿçš„æ”¹å˜åªæ˜¯å½±å“äº†å…ƒç´ çš„ä¸€äº›å¤–è§‚ä¹‹ç±»çš„æ—¶å€™ï¼ˆä¾‹å¦‚ï¼ŒèƒŒæ™¯è‰²ï¼Œè¾¹æ¡†é¢œè‰²ï¼Œæ–‡å­—é¢œè‰²ç­‰ï¼‰ï¼Œæ­¤æ—¶åªéœ€è¦åº”ç”¨æ–°æ ·å¼ç»˜åˆ¶è¿™ä¸ªå…ƒç´ å°±å¯ä»¥äº†ã€‚ åœ¨é¡µé¢æ˜¾ç¤ºçš„è¿‡ç¨‹ä¸­ä¼šå¤šæ¬¡è¿›è¡ŒReflowå’ŒRepaintæ“ä½œï¼Œè€ŒReflowçš„æˆæœ¬æ¯”Repaintçš„æˆæœ¬é«˜å¾—å¤šçš„å¤šã€‚å› ä¸ºRepaintåªæ˜¯å°†æŸä¸ªéƒ¨åˆ†è¿›è¡Œé‡æ–°ç»˜åˆ¶è€Œä¸ç”¨æ”¹å˜é¡µé¢çš„å¸ƒå±€ï¼Œå¦‚ï¼šæ”¹å˜äº†æŸä¸ªå…ƒç´ çš„èƒŒæ™¯é¢œè‰²ã€‚è€Œå¦‚æœå°†å…ƒç´ çš„displayå±æ€§ç”±blockæ”¹ä¸ºnoneåˆ™éœ€è¦Reflowã€‚ å›æµè¿˜è¦è¿›è¡Œé‡ç»˜ã€‚ å¼•èµ·å›æµçš„æ“ä½œ é¡µé¢é¦–æ¬¡æ¸²æŸ“ æµè§ˆå™¨çª—å£å¤§å°å‘ç”Ÿæ”¹å˜ å…ƒç´ å°ºå¯¸æˆ–ä½ç½®å‘ç”Ÿæ”¹å˜ å…ƒç´ å†…å®¹å˜åŒ–ï¼ˆæ–‡å­—æ•°é‡æˆ–å›¾ç‰‡å¤§å°ç­‰ç­‰ï¼‰ å…ƒç´ å­—ä½“å¤§å°å˜åŒ– æ·»åŠ æˆ–è€…åˆ é™¤å¯è§çš„DOMå…ƒç´  æ¿€æ´»CSSä¼ªç±»ï¼ˆä¾‹å¦‚ï¼š:hoverï¼‰ æŸ¥è¯¢æŸäº›å±æ€§æˆ–è°ƒç”¨æŸäº›æ–¹æ³• æ‹¾é—HTTPS httpsä¸httpçš„åŒºåˆ«å°±æ˜¯ï¼š åœ¨è¯·æ±‚å‰ï¼Œä¼šå»ºç«‹sslè¿æ¥ï¼Œç¡®ä¿æ¥ä¸‹æ¥çš„é€šä¿¡éƒ½æ˜¯åŠ å¯†çš„ï¼Œæ— æ³•è¢«è½»æ˜“æˆªå–åˆ†æã€‚ å¼€å¯httpséœ€è¦åç«¯æœåŠ¡å™¨æ”¯æŒï¼ˆç”³è¯·è¯ä¹¦ï¼‰ã€‚ httpså¼€é”€æ¯”httpè¦å¤§ï¼Œå› ä¸ºè¦é¢å¤–å»ºç«‹å®‰å…¨é“¾æ¥å’ŒåŠ å¯†ã€‚ åŠ å¯† å¯¹ç§°åŠ å¯†ï¼šä¸¤è¾¹æ‹¥æœ‰ç›¸åŒçš„ç§˜é’¥ï¼Œä¸¤è¾¹éƒ½çŸ¥é“å¦‚ä½•å°†å¯†æ–‡åŠ å¯†è§£å¯† éå¯¹ç§°åŠ å¯†ï¼šæœåŠ¡ç«¯å°†å…¬é’¥å…¬å¸ƒï¼Œå®¢æˆ·ç«¯åˆ›å»ºä¸€ä¸ªç§˜é’¥ï¼Œç„¶åé€šè¿‡æœåŠ¡ç«¯çš„å…¬é’¥åŠ å¯†å¹¶å‘é€ç»™æœåŠ¡ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°å¯†æ–‡ä»¥åé€šè¿‡è‡ªå·±çš„ç§é’¥è§£å¯†å‡ºæ­£ç¡®çš„å®¢æˆ·ç«¯ç§˜é’¥ï¼Œè¿™æ—¶å€™ä¸¤ç«¯å°±éƒ½çŸ¥é“ç§˜é’¥æ˜¯ä»€ä¹ˆäº†ã€‚ SSL/TLSæ¡æ‰‹æµç¨‹ å®¢æˆ·ç«¯å‘é€ä¸€ä¸ªéšæœºå€¼ï¼ˆClient-Radomï¼‰ä»¥åŠéœ€è¦çš„åè®®å’ŒåŠ å¯†æ–¹å¼ã€‚ æœåŠ¡ç«¯æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„éšæœºå€¼ï¼Œå›å¤ä¸€ä¸ªéšæœºå€¼ï¼ˆServer-Randomï¼‰ï¼Œé€‰å‡ºç¡®å®šçš„åŠ å¯†ç®—æ³•ï¼Œå¹¶å°†è‡ªå·±çš„èº«ä»½ä¿¡æ¯ä»¥è¯ä¹¦çš„æ–¹å¼å‘é€ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦ã€‚ éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ã€‚ äº§ç”Ÿä¸€ä¸ªæ–°çš„éšæœºå€¼ï¼Œé€šè¿‡è¯ä¹¦ä¸­çš„å…¬é’¥ä»¥åŠæŒ‡å®šçš„ç®—æ³•åŠ å¯†åå‘é€ç»™æœåŠ¡å™¨ã€‚ åˆ©ç”¨ä¸‰ä¸ªéšæœºå€¼é€šè¿‡ç®—æ³•ç”ŸæˆHttpè¿æ¥æ•°æ®ä¼ è¾“çš„å¯¹ç§°åŠ å¯†keyï¼ˆsession-keyï¼‰ã€‚ ä½¿ç”¨çº¦å®šå¥½çš„HASHç®—æ³•è®¡ç®—æ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ç”Ÿæˆçš„session keyå¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ï¼Œæœ€åå°†ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰ä¿¡æ¯å‘é€ç»™æœåŠ¡ç«¯ã€‚ æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯å›å¤ åˆ©ç”¨æŒ‡å®šçš„åŠ è§£å¯†æ–¹å¼ä¸è‡ªå·±çš„ç§é’¥è¿›è¡Œè§£å¯†ï¼Œè·å¾—ç¬¬ä¸‰ä¸ªéšæœºå€¼ã€‚ ç”Ÿæˆsession-keyã€‚ ä½¿ç”¨session-keyè§£å¯†æ¡æ‰‹ä¿¡æ¯ï¼ŒéªŒè¯hashå€¼ã€‚ ä½¿ç”¨session keyåŠ å¯†ä¸€æ®µæ¡æ‰‹æ¶ˆæ¯ï¼Œå‘é€ç»™å®¢æˆ·ç«¯ å®¢æˆ·ç«¯è§£å¯†å¹¶éªŒè¯æ¡æ‰‹ä¿¡æ¯çš„hashï¼Œä¸€è‡´åˆ™æ¡æ‰‹ç»“æŸã€‚ ä¹‹åæ‰€æœ‰çš„httpsé€šä¿¡æ•°æ®å°†ç”±ä¹‹å‰æµè§ˆå™¨ç”Ÿæˆçš„session keyå¹¶åˆ©ç”¨å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡ŒåŠ å¯† *æµè§ˆå™¨å®‰å…¨ CSRFï¼šè·¨ç«™ç‚¹è¯·æ±‚ä¼ªé€ ï¼Œé€šè¿‡ä¼ªé€ åå°åœ°å€ï¼Œè¯±å¯¼æˆ–è€…æŸäº›æ–¹å¼è‡ªåŠ¨å‘é€è¯·æ±‚ã€‚ é˜²å¾¡ ä½¿ç”¨TokenéªŒè¯ã€‚ cookieé™åˆ¶ é˜»æ­¢ç¬¬ä¸‰æ–¹ç«™ç‚¹è¯·æ±‚ï¼ˆéªŒè¯referrerï¼‰ XSSï¼šä»£ç æ³¨å…¥ï¼Œè·¨ç«™ç‚¹è„šæœ¬æ”»å‡»ã€‚ æ”»å‡»ç±»å‹ å­˜å‚¨å‹ï¼šé€šè¿‡ç”¨æˆ·æäº¤è¡¨å•ç­‰æ–¹å¼å‘åå°DBæ³¨å…¥æ¶æ„ä»£ç ã€‚ DOMï¼šåŒ…å«æ¶æ„ä»£ç çš„URLè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ã€‚ åå°„å‹ï¼šæ‹¼æ¥åŒ…å«æ¶æ„ä»£ç çš„URLï¼Œé€šè¿‡ç”¨æˆ·ç‚¹å‡»ä¼ é€’ã€‚ é˜²å¾¡ HTMLè½¬è¯‘ã€‚ CSPï¼ˆcontent-security-policyï¼‰ï¼šå»ºç«‹ç™½åå• ç¦æ­¢å¤–åŸŸæäº¤ã€åŠ è½½ä»£ç ã€‚ ç¦æ­¢å†…è”è„šæœ¬è¿è¡Œã€‚ ç”¨æˆ·æäº¤éœ€è¦éªŒè¯ç ã€‚ HTTP-Only-Cookie å‰ç«¯æ¸²æŸ“ï¼Œä»£ç æ•°æ®åˆ†ç¦»ã€‚ è·¨åŸŸæµè§ˆå™¨ä¸ºäº†å®‰å…¨ç­–ç•¥ä½¿ç”¨åŒæºæ”¿ç­–ï¼Œåè®®ã€åŸŸåæˆ–è€…ç«¯å£æœ‰ä¸€ä¸ªä¸åŒå°±æ˜¯è·¨åŸŸã€‚ è§£å†³æ–¹å¼JSONPåˆ©ç”¨ &lt;script&gt; æ ‡ç­¾æ²¡æœ‰è·¨åŸŸé™åˆ¶çš„æ¼æ´ã€‚é€šè¿‡ &lt;script&gt; æ ‡ç­¾æŒ‡å‘ä¸€ä¸ªéœ€è¦è®¿é—®çš„åœ°å€å¹¶æä¾›ä¸€ä¸ªå›è°ƒå‡½æ•°æ¥æ¥æ”¶æ•°æ®å½“éœ€è¦é€šè®¯æ—¶ã€‚ 12345678910111213141516171819202122&lt;script src=\"http://domain/api?param1=a&amp;param2=b&amp;callback=jsonp\"&gt;&lt;/script&gt;&lt;script&gt; function jsonp(data) &#123; console.log(data)&#125;// å°è£…function jsonp(url, jsonpCallback, success) &#123; let script = document.createElement('script') script.src = url script.async = true script.type = 'text/javascript' window[jsonpCallback] = function(data) &#123; success &amp;&amp; success(data) &#125; document.body.appendChild(script)&#125;jsonp('http://xxx', 'callback', function(value) &#123; console.log(value)&#125;)&lt;/script&gt; JSOPN åªèƒ½ç”¨äºGETè¯·æ±‚ CORSCROS éœ€è¦åç«¯å’Œæµè§ˆå™¨åŒæ—¶æ”¯æŒã€‚ï¼ˆä¸‡æ¶ä¹‹æºIEç³»åˆ—ï¼‰ã€‚ åç«¯åˆ™éœ€è¦è®¾ç½®Access-Control-Allow-Originï¼š*ã€‚ï¼ˆå€¼å¯ä»¥è‡ªå·±é™åˆ¶é‚£äº›åŸŸåï¼Œ*è¡¨ç¤ºæ‰€æœ‰ï¼‰ã€‚ è™½ç„¶è®¾ç½® CORS å’Œå‰ç«¯æ²¡ä»€ä¹ˆå…³ç³»ï¼Œä½†æ˜¯é€šè¿‡è¿™ç§æ–¹å¼è§£å†³è·¨åŸŸé—®é¢˜çš„è¯ï¼Œä¼šåœ¨å‘é€è¯·æ±‚æ—¶å‡ºç°ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«ä¸ºç®€å•è¯·æ±‚å’Œå¤æ‚è¯·æ±‚ã€‚ ç®€å•è¯·æ±‚ï¼š è¯·æ±‚ç±»å‹ GET POST HEAD Content-Type text/plain multipart/form-data application/x-www-form-urlencoded å¤æ‚è¯·æ±‚ ä¸ç¬¦åˆä»¥ä¸Šæ¡ä»¶çš„è¯·æ±‚å°±è‚¯å®šæ˜¯å¤æ‚è¯·æ±‚äº†ã€‚ å¤æ‚è¯·æ±‚çš„CORSè¯·æ±‚ï¼Œä¼šåœ¨æ­£å¼é€šä¿¡ä¹‹å‰ï¼Œå¢åŠ ä¸€æ¬¡HTTPæŸ¥è¯¢è¯·æ±‚ï¼Œç§°ä¸ºâ€é¢„æ£€â€è¯·æ±‚,è¯¥è¯·æ±‚æ˜¯ option æ–¹æ³•çš„ï¼Œé€šè¿‡è¯¥è¯·æ±‚æ¥çŸ¥é“æœåŠ¡ç«¯æ˜¯å¦å…è®¸è·¨åŸŸè¯·æ±‚ã€‚ Node.js (express) 123456789app.use((req, res, next) =&gt; &#123; res.header('Access-Control-Allow-Origin', '*') res.header('Access-Control-Allow-Methods', 'PUT, GET, POST, DELETE, OPTIONS') res.header( 'Access-Control-Allow-Headers', 'Origin, X-Requested-With, Content-Type, Accept, Authorization, Access-Control-Allow-Credentials' ) next()&#125;) Nginxåå‘ä»£ç†document.domainè¯¥æ–¹å¼åªèƒ½ç”¨äºäºŒçº§åŸŸåç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¯”å¦‚ a.test.com å’Œ b.test.com é€‚ç”¨äºè¯¥æ–¹å¼ã€‚åªéœ€è¦ç»™é¡µé¢æ·»åŠ  document.domain = &#39;test.com&#39; è¡¨ç¤ºäºŒçº§åŸŸåéƒ½ç›¸åŒå°±å¯ä»¥å®ç°è·¨åŸŸ postMessageè¿™ç§æ–¹å¼é€šå¸¸ç”¨äºè·å–åµŒå…¥é¡µé¢ä¸­çš„ç¬¬ä¸‰æ–¹é¡µé¢æ•°æ®ã€‚ä¸€ä¸ªé¡µé¢å‘é€æ¶ˆæ¯ï¼Œå¦ä¸€ä¸ªé¡µé¢åˆ¤æ–­æ¥æºå¹¶æ¥æ”¶æ¶ˆæ¯ã€‚ è·¨åŸŸcookieå¤„ç† è®¾ç½®withCredentialsä¸ºtrueå³å¯è®©è¯¥è·¨åŸŸè¯·æ±‚æºå¸¦ Cookieã€‚ æ³¨æ„æºå¸¦çš„æ˜¯ç›®æ ‡é¡µé¢æ‰€åœ¨åŸŸçš„ Cookieã€‚ æœåŠ¡å™¨åŒæ—¶è®¾ç½®Access-Control-Allow-Credentialså“åº”å¤´ä¸º&quot;true&quot;ï¼Œ å³å¯å…è®¸è·¨åŸŸè¯·æ±‚æºå¸¦ Cookieã€‚ Access-Control-Allow-Originä¸å…è®¸ä½¿ç”¨é€šé…ç¬¦ã€‚ æµè§ˆå™¨ç¼“å­˜æœºåˆ¶ç¼“å­˜ä½ç½® Service Worker Service Worker çš„ç¼“å­˜ä¸æµè§ˆå™¨å…¶ä»–å†…å»ºçš„ç¼“å­˜æœºåˆ¶ä¸åŒï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬è‡ªç”±æ§åˆ¶ç¼“å­˜å“ªäº›æ–‡ä»¶ã€å¦‚ä½•åŒ¹é…ç¼“å­˜ã€å¦‚ä½•è¯»å–ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜æ˜¯æŒç»­æ€§çš„ã€‚ å½“ Service Worker æ²¡æœ‰å‘½ä¸­ç¼“å­˜çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å»è°ƒç”¨ fetch å‡½æ•°è·å–æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åœ¨ Service Worker å‘½ä¸­ç¼“å­˜çš„è¯ï¼Œä¼šæ ¹æ®ç¼“å­˜æŸ¥æ‰¾ä¼˜å…ˆçº§å»æŸ¥æ‰¾æ•°æ®ã€‚ä½†æ˜¯ä¸ç®¡æˆ‘ä»¬æ˜¯ä» Memory Cache ä¸­è¿˜æ˜¯ä»ç½‘ç»œè¯·æ±‚ä¸­è·å–çš„æ•°æ®ï¼Œæµè§ˆå™¨éƒ½ä¼šæ˜¾ç¤ºæˆ‘ä»¬æ˜¯ä» Service Worker ä¸­è·å–çš„å†…å®¹ã€‚ Memory Cache Memory Cache ä¹Ÿå°±æ˜¯å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œè¯»å–å†…å­˜ä¸­çš„æ•°æ®è‚¯å®šæ¯”ç£ç›˜å¿«ã€‚ä½†æ˜¯å†…å­˜ç¼“å­˜è™½ç„¶è¯»å–é«˜æ•ˆï¼Œå¯æ˜¯ç¼“å­˜æŒç»­æ€§å¾ˆçŸ­ï¼Œä¼šéšç€è¿›ç¨‹çš„é‡Šæ”¾è€Œé‡Šæ”¾ã€‚ ä¸€æ—¦æˆ‘ä»¬å…³é—­ Tab é¡µé¢ï¼Œå†…å­˜ä¸­çš„ç¼“å­˜ä¹Ÿå°±è¢«é‡Šæ”¾ Disk Cache Disk Cache ä¹Ÿå°±æ˜¯å­˜å‚¨åœ¨ç¡¬ç›˜ä¸­çš„ç¼“å­˜ï¼Œè¯»å–é€Ÿåº¦æ…¢ç‚¹ï¼Œä½†æ˜¯ä»€ä¹ˆéƒ½èƒ½å­˜å‚¨åˆ°ç£ç›˜ä¸­ï¼Œæ¯”ä¹‹ Memory Cache èƒœåœ¨å®¹é‡å’Œå­˜å‚¨æ—¶æ•ˆæ€§ä¸Šã€‚ åœ¨æ‰€æœ‰æµè§ˆå™¨ç¼“å­˜ä¸­ï¼ŒDisk Cache è¦†ç›–é¢åŸºæœ¬æ˜¯æœ€å¤§çš„ã€‚å®ƒä¼šæ ¹æ® HTTP Herder ä¸­çš„å­—æ®µåˆ¤æ–­å“ªäº›èµ„æºéœ€è¦ç¼“å­˜ï¼Œå“ªäº›èµ„æºå¯ä»¥ä¸è¯·æ±‚ç›´æ¥ä½¿ç”¨ï¼Œå“ªäº›èµ„æºå·²ç»è¿‡æœŸéœ€è¦é‡æ–°è¯·æ±‚ã€‚å¹¶ä¸”å³ä½¿åœ¨è·¨ç«™ç‚¹çš„æƒ…å†µä¸‹ï¼Œç›¸åŒåœ°å€çš„èµ„æºä¸€æ—¦è¢«ç¡¬ç›˜ç¼“å­˜ä¸‹æ¥ï¼Œå°±ä¸ä¼šå†æ¬¡å»è¯·æ±‚æ•°æ®ã€‚ Push Cache Push Cache æ˜¯ HTTP/2 ä¸­çš„å†…å®¹ï¼Œå½“ä»¥ä¸Šä¸‰ç§ç¼“å­˜éƒ½æ²¡æœ‰å‘½ä¸­æ—¶ï¼Œå®ƒæ‰ä¼šè¢«ä½¿ç”¨ã€‚å¹¶ä¸”ç¼“å­˜æ—¶é—´ä¹Ÿå¾ˆçŸ­æš‚ï¼Œåªåœ¨ä¼šè¯ï¼ˆSessionï¼‰ä¸­å­˜åœ¨ï¼Œä¸€æ—¦ä¼šè¯ç»“æŸå°±è¢«é‡Šæ”¾ã€‚ ç½‘ç»œè¯·æ±‚ ç¼“å­˜ç­–ç•¥æµè§ˆå™¨ç¼“å­˜ç­–ç•¥åˆ†ä¸ºä¸¤ç§ï¼šå¼ºç¼“å­˜å’Œåå•†ç¼“å­˜ï¼Œå¹¶ä¸”ç¼“å­˜ç­–ç•¥éƒ½æ˜¯é€šè¿‡è®¾ç½® HTTP Header æ¥å®ç°ã€‚ å¼ºç¼“å­˜å¼ºç¼“å­˜ï¼ˆ200 from cacheï¼‰æ—¶ï¼Œæµè§ˆå™¨å¦‚æœåˆ¤æ–­æœ¬åœ°ç¼“å­˜æœªè¿‡æœŸï¼Œå°±ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€å‘èµ·httpè¯·æ±‚ã€‚ é€šè¿‡è®¾ç½®HTTP Headerå®ç°ï¼šExpiresã€Cache-Controlã€‚ Cache-Controlçš„ä¼˜å…ˆçº§æ¯”Expiresé«˜ã€‚ ä¸€èˆ¬ä½¿ç”¨Cache-control: max-age=XXX åå•†ç¼“å­˜å¦‚æœç¼“å­˜è¿‡æœŸï¼Œåˆ™éœ€è¦å‘èµ·è¯·æ±‚éªŒè¯æ˜¯å¦éœ€è¦æ›´æ–°èµ„æºï¼Œåå•†ç¼“å­˜å¯ä»¥é€šè¿‡è®¾ç½®HTTP Headerçš„LastModifiedã€Etagå®ç°ã€‚ å½“å‘èµ·è¯·æ±‚éªŒè¯èµ„æºæ—¶ï¼Œå¦‚æœèµ„æºä¸éœ€è¦æ›´æ–°ï¼Œåˆ™æœåŠ¡å™¨ä¼šè¿”å›304çŠ¶æ€ç ï¼Œå¹¶ä¸”æ›´æ–°ç¼“å­˜æœ‰æ•ˆæœŸã€‚ Last-Modifiedï¼šè¡¨ç¤ºæœ¬åœ°æ–‡ä»¶æœ€åä¿®æ”¹æ—¥æœŸï¼ŒIf-Modified-Since ä¼šå°† Last-Modified çš„å€¼å‘é€ç»™æœåŠ¡å™¨ï¼Œè¯¢é—®æœåŠ¡å™¨åœ¨è¯¥æ—¥æœŸåèµ„æºæ˜¯å¦æœ‰æ›´æ–°ï¼Œæœ‰æ›´æ–°çš„è¯å°±ä¼šå°†æ–°çš„èµ„æºå‘é€å›æ¥ï¼Œå¦åˆ™è¿”å› 304 çŠ¶æ€ç ã€‚ Etagï¼šæ˜¯ä¸€ç§æŒ‡çº¹æœºåˆ¶ï¼Œä»£è¡¨æ–‡ä»¶ç›¸å…³æŒ‡çº¹åªæœ‰æ–‡ä»¶å˜æ‰ä¼šå˜ï¼Œä¹Ÿåªè¦æ–‡ä»¶å˜å°±ä¼šå˜ï¼Œä¹Ÿæ²¡æœ‰ç²¾ç¡®æ—¶é—´çš„é™åˆ¶ï¼Œåªè¦æ–‡ä»¶ä¸€æ”¹å˜ï¼Œç«‹é©¬E-tagå°±ä¸ä¸€æ ·äº†ã€‚ å®é™…åº”ç”¨ å¯¹äºé¢‘ç¹å˜åŠ¨çš„èµ„æºï¼Œé¦–å…ˆéœ€è¦ä½¿ç”¨ Cache-Control: no-cache ä½¿æµè§ˆå™¨æ¯æ¬¡éƒ½è¯·æ±‚æœåŠ¡å™¨ï¼Œç„¶åé…åˆ ETag æˆ–è€… Last-Modified æ¥éªŒè¯èµ„æºæ˜¯å¦æœ‰æ•ˆã€‚è¿™æ ·çš„åšæ³•è™½ç„¶ä¸èƒ½èŠ‚çœè¯·æ±‚æ•°é‡ï¼Œä½†æ˜¯èƒ½æ˜¾è‘—å‡å°‘å“åº”æ•°æ®å¤§å°ã€‚ Javascriptå¼•æ“è§£æè¿‡ç¨‹ 1","link":"/2019/08/20/ä»è¾“å…¥URLåˆ°é¡µé¢åŠ è½½çš„è¿‡ç¨‹çš„çŸ¥è¯†æ¢³ç†/"}],"tags":[],"categories":[{"name":"Web","slug":"Web","link":"/categories/Web/"},{"name":"Javascript","slug":"Web/Javascript","link":"/categories/Web/Javascript/"},{"name":"Webpack","slug":"Web/Webpack","link":"/categories/Web/Webpack/"},{"name":"Project","slug":"Project","link":"/categories/Project/"}]}